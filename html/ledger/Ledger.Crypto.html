<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Crypto</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Cryptographic primitives}
</a><a id="36" class="Markup">\begin{code}[hide]</a>
<a id="55" class="Symbol">{-#</a> <a id="59" class="Keyword">OPTIONS</a> <a id="67" class="Pragma">--safe</a> <a id="74" class="Symbol">#-}</a>
<a id="78" class="Keyword">module</a> <a id="85" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a> <a id="99" class="Keyword">where</a>

<a id="106" class="Keyword">open</a> <a id="111" class="Keyword">import</a> <a id="118" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="133" class="Keyword">hiding</a> <a id="140" class="Symbol">(</a><a id="141" href="Data.Bool.Base.html#1451" class="Function">T</a><a id="142" class="Symbol">)</a>
<a id="144" class="Keyword">open</a> <a id="149" class="Keyword">import</a> <a id="156" href="Interface.Hashable.html" class="Module">Interface.Hashable</a> <a id="175" class="Keyword">public</a>

<a id="183" class="Keyword">record</a> <a id="isHashableSet"></a><a id="190" href="Ledger.Crypto.html#190" class="Record">isHashableSet</a> <a id="204" class="Symbol">(</a><a id="205" href="Ledger.Crypto.html#205" class="Bound">T</a> <a id="207" class="Symbol">:</a> <a id="209" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="212" class="Symbol">)</a> <a id="214" class="Symbol">:</a> <a id="216" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="221" class="Keyword">where</a>
  <a id="229" class="Keyword">constructor</a> <a id="mkIsHashableSet"></a><a id="241" href="Ledger.Crypto.html#241" class="InductiveConstructor">mkIsHashableSet</a>
  <a id="259" class="Keyword">field</a> <a id="isHashableSet.THash"></a><a id="265" href="Ledger.Crypto.html#265" class="Field">THash</a> <a id="271" class="Symbol">:</a> <a id="273" href="Agda.Primitive.html#320" class="Primitive">Set</a>
        <a id="285" class="Symbol">⦃</a> <a id="isHashableSet.DecEq-THash"></a><a id="287" href="Ledger.Crypto.html#287" class="Field">DecEq-THash</a> <a id="299" class="Symbol">⦄</a> <a id="301" class="Symbol">:</a> <a id="303" href="Interface.DecEq.html#185" class="Record">DecEq</a>      <a id="314" href="Ledger.Crypto.html#265" class="Field">THash</a>
        <a id="328" class="Symbol">⦃</a> <a id="isHashableSet.T-Hashable"></a><a id="330" href="Ledger.Crypto.html#330" class="Field">T-Hashable</a>  <a id="342" class="Symbol">⦄</a> <a id="344" class="Symbol">:</a> <a id="346" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="355" href="Ledger.Crypto.html#205" class="Bound">T</a> <a id="357" href="Ledger.Crypto.html#265" class="Field">THash</a>
<a id="363" class="Keyword">open</a> <a id="368" href="Ledger.Crypto.html#190" class="Module">isHashableSet</a>

<a id="383" class="Keyword">record</a> <a id="HashableSet"></a><a id="390" href="Ledger.Crypto.html#390" class="Record">HashableSet</a> <a id="402" class="Symbol">:</a> <a id="404" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="409" class="Keyword">where</a>
  <a id="417" class="Keyword">constructor</a> <a id="mkHashableSet"></a><a id="429" href="Ledger.Crypto.html#429" class="InductiveConstructor">mkHashableSet</a>
  <a id="445" class="Keyword">field</a> <a id="HashableSet.T"></a><a id="451" href="Ledger.Crypto.html#451" class="Field">T</a> <a id="453" class="Symbol">:</a> <a id="455" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="458" class="Symbol">;</a> <a id="460" class="Symbol">⦃</a> <a id="HashableSet.T-isHashable"></a><a id="462" href="Ledger.Crypto.html#462" class="Field">T-isHashable</a> <a id="475" class="Symbol">⦄</a> <a id="477" class="Symbol">:</a> <a id="479" href="Ledger.Crypto.html#190" class="Record">isHashableSet</a> <a id="493" href="Ledger.Crypto.html#451" class="Field">T</a>
  <a id="497" class="Keyword">open</a> <a id="502" href="Ledger.Crypto.html#190" class="Module">isHashableSet</a> <a id="516" href="Ledger.Crypto.html#462" class="Field">T-isHashable</a> <a id="529" class="Keyword">public</a>

<a id="537" class="Keyword">record</a> <a id="PKKScheme"></a><a id="544" href="Ledger.Crypto.html#544" class="Record">PKKScheme</a> <a id="554" class="Symbol">:</a> <a id="556" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="561" class="Keyword">where</a>
  <a id="569" class="Keyword">field</a>
<a id="575" class="Markup">\end{code}</a><a id="585" class="Background">
We rely on a public key signing scheme for verification of spending.
\begin{figure*}[h]
\emph{Types \&amp; functions}
</a><a id="700" class="Markup">\begin{code}</a>
        <a id="PKKScheme.SKey"></a><a id="721" href="Ledger.Crypto.html#721" class="Field">SKey</a> <a id="PKKScheme.VKey"></a><a id="726" href="Ledger.Crypto.html#726" class="Field">VKey</a> <a id="PKKScheme.Sig"></a><a id="731" href="Ledger.Crypto.html#731" class="Field">Sig</a> <a id="PKKScheme.Ser"></a><a id="735" href="Ledger.Crypto.html#735" class="Field">Ser</a> <a id="739" class="Symbol">:</a> <a id="741" href="Agda.Primitive.html#320" class="Primitive">Set</a>
        <a id="PKKScheme.isKeyPair"></a><a id="753" href="Ledger.Crypto.html#753" class="Field">isKeyPair</a> <a id="763" class="Symbol">:</a> <a id="765" href="Ledger.Crypto.html#721" class="Field">SKey</a> <a id="770" class="Symbol">→</a> <a id="772" href="Ledger.Crypto.html#726" class="Field">VKey</a> <a id="777" class="Symbol">→</a> <a id="779" href="Agda.Primitive.html#320" class="Primitive">Set</a>
        <a id="PKKScheme.isSigned"></a><a id="791" href="Ledger.Crypto.html#791" class="Field">isSigned</a> <a id="800" class="Symbol">:</a> <a id="802" href="Ledger.Crypto.html#726" class="Field">VKey</a> <a id="807" class="Symbol">→</a> <a id="809" href="Ledger.Crypto.html#735" class="Field">Ser</a> <a id="813" class="Symbol">→</a> <a id="815" href="Ledger.Crypto.html#731" class="Field">Sig</a> <a id="819" class="Symbol">→</a> <a id="821" href="Agda.Primitive.html#320" class="Primitive">Set</a>
        <a id="PKKScheme.sign"></a><a id="833" href="Ledger.Crypto.html#833" class="Field">sign</a> <a id="838" class="Symbol">:</a> <a id="840" href="Ledger.Crypto.html#721" class="Field">SKey</a> <a id="845" class="Symbol">→</a> <a id="847" href="Ledger.Crypto.html#735" class="Field">Ser</a> <a id="851" class="Symbol">→</a> <a id="853" href="Ledger.Crypto.html#731" class="Field">Sig</a>

  <a id="PKKScheme.KeyPair"></a><a id="860" href="Ledger.Crypto.html#860" class="Function">KeyPair</a> <a id="868" class="Symbol">=</a> <a id="870" href="Data.Product.Base.html#858" class="Function">Σ[</a> <a id="873" href="Ledger.Crypto.html#873" class="Bound">sk</a> <a id="876" href="Data.Product.Base.html#858" class="Function">∈</a> <a id="878" href="Ledger.Crypto.html#721" class="Field">SKey</a> <a id="883" href="Data.Product.Base.html#858" class="Function">]</a> <a id="885" href="Data.Product.Base.html#858" class="Function">Σ[</a> <a id="888" href="Ledger.Crypto.html#888" class="Bound">vk</a> <a id="891" href="Data.Product.Base.html#858" class="Function">∈</a> <a id="893" href="Ledger.Crypto.html#726" class="Field">VKey</a> <a id="898" href="Data.Product.Base.html#858" class="Function">]</a> <a id="900" href="Ledger.Crypto.html#753" class="Field">isKeyPair</a> <a id="910" href="Ledger.Crypto.html#873" class="Bound">sk</a> <a id="913" href="Ledger.Crypto.html#888" class="Bound">vk</a>
<a id="916" class="Markup">\end{code}</a><a id="926" class="Background">
\emph{Property of signatures}
</a><a id="957" class="Markup">\begin{code}[hide]</a>
  <a id="978" class="Keyword">field</a> <a id="PKKScheme.isSigned?"></a><a id="984" href="Ledger.Crypto.html#984" class="Field">isSigned?</a> <a id="994" class="Symbol">:</a> <a id="996" class="Symbol">∀</a> <a id="998" href="Ledger.Crypto.html#998" class="Bound">vk</a> <a id="1001" href="Ledger.Crypto.html#1001" class="Bound">d</a> <a id="1003" href="Ledger.Crypto.html#1003" class="Bound">σ</a> <a id="1005" class="Symbol">→</a> <a id="1007" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="1011" class="Symbol">(</a><a id="1012" href="Ledger.Crypto.html#791" class="Field">isSigned</a> <a id="1021" href="Ledger.Crypto.html#998" class="Bound">vk</a> <a id="1024" href="Ledger.Crypto.html#1001" class="Bound">d</a> <a id="1026" href="Ledger.Crypto.html#1003" class="Bound">σ</a><a id="1027" class="Symbol">)</a>
        <a id="PKKScheme.isSigned-correct"></a><a id="1037" href="Ledger.Crypto.html#1037" class="Field">isSigned-correct</a> <a id="1054" class="Symbol">:</a>
<a id="1056" class="Markup">\end{code}</a><a id="1066" class="Background">
</a><a id="1067" class="Markup">\begin{code}</a>
          <a id="1090" class="Symbol">(</a><a id="1091" href="Ledger.Crypto.html#1091" class="Bound">(</a><a id="1092" href="Ledger.Crypto.html#1092" class="Bound">sk</a> <a id="1095" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1097" href="Ledger.Crypto.html#1097" class="Bound">vk</a> <a id="1100" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1102" href="Ledger.Crypto.html#1091" class="Bound">_)</a> <a id="1105" class="Symbol">:</a> <a id="1107" href="Ledger.Crypto.html#860" class="Function">KeyPair</a><a id="1114" class="Symbol">)</a> <a id="1116" class="Symbol">(</a><a id="1117" href="Ledger.Crypto.html#1117" class="Bound">d</a> <a id="1119" class="Symbol">:</a> <a id="1121" href="Ledger.Crypto.html#735" class="Field">Ser</a><a id="1124" class="Symbol">)</a> <a id="1126" class="Symbol">(</a><a id="1127" href="Ledger.Crypto.html#1127" class="Bound">σ</a> <a id="1129" class="Symbol">:</a> <a id="1131" href="Ledger.Crypto.html#731" class="Field">Sig</a><a id="1134" class="Symbol">)</a> <a id="1136" class="Symbol">→</a> <a id="1138" href="Ledger.Crypto.html#833" class="Field">sign</a> <a id="1143" href="Ledger.Crypto.html#1092" class="Bound">sk</a> <a id="1146" href="Ledger.Crypto.html#1117" class="Bound">d</a> <a id="1148" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1150" href="Ledger.Crypto.html#1127" class="Bound">σ</a> <a id="1152" class="Symbol">→</a> <a id="1154" href="Ledger.Crypto.html#791" class="Field">isSigned</a> <a id="1163" href="Ledger.Crypto.html#1097" class="Bound">vk</a> <a id="1166" href="Ledger.Crypto.html#1117" class="Bound">d</a> <a id="1168" href="Ledger.Crypto.html#1127" class="Bound">σ</a>
<a id="1170" class="Markup">\end{code}</a><a id="1180" class="Background">
\caption{Definitions for the public key signature scheme}
\label{fig:defs:crypto}
\end{figure*}
</a><a id="1277" class="Markup">\begin{code}[hide]</a>
        <a id="1304" class="Symbol">⦃</a> <a id="PKKScheme.DecEq-VKey"></a><a id="1306" href="Ledger.Crypto.html#1306" class="Field">DecEq-VKey</a> <a id="1317" class="Symbol">⦄</a> <a id="1319" class="Symbol">:</a> <a id="1321" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="1327" href="Ledger.Crypto.html#726" class="Field">VKey</a>
        <a id="1340" class="Symbol">⦃</a> <a id="PKKScheme.DecEq-Sig"></a><a id="1342" href="Ledger.Crypto.html#1342" class="Field">DecEq-Sig</a>  <a id="1353" class="Symbol">⦄</a> <a id="1355" class="Symbol">:</a> <a id="1357" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="1363" href="Ledger.Crypto.html#731" class="Field">Sig</a>
        <a id="1375" class="Symbol">⦃</a> <a id="PKKScheme.DecEq-Ser"></a><a id="1377" href="Ledger.Crypto.html#1377" class="Field">DecEq-Ser</a>  <a id="1388" class="Symbol">⦄</a> <a id="1390" class="Symbol">:</a> <a id="1392" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="1398" href="Ledger.Crypto.html#735" class="Field">Ser</a>
  <a id="1404" class="Keyword">instance</a>
    <a id="PKKScheme.Dec-isSigned"></a><a id="1417" href="Ledger.Crypto.html#1417" class="Function">Dec-isSigned</a> <a id="1430" class="Symbol">:</a> <a id="1432" class="Symbol">∀</a> <a id="1434" class="Symbol">{</a><a id="1435" href="Ledger.Crypto.html#1435" class="Bound">vk</a> <a id="1438" href="Ledger.Crypto.html#1438" class="Bound">d</a> <a id="1440" href="Ledger.Crypto.html#1440" class="Bound">σ</a><a id="1441" class="Symbol">}</a> <a id="1443" class="Symbol">→</a> <a id="1445" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="1449" class="Symbol">(</a><a id="1450" href="Ledger.Crypto.html#791" class="Field">isSigned</a> <a id="1459" href="Ledger.Crypto.html#1435" class="Bound">vk</a> <a id="1462" href="Ledger.Crypto.html#1438" class="Bound">d</a> <a id="1464" href="Ledger.Crypto.html#1440" class="Bound">σ</a><a id="1465" class="Symbol">)</a>
    <a id="1471" href="Ledger.Crypto.html#1417" class="Function">Dec-isSigned</a> <a id="1484" class="Symbol">=</a> <a id="1486" href="Ledger.Crypto.html#984" class="Field">isSigned?</a> <a id="1496" class="Symbol">_</a> <a id="1498" class="Symbol">_</a> <a id="1500" class="Symbol">_</a>

<a id="1503" class="Keyword">record</a> <a id="Crypto"></a><a id="1510" href="Ledger.Crypto.html#1510" class="Record">Crypto</a> <a id="1517" class="Symbol">:</a> <a id="1519" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="1524" class="Keyword">where</a>
  <a id="1532" class="Keyword">field</a> <a id="Crypto.pkk"></a><a id="1538" href="Ledger.Crypto.html#1538" class="Field">pkk</a> <a id="1542" class="Symbol">:</a> <a id="1544" href="Ledger.Crypto.html#544" class="Record">PKKScheme</a>

  <a id="1557" class="Keyword">open</a> <a id="1562" href="Ledger.Crypto.html#544" class="Module">PKKScheme</a> <a id="1572" href="Ledger.Crypto.html#1538" class="Field">pkk</a> <a id="1576" class="Keyword">public</a>

  <a id="1586" class="Keyword">field</a> <a id="1592" class="Symbol">⦃</a> <a id="Crypto.khs"></a><a id="1594" href="Ledger.Crypto.html#1594" class="Field">khs</a> <a id="1598" class="Symbol">⦄</a>    <a id="1603" class="Symbol">:</a> <a id="1605" href="Ledger.Crypto.html#190" class="Record">isHashableSet</a> <a id="1619" href="Ledger.Crypto.html#726" class="Function">VKey</a>
        <a id="Crypto.ScriptHash"></a><a id="1632" href="Ledger.Crypto.html#1632" class="Field">ScriptHash</a> <a id="1643" class="Symbol">:</a> <a id="1645" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="1648" class="Symbol">;</a> <a id="1650" class="Symbol">⦃</a> <a id="Crypto.DecEq-ScriptHash"></a><a id="1652" href="Ledger.Crypto.html#1652" class="Field">DecEq-ScriptHash</a> <a id="1669" class="Symbol">⦄</a> <a id="1671" class="Symbol">:</a> <a id="1673" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="1679" href="Ledger.Crypto.html#1632" class="Field">ScriptHash</a>

  <a id="1693" class="Keyword">open</a> <a id="1698" href="Ledger.Crypto.html#190" class="Module">isHashableSet</a> <a id="1712" href="Ledger.Crypto.html#1594" class="Field">khs</a> <a id="1716" class="Keyword">renaming</a> <a id="1725" class="Symbol">(</a><a id="1726" href="Ledger.Crypto.html#265" class="Field">THash</a> <a id="1732" class="Symbol">to</a> <a id="1735" class="Field">KeyHash</a><a id="1742" class="Symbol">)</a> <a id="1744" class="Keyword">public</a>

<a id="1752" class="Comment">-- TODO: KES and VRF</a>
<a id="1773" class="Markup">\end{code}</a><a id="1783" class="Background">
</a></pre></body></html>