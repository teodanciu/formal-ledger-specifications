<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Script</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Scripts}
</a><a id="19" class="Markup">\begin{code}[hide]</a>
<a id="38" class="Symbol">{-#</a> <a id="42" class="Keyword">OPTIONS</a> <a id="50" class="Pragma">--safe</a> <a id="57" class="Symbol">#-}</a>

<a id="62" class="Keyword">open</a> <a id="67" class="Keyword">import</a> <a id="74" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="89" class="Keyword">hiding</a> <a id="96" class="Symbol">(</a><a id="97" href="Axiom.Set.html#9420" class="Function">All</a><a id="100" class="Symbol">;</a> <a id="102" href="Axiom.Set.html#9489" class="Function">Any</a><a id="105" class="Symbol">)</a>

<a id="108" class="Keyword">module</a> <a id="115" href="Ledger.Script.html" class="Module">Ledger.Script</a> <a id="129" class="Symbol">(</a><a id="130" href="Ledger.Script.html#130" class="Bound">KeyHash</a> <a id="138" href="Ledger.Script.html#138" class="Bound">ScriptHash</a> <a id="149" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="154" class="Symbol">:</a> <a id="156" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="159" class="Symbol">)</a> <a id="161" class="Symbol">⦃</a> <a id="163" href="Ledger.Script.html#163" class="Bound">_</a> <a id="165" class="Symbol">:</a> <a id="167" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="173" href="Ledger.Script.html#130" class="Bound">KeyHash</a> <a id="181" class="Symbol">⦄</a> <a id="183" class="Keyword">where</a>

<a id="190" class="Keyword">open</a> <a id="195" class="Keyword">import</a> <a id="202" href="Data.List.Relation.Unary.All.html" class="Module">Data.List.Relation.Unary.All</a>
<a id="231" class="Keyword">open</a> <a id="236" class="Keyword">import</a> <a id="243" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a>
<a id="272" class="Keyword">open</a> <a id="277" class="Keyword">import</a> <a id="284" href="Data.List.Relation.Binary.Sublist.Propositional.html" class="Module">Data.List.Relation.Binary.Sublist.Propositional</a> <a id="332" class="Symbol">as</a> <a id="335" class="Module">S</a>

<a id="338" class="Keyword">open</a> <a id="343" class="Keyword">import</a> <a id="350" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>

<a id="365" class="Keyword">open</a> <a id="370" class="Keyword">import</a> <a id="377" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>

<a id="398" class="Keyword">record</a> <a id="P1ScriptStructure"></a><a id="405" href="Ledger.Script.html#405" class="Record">P1ScriptStructure</a> <a id="423" class="Symbol">:</a> <a id="425" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="430" class="Keyword">where</a>
  <a id="438" class="Keyword">field</a> <a id="P1ScriptStructure.P1Script"></a><a id="444" href="Ledger.Script.html#444" class="Field">P1Script</a> <a id="453" class="Symbol">:</a> <a id="455" href="Agda.Primitive.html#320" class="Primitive">Set</a>
        <a id="P1ScriptStructure.validP1Script"></a><a id="467" href="Ledger.Script.html#467" class="Field">validP1Script</a> <a id="481" class="Symbol">:</a> <a id="483" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="485" href="Ledger.Script.html#130" class="Bound">KeyHash</a> <a id="493" class="Symbol">→</a> <a id="495" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="501" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="506" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="508" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="514" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="519" class="Symbol">→</a> <a id="521" href="Ledger.Script.html#444" class="Field">P1Script</a> <a id="530" class="Symbol">→</a> <a id="532" href="Agda.Primitive.html#320" class="Primitive">Set</a>
        <a id="P1ScriptStructure.validP1Script?"></a><a id="544" href="Ledger.Script.html#544" class="Field">validP1Script?</a> <a id="559" class="Symbol">:</a> <a id="561" class="Symbol">∀</a> <a id="563" href="Ledger.Script.html#563" class="Bound">khs</a> <a id="567" href="Ledger.Script.html#567" class="Bound">I</a> <a id="569" href="Ledger.Script.html#569" class="Bound">s</a> <a id="571" class="Symbol">→</a> <a id="573" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="577" class="Symbol">(</a><a id="578" href="Ledger.Script.html#467" class="Field">validP1Script</a> <a id="592" href="Ledger.Script.html#563" class="Bound">khs</a> <a id="596" href="Ledger.Script.html#567" class="Bound">I</a> <a id="598" href="Ledger.Script.html#569" class="Bound">s</a><a id="599" class="Symbol">)</a>
        <a id="609" class="Symbol">⦃</a> <a id="P1ScriptStructure.Hashable-P1Script"></a><a id="611" href="Ledger.Script.html#611" class="Field">Hashable-P1Script</a> <a id="629" class="Symbol">⦄</a> <a id="631" class="Symbol">:</a> <a id="633" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="642" href="Ledger.Script.html#444" class="Field">P1Script</a> <a id="651" href="Ledger.Script.html#138" class="Bound">ScriptHash</a>
        <a id="670" class="Symbol">⦃</a> <a id="P1ScriptStructure.DecEq-P1Script"></a><a id="672" href="Ledger.Script.html#672" class="Field">DecEq-P1Script</a>    <a id="690" class="Symbol">⦄</a> <a id="692" class="Symbol">:</a> <a id="694" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="700" href="Ledger.Script.html#444" class="Field">P1Script</a>
  <a id="711" class="Keyword">instance</a>
    <a id="P1ScriptStructure.Dec-ValidP1Script"></a><a id="724" href="Ledger.Script.html#724" class="Function">Dec-ValidP1Script</a> <a id="742" class="Symbol">:</a> <a id="744" class="Symbol">∀</a> <a id="746" class="Symbol">{</a><a id="747" href="Ledger.Script.html#747" class="Bound">khs</a> <a id="751" href="Ledger.Script.html#751" class="Bound">I</a> <a id="753" href="Ledger.Script.html#753" class="Bound">s</a><a id="754" class="Symbol">}</a> <a id="756" class="Symbol">→</a> <a id="758" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="762" class="Symbol">(</a><a id="763" href="Ledger.Script.html#467" class="Field">validP1Script</a> <a id="777" href="Ledger.Script.html#747" class="Bound">khs</a> <a id="781" href="Ledger.Script.html#751" class="Bound">I</a> <a id="783" href="Ledger.Script.html#753" class="Bound">s</a><a id="784" class="Symbol">)</a>
    <a id="790" href="Ledger.Script.html#724" class="Function">Dec-ValidP1Script</a> <a id="808" class="Symbol">=</a> <a id="810" href="Ledger.Script.html#544" class="Field">validP1Script?</a> <a id="825" class="Symbol">_</a> <a id="827" class="Symbol">_</a> <a id="829" class="Symbol">_</a>

<a id="832" class="Keyword">record</a> <a id="PlutusStructure"></a><a id="839" href="Ledger.Script.html#839" class="Record">PlutusStructure</a> <a id="855" class="Symbol">:</a> <a id="857" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="862" class="Keyword">where</a>
  <a id="870" class="Keyword">field</a> <a id="PlutusStructure.Dataʰ"></a><a id="876" href="Ledger.Script.html#876" class="Field">Dataʰ</a> <a id="882" class="Symbol">:</a> <a id="884" href="Ledger.Crypto.html#390" class="Record">HashableSet</a>
        <a id="PlutusStructure.PlutusScript"></a><a id="904" href="Ledger.Script.html#904" class="Field">PlutusScript</a> <a id="PlutusStructure.ExUnits"></a><a id="917" href="Ledger.Script.html#917" class="Field">ExUnits</a> <a id="PlutusStructure.CostModel"></a><a id="925" href="Ledger.Script.html#925" class="Field">CostModel</a> <a id="935" class="Symbol">:</a> <a id="937" href="Agda.Primitive.html#320" class="Primitive">Set</a>
        <a id="949" class="Symbol">⦃</a> <a id="PlutusStructure.Hashable-PlutusScript"></a><a id="951" href="Ledger.Script.html#951" class="Field">Hashable-PlutusScript</a> <a id="973" class="Symbol">⦄</a> <a id="975" class="Symbol">:</a> <a id="977" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="986" href="Ledger.Script.html#904" class="Field">PlutusScript</a> <a id="999" href="Ledger.Script.html#138" class="Bound">ScriptHash</a>
        <a id="1018" class="Symbol">⦃</a> <a id="PlutusStructure.DecEq-PlutusScript"></a><a id="1020" href="Ledger.Script.html#1020" class="Field">DecEq-PlutusScript</a>    <a id="1042" class="Symbol">⦄</a> <a id="1044" class="Symbol">:</a> <a id="1046" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="1052" href="Ledger.Script.html#904" class="Field">PlutusScript</a>

  <a id="1068" class="Keyword">open</a> <a id="1073" href="Ledger.Crypto.html#390" class="Module">HashableSet</a> <a id="1085" href="Ledger.Script.html#876" class="Field">Dataʰ</a> <a id="1091" class="Keyword">renaming</a> <a id="1100" class="Symbol">(</a><a id="1101" href="Ledger.Crypto.html#451" class="Field">T</a> <a id="1103" class="Symbol">to</a> <a id="1106" class="Field">Data</a><a id="1110" class="Symbol">;</a> <a id="1112" href="Ledger.Crypto.html#265" class="Function">THash</a> <a id="1118" class="Symbol">to</a> <a id="1121" class="Function">DataHash</a><a id="1129" class="Symbol">)</a> <a id="1131" class="Keyword">public</a>

  <a id="1141" class="Keyword">field</a> <a id="PlutusStructure.validPlutusScript"></a><a id="1147" href="Ledger.Script.html#1147" class="Field">validPlutusScript</a> <a id="1165" class="Symbol">:</a> <a id="1167" href="Ledger.Script.html#925" class="Field">CostModel</a> <a id="1177" class="Symbol">→</a> <a id="1179" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1184" href="Ledger.Script.html#1106" class="Function">Data</a> <a id="1189" class="Symbol">→</a> <a id="1191" href="Ledger.Script.html#917" class="Field">ExUnits</a> <a id="1199" class="Symbol">→</a> <a id="1201" href="Ledger.Script.html#904" class="Field">PlutusScript</a> <a id="1214" class="Symbol">→</a> <a id="1216" href="Agda.Primitive.html#320" class="Primitive">Set</a>
        <a id="PlutusStructure.validPlutusScript?"></a><a id="1228" href="Ledger.Script.html#1228" class="Field">validPlutusScript?</a> <a id="1247" class="Symbol">:</a> <a id="1249" class="Symbol">∀</a> <a id="1251" href="Ledger.Script.html#1251" class="Bound">cm</a> <a id="1254" href="Ledger.Script.html#1254" class="Bound">ds</a> <a id="1257" href="Ledger.Script.html#1257" class="Bound">eu</a> <a id="1260" href="Ledger.Script.html#1260" class="Bound">s</a> <a id="1262" class="Symbol">→</a> <a id="1264" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="1268" class="Symbol">(</a><a id="1269" href="Ledger.Script.html#1147" class="Field">validPlutusScript</a> <a id="1287" href="Ledger.Script.html#1251" class="Bound">cm</a> <a id="1290" href="Ledger.Script.html#1254" class="Bound">ds</a> <a id="1293" href="Ledger.Script.html#1257" class="Bound">eu</a> <a id="1296" href="Ledger.Script.html#1260" class="Bound">s</a><a id="1297" class="Symbol">)</a>

<a id="1300" class="Keyword">record</a> <a id="ScriptStructure"></a><a id="1307" href="Ledger.Script.html#1307" class="Record">ScriptStructure</a> <a id="1323" class="Symbol">:</a> <a id="1325" href="Agda.Primitive.html#320" class="Primitive">Set₁</a> <a id="1330" class="Keyword">where</a>
  <a id="1338" class="Keyword">field</a> <a id="ScriptStructure.p1s"></a><a id="1344" href="Ledger.Script.html#1344" class="Field">p1s</a> <a id="1348" class="Symbol">:</a> <a id="1350" href="Ledger.Script.html#405" class="Record">P1ScriptStructure</a>
        <a id="ScriptStructure.ps"></a><a id="1376" href="Ledger.Script.html#1376" class="Field">ps</a>  <a id="1380" class="Symbol">:</a> <a id="1382" href="Ledger.Script.html#839" class="Record">PlutusStructure</a>

  <a id="1401" class="Keyword">open</a> <a id="1406" href="Ledger.Script.html#405" class="Module">P1ScriptStructure</a> <a id="1424" href="Ledger.Script.html#1344" class="Field">p1s</a> <a id="1428" class="Keyword">public</a>
  <a id="1437" class="Keyword">open</a> <a id="1442" href="Ledger.Script.html#839" class="Module">PlutusStructure</a> <a id="1458" href="Ledger.Script.html#1376" class="Field">ps</a> <a id="1461" class="Keyword">public</a>
    <a id="1472" class="Keyword">renaming</a> <a id="1481" class="Symbol">(</a> <a id="1483" href="Ledger.Script.html#904" class="Field">PlutusScript</a>       <a id="1502" class="Symbol">to</a> <a id="1505" class="Field">P2Script</a>
             <a id="1527" class="Symbol">;</a> <a id="1529" href="Ledger.Script.html#1147" class="Field">validPlutusScript</a>  <a id="1548" class="Symbol">to</a> <a id="1551" class="Field">validP2Script</a>
             <a id="1578" class="Symbol">;</a> <a id="1580" href="Ledger.Script.html#1228" class="Field">validPlutusScript?</a> <a id="1599" class="Symbol">to</a> <a id="1602" class="Field">validP2Script?</a>
             <a id="1630" class="Symbol">)</a>

  <a id="ScriptStructure.Script"></a><a id="1635" href="Ledger.Script.html#1635" class="Function">Script</a> <a id="1642" class="Symbol">=</a> <a id="1644" href="Ledger.Script.html#444" class="Function">P1Script</a> <a id="1653" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="1655" href="Ledger.Script.html#1505" class="Function">P2Script</a>

  <a id="1667" class="Keyword">instance</a>
    <a id="ScriptStructure.Hashable-Script"></a><a id="1680" href="Ledger.Script.html#1680" class="Function">Hashable-Script</a> <a id="1696" class="Symbol">:</a> <a id="1698" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="1707" href="Ledger.Script.html#1635" class="Function">Script</a> <a id="1714" href="Ledger.Script.html#138" class="Bound">ScriptHash</a>
    <a id="1729" href="Ledger.Script.html#1680" class="Function">Hashable-Script</a> <a id="1745" class="Symbol">.</a><a id="1746" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="1751" class="Symbol">(</a><a id="1752" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="1757" href="Ledger.Script.html#1757" class="Bound">s</a><a id="1758" class="Symbol">)</a> <a id="1760" class="Symbol">=</a> <a id="1762" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="1767" href="Ledger.Script.html#1757" class="Bound">s</a>
    <a id="1773" href="Ledger.Script.html#1680" class="Function">Hashable-Script</a> <a id="1789" class="Symbol">.</a><a id="1790" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="1795" class="Symbol">(</a><a id="1796" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="1801" href="Ledger.Script.html#1801" class="Bound">s</a><a id="1802" class="Symbol">)</a> <a id="1804" class="Symbol">=</a> <a id="1806" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="1811" href="Ledger.Script.html#1801" class="Bound">s</a>
<a id="1813" class="Markup">\end{code}</a><a id="1823" class="Background">
We define Timelock scripts here. They can verify the presence of keys and whether a transaction happens in a certain slot interval. These scripts are executed as part of the regular witnessing.
\begin{figure*}[h]
</a><a id="2037" class="Markup">\begin{code}</a>
<a id="2050" class="Keyword">data</a> <a id="Timelock"></a><a id="2055" href="Ledger.Script.html#2055" class="Datatype">Timelock</a> <a id="2064" class="Symbol">:</a> <a id="2066" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2070" class="Keyword">where</a>
  <a id="Timelock.RequireAllOf"></a><a id="2078" href="Ledger.Script.html#2078" class="InductiveConstructor">RequireAllOf</a>       <a id="2097" class="Symbol">:</a> <a id="2099" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2104" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>      <a id="2118" class="Symbol">→</a> <a id="2120" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>
  <a id="Timelock.RequireAnyOf"></a><a id="2131" href="Ledger.Script.html#2131" class="InductiveConstructor">RequireAnyOf</a>       <a id="2150" class="Symbol">:</a> <a id="2152" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2157" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>      <a id="2171" class="Symbol">→</a> <a id="2173" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>
  <a id="Timelock.RequireMOf"></a><a id="2184" href="Ledger.Script.html#2184" class="InductiveConstructor">RequireMOf</a>         <a id="2203" class="Symbol">:</a> <a id="2205" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="2207" class="Symbol">→</a> <a id="2209" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2214" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>  <a id="2224" class="Symbol">→</a> <a id="2226" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>
  <a id="Timelock.RequireSig"></a><a id="2237" href="Ledger.Script.html#2237" class="InductiveConstructor">RequireSig</a>         <a id="2256" class="Symbol">:</a> <a id="2258" href="Ledger.Script.html#130" class="Bound">KeyHash</a>            <a id="2277" class="Symbol">→</a> <a id="2279" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>
  <a id="Timelock.RequireTimeStart"></a><a id="2290" href="Ledger.Script.html#2290" class="InductiveConstructor">RequireTimeStart</a>   <a id="2309" class="Symbol">:</a> <a id="2311" href="Ledger.Script.html#149" class="Bound">Slot</a>               <a id="2330" class="Symbol">→</a> <a id="2332" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>
  <a id="Timelock.RequireTimeExpire"></a><a id="2343" href="Ledger.Script.html#2343" class="InductiveConstructor">RequireTimeExpire</a>  <a id="2362" class="Symbol">:</a> <a id="2364" href="Ledger.Script.html#149" class="Bound">Slot</a>               <a id="2383" class="Symbol">→</a> <a id="2385" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>
<a id="2394" class="Markup">\end{code}</a><a id="2404" class="Background">
</a><a id="2405" class="Markup">\begin{code}[hide]</a>
<a id="2424" class="Keyword">module</a> <a id="2431" href="Ledger.Script.html#2431" class="Module">_</a> <a id="2433" class="Symbol">⦃</a> <a id="2435" href="Ledger.Script.html#2435" class="Bound">_</a> <a id="2437" class="Symbol">:</a> <a id="2439" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="2445" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="2450" class="Symbol">⦄</a> <a id="2452" class="Symbol">(</a><a id="2453" href="Ledger.Script.html#2453" class="Bound Operator">_≤_</a> <a id="2457" class="Symbol">:</a> <a id="2459" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="2464" class="Symbol">→</a> <a id="2466" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="2471" class="Symbol">→</a> <a id="2473" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="2476" class="Symbol">)</a> <a id="2478" class="Symbol">(</a><a id="2479" href="Ledger.Script.html#2479" class="Bound Operator">_≤ᵇ_</a> <a id="2484" class="Symbol">:</a> <a id="2486" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="2491" class="Symbol">→</a> <a id="2493" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="2498" class="Symbol">→</a> <a id="2500" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a><a id="2504" class="Symbol">)</a> <a id="2506" class="Keyword">where</a>
  <a id="2514" class="Keyword">private</a> <a id="2522" class="Keyword">variable</a> <a id="2531" href="Ledger.Script.html#2531" class="Generalizable">s</a> <a id="2533" class="Symbol">:</a> <a id="2535" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>
                   <a id="2563" href="Ledger.Script.html#2563" class="Generalizable">ss</a> <a id="2566" href="Ledger.Script.html#2566" class="Generalizable">ss&#39;</a> <a id="2570" class="Symbol">:</a> <a id="2572" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2577" href="Ledger.Script.html#2055" class="Datatype">Timelock</a>
                   <a id="2605" href="Ledger.Script.html#2605" class="Generalizable">k</a> <a id="2607" class="Symbol">:</a> <a id="2609" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
                   <a id="2630" href="Ledger.Script.html#2630" class="Generalizable">x</a> <a id="2632" class="Symbol">:</a> <a id="2634" href="Ledger.Script.html#130" class="Bound">KeyHash</a>
                   <a id="2661" href="Ledger.Script.html#2661" class="Generalizable">a</a> <a id="2663" href="Ledger.Script.html#2663" class="Generalizable">l</a> <a id="2665" href="Ledger.Script.html#2665" class="Generalizable">r</a> <a id="2667" class="Symbol">:</a> <a id="2669" href="Ledger.Script.html#149" class="Bound">Slot</a>
<a id="2674" class="Markup">\end{code}</a><a id="2684" class="Background">
</a><a id="2685" class="Markup">\begin{code}</a>
  <a id="2700" class="Keyword">module</a> <a id="2707" href="Ledger.Script.html#2707" class="Module">_</a> <a id="2709" class="Symbol">(</a><a id="2710" href="Ledger.Script.html#2710" class="Bound">khs</a> <a id="2714" class="Symbol">:</a> <a id="2716" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="2718" href="Ledger.Script.html#130" class="Bound">KeyHash</a><a id="2725" class="Symbol">)</a> <a id="2727" class="Symbol">(</a><a id="2728" href="Ledger.Script.html#2728" class="Bound">I</a> <a id="2730" class="Symbol">:</a> <a id="2732" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="2738" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="2743" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="2745" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="2751" href="Ledger.Script.html#149" class="Bound">Slot</a><a id="2755" class="Symbol">)</a> <a id="2757" class="Keyword">where</a>
    <a id="2767" class="Keyword">data</a> <a id="2772" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="2785" class="Symbol">:</a> <a id="2787" href="Ledger.Script.html#2055" class="Datatype">Timelock</a> <a id="2796" class="Symbol">→</a> <a id="2798" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2802" class="Keyword">where</a>
      <a id="2814" href="Ledger.Script.html#2814" class="InductiveConstructor">evalAll</a>  <a id="2823" class="Symbol">:</a> <a id="2825" href="Data.List.Relation.Unary.All.html#1439" class="Datatype">All</a> <a id="2829" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="2842" href="Ledger.Script.html#2563" class="Generalizable">ss</a>
               <a id="2860" class="Symbol">→</a> <a id="2862" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="2875" class="Symbol">(</a><a id="2876" href="Ledger.Script.html#2078" class="InductiveConstructor">RequireAllOf</a> <a id="2889" href="Ledger.Script.html#2563" class="Generalizable">ss</a><a id="2891" class="Symbol">)</a>
      <a id="2899" href="Ledger.Script.html#2899" class="InductiveConstructor">evalAny</a>  <a id="2908" class="Symbol">:</a> <a id="2910" href="Data.List.Relation.Unary.Any.html#1139" class="Datatype">Any</a> <a id="2914" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="2927" href="Ledger.Script.html#2563" class="Generalizable">ss</a>
               <a id="2945" class="Symbol">→</a> <a id="2947" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="2960" class="Symbol">(</a><a id="2961" href="Ledger.Script.html#2131" class="InductiveConstructor">RequireAnyOf</a> <a id="2974" href="Ledger.Script.html#2563" class="Generalizable">ss</a><a id="2976" class="Symbol">)</a>
      <a id="2984" href="Ledger.Script.html#2984" class="InductiveConstructor">evalMOf</a>  <a id="2993" class="Symbol">:</a> <a id="2995" href="Ledger.Script.html#2566" class="Generalizable">ss&#39;</a> <a id="2999" href="Data.List.Relation.Binary.Sublist.Setoid.html#1349" class="Function Operator">S.⊆</a> <a id="3003" href="Ledger.Script.html#2563" class="Generalizable">ss</a> <a id="3006" class="Symbol">→</a> <a id="3008" href="Data.List.Relation.Unary.All.html#1439" class="Datatype">All</a> <a id="3012" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="3025" href="Ledger.Script.html#2566" class="Generalizable">ss&#39;</a>
               <a id="3044" class="Symbol">→</a> <a id="3046" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="3059" class="Symbol">(</a><a id="3060" href="Ledger.Script.html#2184" class="InductiveConstructor">RequireMOf</a> <a id="3071" class="Symbol">(</a><a id="3072" href="Data.List.Base.html#5058" class="Function">length</a> <a id="3079" href="Ledger.Script.html#2566" class="Generalizable">ss&#39;</a><a id="3082" class="Symbol">)</a> <a id="3084" href="Ledger.Script.html#2563" class="Generalizable">ss</a><a id="3086" class="Symbol">)</a>
      <a id="3094" href="Ledger.Script.html#3094" class="InductiveConstructor">evalSig</a>  <a id="3103" class="Symbol">:</a> <a id="3105" href="Ledger.Script.html#2630" class="Generalizable">x</a> <a id="3107" href="Interface.IsSet.html#493" class="Function Operator">∈</a> <a id="3109" href="Ledger.Script.html#2710" class="Bound">khs</a>
               <a id="3128" class="Symbol">→</a> <a id="3130" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="3143" class="Symbol">(</a><a id="3144" href="Ledger.Script.html#2237" class="InductiveConstructor">RequireSig</a> <a id="3155" href="Ledger.Script.html#2630" class="Generalizable">x</a><a id="3156" class="Symbol">)</a>
      <a id="3164" href="Ledger.Script.html#3164" class="InductiveConstructor">evalTSt</a>  <a id="3173" class="Symbol">:</a> <a id="3175" href="Ledger.Script.html#2728" class="Bound">I</a> <a id="3177" class="Symbol">.</a><a id="3178" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="3184" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3186" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3191" href="Ledger.Script.html#2663" class="Generalizable">l</a> <a id="3193" class="Symbol">→</a> <a id="3195" href="Ledger.Script.html#2661" class="Generalizable">a</a> <a id="3197" href="Ledger.Script.html#2453" class="Bound Operator">≤</a> <a id="3199" href="Ledger.Script.html#2663" class="Generalizable">l</a>
               <a id="3216" class="Symbol">→</a> <a id="3218" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="3231" class="Symbol">(</a><a id="3232" href="Ledger.Script.html#2290" class="InductiveConstructor">RequireTimeStart</a> <a id="3249" href="Ledger.Script.html#2661" class="Generalizable">a</a><a id="3250" class="Symbol">)</a>
      <a id="3258" href="Ledger.Script.html#3258" class="InductiveConstructor">evalTEx</a>  <a id="3267" class="Symbol">:</a> <a id="3269" href="Ledger.Script.html#2728" class="Bound">I</a> <a id="3271" class="Symbol">.</a><a id="3272" href="Data.Product.Base.html#622" class="Field">proj₂</a> <a id="3278" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3280" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3285" href="Ledger.Script.html#2665" class="Generalizable">r</a> <a id="3287" class="Symbol">→</a> <a id="3289" href="Ledger.Script.html#2665" class="Generalizable">r</a> <a id="3291" href="Ledger.Script.html#2453" class="Bound Operator">≤</a> <a id="3293" href="Ledger.Script.html#2661" class="Generalizable">a</a>
               <a id="3310" class="Symbol">→</a> <a id="3312" href="Ledger.Script.html#2772" class="Datatype">evalTimelock</a> <a id="3325" class="Symbol">(</a><a id="3326" href="Ledger.Script.html#2290" class="InductiveConstructor">RequireTimeStart</a> <a id="3343" href="Ledger.Script.html#2661" class="Generalizable">a</a><a id="3344" class="Symbol">)</a>
<a id="3346" class="Markup">\end{code}</a><a id="3356" class="Background">
\caption{Timelock scripts and their evaluation}
\label{fig:defs:timelock}
\end{figure*}

</a><a id="3446" class="Markup">\begin{code}[hide]</a>
  <a id="3467" class="Keyword">module</a> <a id="3474" href="Ledger.Script.html#3474" class="Module">_</a> <a id="3476" class="Symbol">(</a><a id="3477" href="Ledger.Script.html#3477" class="Bound">khs</a> <a id="3481" class="Symbol">:</a> <a id="3483" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="3485" href="Ledger.Script.html#130" class="Bound">KeyHash</a><a id="3492" class="Symbol">)</a> <a id="3494" class="Keyword">where</a>
    <a id="3504" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3518" class="Symbol">:</a> <a id="3520" class="Symbol">(</a><a id="3521" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3527" href="Ledger.Script.html#149" class="Bound">Slot</a> <a id="3532" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3534" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3540" href="Ledger.Script.html#149" class="Bound">Slot</a><a id="3544" class="Symbol">)</a> <a id="3546" class="Symbol">→</a> <a id="3548" href="Ledger.Script.html#2055" class="Datatype">Timelock</a> <a id="3557" class="Symbol">→</a> <a id="3559" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="3568" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3582" href="Ledger.Script.html#3582" class="Bound">I</a> <a id="3584" class="Symbol">(</a><a id="3585" href="Ledger.Script.html#2078" class="InductiveConstructor">RequireAllOf</a> <a id="3598" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3600" class="Symbol">)</a>                   <a id="3620" class="Symbol">=</a> <a id="3622" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
    <a id="3631" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3645" href="Ledger.Script.html#3645" class="Bound">I</a> <a id="3647" class="Symbol">(</a><a id="3648" href="Ledger.Script.html#2078" class="InductiveConstructor">RequireAllOf</a> <a id="3661" class="Symbol">(</a><a id="3662" href="Ledger.Script.html#3662" class="Bound">x</a> <a id="3664" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3666" href="Ledger.Script.html#3666" class="Bound">xs</a><a id="3668" class="Symbol">))</a>             <a id="3683" class="Symbol">=</a>
      <a id="3691" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3705" href="Ledger.Script.html#3645" class="Bound">I</a> <a id="3707" href="Ledger.Script.html#3662" class="Bound">x</a> <a id="3709" href="Data.Bool.Base.html#986" class="Function Operator">∧</a> <a id="3711" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3725" href="Ledger.Script.html#3645" class="Bound">I</a> <a id="3727" class="Symbol">(</a><a id="3728" href="Ledger.Script.html#2078" class="InductiveConstructor">RequireAllOf</a> <a id="3741" href="Ledger.Script.html#3666" class="Bound">xs</a><a id="3743" class="Symbol">)</a>
    <a id="3749" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3763" href="Ledger.Script.html#3763" class="Bound">I</a> <a id="3765" class="Symbol">(</a><a id="3766" href="Ledger.Script.html#2131" class="InductiveConstructor">RequireAnyOf</a> <a id="3779" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3781" class="Symbol">)</a>                   <a id="3801" class="Symbol">=</a> <a id="3803" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
    <a id="3813" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3827" href="Ledger.Script.html#3827" class="Bound">I</a> <a id="3829" class="Symbol">(</a><a id="3830" href="Ledger.Script.html#2131" class="InductiveConstructor">RequireAnyOf</a> <a id="3843" class="Symbol">(</a><a id="3844" href="Ledger.Script.html#3844" class="Bound">x</a> <a id="3846" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3848" href="Ledger.Script.html#3848" class="Bound">xs</a><a id="3850" class="Symbol">))</a>             <a id="3865" class="Symbol">=</a>
      <a id="3873" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3887" href="Ledger.Script.html#3827" class="Bound">I</a> <a id="3889" href="Ledger.Script.html#3844" class="Bound">x</a> <a id="3891" href="Data.Bool.Base.html#1044" class="Function Operator">∨</a> <a id="3893" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3907" href="Ledger.Script.html#3827" class="Bound">I</a> <a id="3909" class="Symbol">(</a><a id="3910" href="Ledger.Script.html#2078" class="InductiveConstructor">RequireAllOf</a> <a id="3923" href="Ledger.Script.html#3848" class="Bound">xs</a><a id="3925" class="Symbol">)</a>
    <a id="3931" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="3945" href="Ledger.Script.html#3945" class="Bound">I</a> <a id="3947" class="Symbol">(</a><a id="3948" href="Ledger.Script.html#2184" class="InductiveConstructor">RequireMOf</a> <a id="3959" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a> <a id="3964" class="Symbol">_)</a>                 <a id="3983" class="Symbol">=</a> <a id="3985" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
    <a id="3994" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4008" href="Ledger.Script.html#4008" class="Bound">I</a> <a id="4010" class="Symbol">(</a><a id="4011" href="Ledger.Script.html#2184" class="InductiveConstructor">RequireMOf</a> <a id="4022" class="Symbol">(</a><a id="4023" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="4027" class="Symbol">_)</a> <a id="4030" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="4032" class="Symbol">)</a>             <a id="4046" class="Symbol">=</a> <a id="4048" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
    <a id="4058" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4072" href="Ledger.Script.html#4072" class="Bound">I</a> <a id="4074" class="Symbol">(</a><a id="4075" href="Ledger.Script.html#2184" class="InductiveConstructor">RequireMOf</a> <a id="4086" class="Symbol">(</a><a id="4087" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="4091" href="Ledger.Script.html#4091" class="Bound">m</a><a id="4092" class="Symbol">)</a> <a id="4094" class="Symbol">(</a><a id="4095" href="Ledger.Script.html#4095" class="Bound">x</a> <a id="4097" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="4099" href="Ledger.Script.html#4099" class="Bound">xs</a><a id="4101" class="Symbol">))</a>       <a id="4110" class="Symbol">=</a> <a id="4112" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="4115" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4129" href="Ledger.Script.html#4072" class="Bound">I</a> <a id="4131" href="Ledger.Script.html#4095" class="Bound">x</a>
      <a id="4139" href="Data.Bool.Base.html#1283" class="Function Operator">then</a>  <a id="4145" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4159" href="Ledger.Script.html#4072" class="Bound">I</a> <a id="4161" class="Symbol">(</a><a id="4162" href="Ledger.Script.html#2184" class="InductiveConstructor">RequireMOf</a> <a id="4173" href="Ledger.Script.html#4091" class="Bound">m</a> <a id="4175" href="Ledger.Script.html#4099" class="Bound">xs</a><a id="4177" class="Symbol">)</a>
      <a id="4185" href="Data.Bool.Base.html#1283" class="Function Operator">else</a>  <a id="4191" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4205" href="Ledger.Script.html#4072" class="Bound">I</a> <a id="4207" class="Symbol">(</a><a id="4208" href="Ledger.Script.html#2184" class="InductiveConstructor">RequireMOf</a> <a id="4219" class="Symbol">(</a><a id="4220" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="4224" href="Ledger.Script.html#4091" class="Bound">m</a><a id="4225" class="Symbol">)</a> <a id="4227" href="Ledger.Script.html#4099" class="Bound">xs</a><a id="4229" class="Symbol">)</a>
    <a id="4235" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4249" href="Ledger.Script.html#4249" class="Bound">I</a> <a id="4251" class="Symbol">(</a><a id="4252" href="Ledger.Script.html#2237" class="InductiveConstructor">RequireSig</a> <a id="4263" href="Ledger.Script.html#4263" class="Bound">x</a><a id="4264" class="Symbol">)</a>                      <a id="4287" class="Symbol">=</a> <a id="4289" href="Ledger.Script.html#4263" class="Bound">x</a> <a id="4291" href="Axiom.Set.html#10584" class="Function Operator">∈ᵇ</a> <a id="4294" href="Ledger.Script.html#3477" class="Bound">khs</a>
    <a id="4302" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4316" class="Symbol">(</a><a id="4317" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4322" href="Ledger.Script.html#4322" class="Bound">l</a>  <a id="4325" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4327" class="Symbol">_)</a>  <a id="4331" class="Symbol">(</a><a id="4332" href="Ledger.Script.html#2290" class="InductiveConstructor">RequireTimeStart</a> <a id="4349" href="Ledger.Script.html#4349" class="Bound">x</a><a id="4350" class="Symbol">)</a>   <a id="4354" class="Symbol">=</a> <a id="4356" href="Ledger.Script.html#4349" class="Bound">x</a> <a id="4358" href="Ledger.Script.html#2479" class="Bound Operator">≤ᵇ</a> <a id="4361" href="Ledger.Script.html#4322" class="Bound">l</a>
    <a id="4367" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4381" class="Symbol">(</a><a id="4382" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="4390" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4392" class="Symbol">_)</a>  <a id="4396" class="Symbol">(</a><a id="4397" href="Ledger.Script.html#2290" class="InductiveConstructor">RequireTimeStart</a> <a id="4414" href="Ledger.Script.html#4414" class="Bound">x</a><a id="4415" class="Symbol">)</a>   <a id="4419" class="Symbol">=</a> <a id="4421" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
    <a id="4431" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4445" class="Symbol">(_</a> <a id="4448" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4450" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4455" href="Ledger.Script.html#4455" class="Bound">r</a> <a id="4457" class="Symbol">)</a>  <a id="4460" class="Symbol">(</a><a id="4461" href="Ledger.Script.html#2343" class="InductiveConstructor">RequireTimeExpire</a> <a id="4479" href="Ledger.Script.html#4479" class="Bound">x</a><a id="4480" class="Symbol">)</a>  <a id="4483" class="Symbol">=</a> <a id="4485" href="Ledger.Script.html#4455" class="Bound">r</a> <a id="4487" href="Ledger.Script.html#2479" class="Bound Operator">≤ᵇ</a> <a id="4490" href="Ledger.Script.html#4479" class="Bound">x</a>
    <a id="4496" href="Ledger.Script.html#3504" class="Function">evalTimelockᵇ</a> <a id="4510" class="Symbol">(_</a> <a id="4513" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4515" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="4522" class="Symbol">)</a>  <a id="4525" class="Symbol">(</a><a id="4526" href="Ledger.Script.html#2343" class="InductiveConstructor">RequireTimeExpire</a> <a id="4544" href="Ledger.Script.html#4544" class="Bound">x</a><a id="4545" class="Symbol">)</a>  <a id="4548" class="Symbol">=</a> <a id="4550" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>

  <a id="4559" class="Keyword">unquoteDecl</a> <a id="4571" href="Ledger.Script.html#4571" class="Function">DecEq-Timelock</a> <a id="4586" class="Symbol">=</a> <a id="4588" href="Tactic.Derive.DecEq.html#3471" class="Function">derive-DecEq</a> <a id="4601" class="Symbol">((</a><a id="4603" class="Keyword">quote</a> <a id="4609" href="Ledger.Script.html#2055" class="Datatype">Timelock</a> <a id="4618" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4620" href="Ledger.Script.html#4571" class="Function">DecEq-Timelock</a><a id="4634" class="Symbol">)</a> <a id="4636" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="4638" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="4640" class="Symbol">)</a>

  <a id="4645" class="Keyword">open</a> <a id="4650" href="Ledger.Script.html#405" class="Module">P1ScriptStructure</a>

  <a id="4671" class="Comment">-- P1ScriptStructure-TL : Hashable Timelock ScriptHash → P1ScriptStructure</a>
  <a id="4748" class="Comment">-- P1ScriptStructure-TL h .P1Script = Timelock</a>
  <a id="4797" class="Comment">-- P1ScriptStructure-TL h .validP1Script = evalTimelock</a>
  <a id="4855" class="Comment">-- P1ScriptStructure-TL h .validP1Script? = {!!}</a>
  <a id="4906" class="Comment">-- P1ScriptStructure-TL h .Hashable-P1Script = h</a>
  <a id="4957" class="Comment">-- P1ScriptStructure-TL h .DecEq-P1Script = DecEq-Timelock</a>
<a id="5016" class="Markup">\end{code}</a><a id="5026" class="Background">
</a></pre></body></html>