<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Utxo</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{UTxO}
\label{sec:utxo}

\subsection{Accounting}

</a><a id="59" class="Markup">\begin{code}[hide]</a>
<a id="78" class="Symbol">{-#</a> <a id="82" class="Keyword">OPTIONS</a> <a id="90" class="Pragma">--safe</a> <a id="97" class="Symbol">#-}</a>

<a id="102" class="Keyword">open</a> <a id="107" class="Keyword">import</a> <a id="114" href="Algebra.html" class="Module">Algebra</a>              <a id="135" class="Keyword">using</a> <a id="141" class="Symbol">(</a><a id="142" href="Algebra.Bundles.html#6578" class="Record">CommutativeMonoid</a><a id="159" class="Symbol">)</a>
<a id="161" class="Keyword">open</a> <a id="166" class="Keyword">import</a> <a id="173" href="Data.Integer.Ext.html" class="Module">Data.Integer.Ext</a>     <a id="194" class="Keyword">using</a> <a id="200" class="Symbol">(</a><a id="201" href="Data.Integer.Ext.html#209" class="Function">posPart</a><a id="208" class="Symbol">;</a> <a id="210" href="Data.Integer.Ext.html#300" class="Function">negPart</a><a id="217" class="Symbol">)</a>
<a id="219" class="Keyword">open</a> <a id="224" class="Keyword">import</a> <a id="231" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a>  <a id="252" class="Keyword">using</a> <a id="258" class="Symbol">(</a><a id="259" href="Data.Nat.Properties.html#16387" class="Function">+-0-monoid</a><a id="269" class="Symbol">;</a> <a id="271" href="Data.Nat.Properties.html#16466" class="Function">+-0-commutativeMonoid</a><a id="292" class="Symbol">)</a>

<a id="295" class="Keyword">open</a> <a id="300" class="Keyword">import</a> <a id="307" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>

<a id="328" class="Keyword">open</a> <a id="333" class="Keyword">import</a> <a id="340" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="355" class="Keyword">open</a> <a id="360" class="Keyword">import</a> <a id="367" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="387" class="Keyword">module</a> <a id="394" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="406" class="Symbol">(</a><a id="407" href="Ledger.Utxo.html#407" class="Bound">txs</a> <a id="411" class="Symbol">:</a> <a id="413" class="Symbol">_)</a> <a id="416" class="Symbol">(</a><a id="417" class="Keyword">open</a> <a id="422" href="Ledger.Transaction.html#617" class="Module">TransactionStructure</a> <a id="443" href="Ledger.Utxo.html#407" class="Bound">txs</a><a id="446" class="Symbol">)</a> <a id="448" class="Keyword">where</a>

<a id="455" class="Keyword">instance</a>
  <a id="466" href="Ledger.Utxo.html#466" class="Function">_</a> <a id="468" class="Symbol">=</a> <a id="470" href="Ledger.TokenAlgebra.html#534" class="Field">TokenAlgebra.Value-CommutativeMonoid</a> <a id="507" href="Ledger.Transaction.html#2375" class="Field">tokenAlgebra</a>
  <a id="522" href="Ledger.Utxo.html#522" class="Function">_</a> <a id="524" class="Symbol">=</a> <a id="526" href="Data.Nat.Properties.html#16387" class="Function">+-0-monoid</a>
  <a id="539" href="Ledger.Utxo.html#539" class="Function">_</a> <a id="541" class="Symbol">=</a> <a id="543" href="Data.Nat.Properties.html#16466" class="Function">+-0-commutativeMonoid</a>

  <a id="HasCoin-Map"></a><a id="568" href="Ledger.Utxo.html#568" class="Function">HasCoin-Map</a> <a id="580" class="Symbol">:</a> <a id="582" class="Symbol">∀</a> <a id="584" class="Symbol">{</a><a id="585" href="Ledger.Utxo.html#585" class="Bound">A</a><a id="586" class="Symbol">}</a> <a id="588" class="Symbol">→</a> <a id="590" class="Symbol">⦃</a> <a id="592" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="598" href="Ledger.Utxo.html#585" class="Bound">A</a> <a id="600" class="Symbol">⦄</a> <a id="602" class="Symbol">→</a> <a id="604" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="612" class="Symbol">(</a><a id="613" href="Ledger.Utxo.html#585" class="Bound">A</a> <a id="615" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="617" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="621" class="Symbol">)</a>
  <a id="625" href="Ledger.Utxo.html#568" class="Function">HasCoin-Map</a> <a id="637" class="Symbol">.</a><a id="638" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="646" href="Ledger.Utxo.html#646" class="Bound">s</a> <a id="648" class="Symbol">=</a> <a id="650" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="655" href="Ledger.Utxo.html#655" class="Bound">x</a> <a id="657" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="659" href="Ledger.Utxo.html#646" class="Bound">s</a> <a id="661" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="664" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="666" href="Ledger.Utxo.html#655" class="Bound">x</a>

<a id="669" class="Comment">-- utxoEntrySizeWithoutVal = 27 words (8 bytes)</a>
<a id="utxoEntrySizeWithoutVal"></a><a id="717" href="Ledger.Utxo.html#717" class="Function">utxoEntrySizeWithoutVal</a> <a id="741" class="Symbol">:</a> <a id="743" href="Ledger.TokenAlgebra.html#587" class="Function">MemoryEstimate</a>
<a id="758" href="Ledger.Utxo.html#717" class="Function">utxoEntrySizeWithoutVal</a> <a id="782" class="Symbol">=</a> <a id="784" class="Number">8</a>

<a id="utxoEntrySize"></a><a id="787" href="Ledger.Utxo.html#787" class="Function">utxoEntrySize</a> <a id="801" class="Symbol">:</a> <a id="803" href="Ledger.Transaction.html#2952" class="Function">TxOut</a> <a id="809" class="Symbol">→</a> <a id="811" href="Ledger.TokenAlgebra.html#587" class="Function">MemoryEstimate</a>
<a id="826" href="Ledger.Utxo.html#787" class="Function">utxoEntrySize</a> <a id="840" class="Symbol">(</a><a id="841" href="Ledger.Utxo.html#841" class="Bound">fst</a> <a id="845" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="847" href="Ledger.Utxo.html#847" class="Bound">v</a><a id="848" class="Symbol">)</a> <a id="850" class="Symbol">=</a> <a id="852" href="Ledger.Utxo.html#717" class="Function">utxoEntrySizeWithoutVal</a> <a id="876" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="878" href="Ledger.TokenAlgebra.html#1080" class="Function">size</a> <a id="883" href="Ledger.Utxo.html#847" class="Bound">v</a>

<a id="886" class="Comment">-- TODO: fix this</a>
<a id="serSize"></a><a id="904" href="Ledger.Utxo.html#904" class="Function">serSize</a> <a id="912" class="Symbol">:</a> <a id="914" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a> <a id="920" class="Symbol">→</a> <a id="922" href="Ledger.TokenAlgebra.html#587" class="Function">MemoryEstimate</a>
<a id="937" href="Ledger.Utxo.html#904" class="Function">serSize</a> <a id="945" class="Symbol">=</a> <a id="947" class="Symbol">λ</a> <a id="949" href="Ledger.Utxo.html#949" class="Bound">_</a> <a id="951" class="Symbol">→</a> <a id="953" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a>

<a id="959" class="Keyword">open</a> <a id="964" href="Ledger.PParams.html#1022" class="Module">PParams</a>
<a id="972" class="Markup">\end{code}</a><a id="982" class="Background">

Figure~\ref{fig:functions:utxo} defines functions needed for the UTxO transition system.
Figure~\ref{fig:ts-types:utxo-shelley} defines the types needed for the UTxO transition system.
The UTxO transition system is given in Figure~\ref{fig:rules:utxo-shelley}.

\begin{itemize}

  \item
    The function $\fun{outs}$ creates the unspent outputs generated by a transaction.
    It maps the transaction id and output index to the output.

  \item
    The $\fun{balance}$ function calculates sum total of all the coin in a given UTxO.
\end{itemize}

\AgdaTarget{outs, minfee, inInterval, balance}
\begin{figure*}[h]
</a><a id="1597" class="Markup">\begin{code}[hide]</a>
<a id="1616" class="Keyword">module</a> <a id="1623" href="Ledger.Utxo.html#1623" class="Module">_</a> <a id="1625" class="Symbol">(</a><a id="1626" class="Keyword">open</a> <a id="1631" href="Ledger.Transaction.html#3346" class="Module">TxBody</a><a id="1637" class="Symbol">)</a> <a id="1639" class="Keyword">where</a>
<a id="1645" class="Markup">\end{code}</a><a id="1655" class="Background">
</a><a id="1656" class="Markup">\begin{code}</a>
  <a id="1671" href="Ledger.Utxo.html#1671" class="Function">outs</a> <a id="1676" class="Symbol">:</a> <a id="1678" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="1685" class="Symbol">→</a> <a id="1687" href="Ledger.Transaction.html#2976" class="Function">UTxO</a>
  <a id="1694" href="Ledger.Utxo.html#1671" class="Function">outs</a> <a id="1699" href="Ledger.Utxo.html#1699" class="Bound">tx</a> <a id="1702" class="Symbol">=</a> <a id="1704" href="Axiom.Set.Map.html#6655" class="Function">mapKeys</a> <a id="1712" class="Symbol">(</a><a id="1713" href="Ledger.Utxo.html#1699" class="Bound">tx</a> <a id="1716" class="Symbol">.</a><a id="1717" href="Ledger.Transaction.html#3857" class="Field">txid</a> <a id="1722" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,_</a><a id="1724" class="Symbol">)</a> <a id="1726" class="Symbol">(</a><a id="1727" href="Ledger.Utxo.html#1699" class="Bound">tx</a> <a id="1730" class="Symbol">.</a><a id="1731" href="Ledger.Transaction.html#3406" class="Field">txouts</a><a id="1737" class="Symbol">)</a>

  <a id="1742" href="Ledger.Utxo.html#1742" class="Function">balance</a> <a id="1750" class="Symbol">:</a> <a id="1752" href="Ledger.Transaction.html#2976" class="Function">UTxO</a> <a id="1757" class="Symbol">→</a> <a id="1759" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
  <a id="1767" href="Ledger.Utxo.html#1742" class="Function">balance</a> <a id="1775" href="Ledger.Utxo.html#1775" class="Bound">utxo</a> <a id="1780" class="Symbol">=</a> <a id="1782" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="1787" href="Ledger.Utxo.html#1787" class="Bound">x</a> <a id="1789" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="1791" href="Ledger.Utxo.html#1775" class="Bound">utxo</a> <a id="1796" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="1799" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="1801" href="Ledger.Transaction.html#4331" class="Function">getValue</a> <a id="1810" href="Ledger.Utxo.html#1787" class="Bound">x</a>

  <a id="1815" href="Ledger.Utxo.html#1815" class="Function">cbalance</a> <a id="1824" class="Symbol">:</a> <a id="1826" href="Ledger.Transaction.html#2976" class="Function">UTxO</a> <a id="1831" class="Symbol">→</a> <a id="1833" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="1840" href="Ledger.Utxo.html#1815" class="Function">cbalance</a> <a id="1849" href="Ledger.Utxo.html#1849" class="Bound">utxo</a> <a id="1854" class="Symbol">=</a> <a id="1856" href="Ledger.TokenAlgebra.html#924" class="Function">coin</a> <a id="1861" class="Symbol">(</a><a id="1862" href="Ledger.Utxo.html#1742" class="Function">balance</a> <a id="1870" href="Ledger.Utxo.html#1849" class="Bound">utxo</a><a id="1874" class="Symbol">)</a>

  <a id="1879" href="Ledger.Utxo.html#1879" class="Function">minfee</a> <a id="1886" class="Symbol">:</a> <a id="1888" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="1896" class="Symbol">→</a> <a id="1898" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="1905" class="Symbol">→</a> <a id="1907" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="1914" href="Ledger.Utxo.html#1879" class="Function">minfee</a> <a id="1921" href="Ledger.Utxo.html#1921" class="Bound">pp</a> <a id="1924" href="Ledger.Utxo.html#1924" class="Bound">tx</a> <a id="1927" class="Symbol">=</a> <a id="1929" href="Ledger.Utxo.html#1921" class="Bound">pp</a> <a id="1932" class="Symbol">.</a><a id="1933" href="Ledger.PParams.html#1448" class="Field">a</a> <a id="1935" href="Agda.Builtin.Nat.html#522" class="Primitive Operator">*</a> <a id="1937" href="Ledger.Utxo.html#1924" class="Bound">tx</a> <a id="1940" class="Symbol">.</a><a id="1941" href="Ledger.Transaction.html#3831" class="Field">txsize</a> <a id="1948" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="1950" href="Ledger.Utxo.html#1921" class="Bound">pp</a> <a id="1953" class="Symbol">.</a><a id="1954" href="Ledger.PParams.html#1479" class="Field">b</a>

  <a id="1959" class="Keyword">data</a> <a id="1964" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="1979" class="Symbol">:</a> <a id="1981" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1985" class="Keyword">where</a>
    <a id="1995" href="Ledger.Utxo.html#1995" class="InductiveConstructor">CredentialDeposit</a>  <a id="2014" class="Symbol">:</a> <a id="2016" href="Ledger.Address.html#713" class="Function">Credential</a>   <a id="2029" class="Symbol">→</a> <a id="2031" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a>
    <a id="2050" href="Ledger.Utxo.html#2050" class="InductiveConstructor">PoolDeposit</a>        <a id="2069" class="Symbol">:</a> <a id="2071" href="Ledger.Address.html#713" class="Function">Credential</a>   <a id="2084" class="Symbol">→</a> <a id="2086" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a>
    <a id="2105" href="Ledger.Utxo.html#2105" class="InductiveConstructor">DRepDeposit</a>        <a id="2124" class="Symbol">:</a> <a id="2126" href="Ledger.Address.html#713" class="Function">Credential</a>   <a id="2139" class="Symbol">→</a> <a id="2141" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a>
    <a id="2160" href="Ledger.Utxo.html#2160" class="InductiveConstructor">GovActionDeposit</a>   <a id="2179" class="Symbol">:</a> <a id="2181" href="Ledger.GovernanceActions.html#957" class="Function">GovActionID</a>  <a id="2194" class="Symbol">→</a> <a id="2196" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a>

  <a id="2214" href="Ledger.Utxo.html#2214" class="Function">certDeposit</a> <a id="2226" class="Symbol">:</a> <a id="2228" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="2236" class="Symbol">→</a> <a id="2238" href="Ledger.Deleg.html#354" class="Datatype">DCert</a> <a id="2244" class="Symbol">→</a> <a id="2246" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="2252" class="Symbol">(</a><a id="2253" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="2268" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="2270" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="2274" class="Symbol">)</a>
  <a id="2278" href="Ledger.Utxo.html#2214" class="Function">certDeposit</a> <a id="2290" class="Symbol">_</a>   <a id="2294" class="Symbol">(</a><a id="2295" href="Ledger.Deleg.html#374" class="InductiveConstructor">delegate</a> <a id="2304" href="Ledger.Utxo.html#2304" class="Bound">c</a> <a id="2306" class="Symbol">_</a> <a id="2308" class="Symbol">_</a> <a id="2310" href="Ledger.Utxo.html#2310" class="Bound">v</a><a id="2311" class="Symbol">)</a>  <a id="2314" class="Symbol">=</a> <a id="2316" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2321" class="Symbol">(</a><a id="2322" href="Ledger.Utxo.html#1995" class="InductiveConstructor">CredentialDeposit</a> <a id="2340" href="Ledger.Utxo.html#2304" class="Bound">c</a> <a id="2342" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2344" href="Ledger.Utxo.html#2310" class="Bound">v</a><a id="2345" class="Symbol">)</a>
  <a id="2349" href="Ledger.Utxo.html#2214" class="Function">certDeposit</a> <a id="2361" href="Ledger.Utxo.html#2361" class="Bound">pp</a>  <a id="2365" class="Symbol">(</a><a id="2366" href="Ledger.Deleg.html#450" class="InductiveConstructor">regpool</a> <a id="2374" href="Ledger.Utxo.html#2374" class="Bound">c</a> <a id="2376" class="Symbol">_)</a>       <a id="2385" class="Symbol">=</a> <a id="2387" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2392" class="Symbol">(</a><a id="2393" href="Ledger.Utxo.html#2050" class="InductiveConstructor">PoolDeposit</a>       <a id="2411" href="Ledger.Utxo.html#2374" class="Bound">c</a> <a id="2413" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2415" href="Ledger.Utxo.html#2361" class="Bound">pp</a> <a id="2418" class="Symbol">.</a><a id="2419" href="Ledger.PParams.html#1544" class="Field">poolDeposit</a><a id="2430" class="Symbol">)</a>
  <a id="2434" href="Ledger.Utxo.html#2214" class="Function">certDeposit</a> <a id="2446" class="Symbol">_</a>   <a id="2450" class="Symbol">(</a><a id="2451" href="Ledger.Deleg.html#541" class="InductiveConstructor">regdrep</a> <a id="2459" href="Ledger.Utxo.html#2459" class="Bound">c</a> <a id="2461" href="Ledger.Utxo.html#2461" class="Bound">v</a> <a id="2463" class="Symbol">_)</a>     <a id="2470" class="Symbol">=</a> <a id="2472" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2477" class="Symbol">(</a><a id="2478" href="Ledger.Utxo.html#2105" class="InductiveConstructor">DRepDeposit</a>       <a id="2496" href="Ledger.Utxo.html#2459" class="Bound">c</a> <a id="2498" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2500" href="Ledger.Utxo.html#2461" class="Bound">v</a><a id="2501" class="Symbol">)</a>
  <a id="2505" href="Ledger.Utxo.html#2214" class="CatchallClause Function">certDeposit</a><a id="2516" class="CatchallClause"> </a><a id="2517" class="CatchallClause Symbol">_</a><a id="2518" class="CatchallClause">   </a><a id="2521" class="CatchallClause Symbol">_</a>                   <a id="2541" class="Symbol">=</a> <a id="2543" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>

  <a id="2554" href="Ledger.Utxo.html#2554" class="Function">certDepositᵐ</a> <a id="2567" class="Symbol">:</a> <a id="2569" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="2577" class="Symbol">→</a> <a id="2579" href="Ledger.Deleg.html#354" class="Datatype">DCert</a> <a id="2585" class="Symbol">→</a> <a id="2587" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="2602" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="2604" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="2611" href="Ledger.Utxo.html#2554" class="Function">certDepositᵐ</a> <a id="2624" href="Ledger.Utxo.html#2624" class="Bound">pp</a> <a id="2627" href="Ledger.Utxo.html#2627" class="Bound">cert</a> <a id="2632" class="Symbol">=</a> <a id="2634" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="2639" href="Ledger.Utxo.html#2214" class="Function">certDeposit</a> <a id="2651" href="Ledger.Utxo.html#2624" class="Bound">pp</a> <a id="2654" href="Ledger.Utxo.html#2627" class="Bound">cert</a> <a id="2659" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="2662" class="Symbol">λ</a> <a id="2664" class="Keyword">where</a>
    <a id="2674" class="Symbol">(</a><a id="2675" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2680" class="Symbol">(</a><a id="2681" href="Ledger.Utxo.html#2681" class="Bound">p</a> <a id="2683" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2685" href="Ledger.Utxo.html#2685" class="Bound">v</a><a id="2686" class="Symbol">))</a>  <a id="2690" class="Symbol">→</a> <a id="2692" href="Axiom.Set.Map.html#4558" class="Function Operator">❴</a> <a id="2694" href="Ledger.Utxo.html#2681" class="Bound">p</a> <a id="2696" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2698" href="Ledger.Utxo.html#2685" class="Bound">v</a> <a id="2700" href="Axiom.Set.Map.html#4558" class="Function Operator">❵ᵐ</a>
    <a id="2707" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>         <a id="2723" class="Symbol">→</a> <a id="2725" href="Axiom.Set.Map.html#2741" class="Function">∅ᵐ</a>

  <a id="2731" href="Ledger.Utxo.html#2731" class="Function">propDepositᵐ</a> <a id="2744" class="Symbol">:</a> <a id="2746" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="2754" class="Symbol">→</a> <a id="2756" href="Ledger.GovernanceActions.html#957" class="Function">GovActionID</a> <a id="2768" class="Symbol">→</a> <a id="2770" href="Ledger.GovernanceActions.html#8542" class="Record">GovProposal</a> <a id="2782" class="Symbol">→</a> <a id="2784" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="2799" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="2801" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="2808" href="Ledger.Utxo.html#2731" class="Function">propDepositᵐ</a> <a id="2821" href="Ledger.Utxo.html#2821" class="Bound">pp</a> <a id="2824" href="Ledger.Utxo.html#2824" class="Bound">gaid</a> <a id="2829" class="Keyword">record</a> <a id="2836" class="Symbol">{</a> <a id="2838" href="Ledger.GovernanceActions.html#8574" class="Field">returnAddr</a> <a id="2849" class="Symbol">=</a> <a id="2851" class="Keyword">record</a> <a id="2858" class="Symbol">{</a> <a id="2860" href="Ledger.Address.html#1269" class="Field">stake</a> <a id="2866" class="Symbol">=</a> <a id="2868" href="Ledger.Utxo.html#2868" class="Bound">c</a> <a id="2870" class="Symbol">}</a> <a id="2872" class="Symbol">}</a>
    <a id="2878" class="Symbol">=</a> <a id="2880" href="Axiom.Set.Map.html#4558" class="Function Operator">❴</a> <a id="2882" href="Ledger.Utxo.html#2160" class="InductiveConstructor">GovActionDeposit</a> <a id="2899" href="Ledger.Utxo.html#2824" class="Bound">gaid</a> <a id="2904" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2906" href="Ledger.Utxo.html#2821" class="Bound">pp</a> <a id="2909" class="Symbol">.</a><a id="2910" href="Ledger.PParams.html#2043" class="Field">govActionDeposit</a> <a id="2927" href="Axiom.Set.Map.html#4558" class="Function Operator">❵ᵐ</a>

  <a id="2933" href="Ledger.Utxo.html#2933" class="Function">certRefund</a> <a id="2944" class="Symbol">:</a> <a id="2946" href="Ledger.Deleg.html#354" class="Datatype">DCert</a> <a id="2952" class="Symbol">→</a> <a id="2954" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="2960" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a>
  <a id="2977" href="Ledger.Utxo.html#2933" class="Function">certRefund</a> <a id="2988" class="Symbol">(</a><a id="2989" href="Ledger.Deleg.html#374" class="InductiveConstructor">delegate</a> <a id="2998" href="Ledger.Utxo.html#2998" class="Bound">c</a> <a id="3000" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="3008" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="3016" href="Ledger.Utxo.html#3016" class="Bound">x</a><a id="3017" class="Symbol">)</a>  <a id="3020" class="Symbol">=</a> <a id="3022" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3027" class="Symbol">(</a><a id="3028" href="Ledger.Utxo.html#1995" class="InductiveConstructor">CredentialDeposit</a> <a id="3046" href="Ledger.Utxo.html#2998" class="Bound">c</a><a id="3047" class="Symbol">)</a>
  <a id="3051" href="Ledger.Utxo.html#2933" class="Function">certRefund</a> <a id="3062" class="Symbol">(</a><a id="3063" href="Ledger.Deleg.html#592" class="InductiveConstructor">deregdrep</a> <a id="3073" href="Ledger.Utxo.html#3073" class="Bound">c</a><a id="3074" class="Symbol">)</a>                   <a id="3094" class="Symbol">=</a> <a id="3096" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3101" class="Symbol">(</a><a id="3102" href="Ledger.Utxo.html#2105" class="InductiveConstructor">DRepDeposit</a>       <a id="3120" href="Ledger.Utxo.html#3073" class="Bound">c</a><a id="3121" class="Symbol">)</a>
  <a id="3125" href="Ledger.Utxo.html#2933" class="CatchallClause Function">certRefund</a><a id="3135" class="CatchallClause"> </a><a id="3136" class="CatchallClause Symbol">_</a>                               <a id="3168" class="Symbol">=</a> <a id="3170" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>

  <a id="3181" href="Ledger.Utxo.html#3181" class="Function">certRefundˢ</a> <a id="3193" class="Symbol">:</a> <a id="3195" href="Ledger.Deleg.html#354" class="Datatype">DCert</a> <a id="3201" class="Symbol">→</a> <a id="3203" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="3205" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a>
  <a id="3222" href="Ledger.Utxo.html#3181" class="Function">certRefundˢ</a> <a id="3234" class="Symbol">=</a> <a id="3236" href="Axiom.Set.html#6275" class="Function">partialToSet</a> <a id="3249" href="Ledger.Utxo.html#2933" class="Function">certRefund</a>

  <a id="3263" class="Comment">-- this has to be a type definition for inference to work</a>
  <a id="3323" class="Keyword">data</a> <a id="3328" href="Ledger.Utxo.html#3328" class="Datatype">inInterval</a> <a id="3339" class="Symbol">(</a><a id="3340" href="Ledger.Utxo.html#3340" class="Bound">slot</a> <a id="3345" class="Symbol">:</a> <a id="3347" href="Ledger.Epoch.html#548" class="Function">Slot</a><a id="3351" class="Symbol">)</a> <a id="3353" class="Symbol">:</a> <a id="3355" class="Symbol">(</a><a id="3356" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3362" href="Ledger.Epoch.html#548" class="Function">Slot</a> <a id="3367" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3369" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="3375" href="Ledger.Epoch.html#548" class="Function">Slot</a><a id="3379" class="Symbol">)</a> <a id="3381" class="Symbol">→</a> <a id="3383" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3387" class="Keyword">where</a>
    <a id="3397" href="Ledger.Utxo.html#3397" class="InductiveConstructor">both</a>   <a id="3404" class="Symbol">:</a> <a id="3406" class="Symbol">∀</a> <a id="3408" class="Symbol">{</a><a id="3409" href="Ledger.Utxo.html#3409" class="Bound">l</a> <a id="3411" href="Ledger.Utxo.html#3411" class="Bound">r</a><a id="3412" class="Symbol">}</a>  <a id="3415" class="Symbol">→</a> <a id="3417" href="Ledger.Utxo.html#3409" class="Bound">l</a> <a id="3419" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="3421" href="Ledger.Utxo.html#3340" class="Bound">slot</a> <a id="3426" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="3428" href="Ledger.Utxo.html#3340" class="Bound">slot</a> <a id="3433" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="3435" href="Ledger.Utxo.html#3411" class="Bound">r</a>  <a id="3438" class="Symbol">→</a>  <a id="3441" href="Ledger.Utxo.html#3328" class="Datatype">inInterval</a> <a id="3452" href="Ledger.Utxo.html#3340" class="Bound">slot</a> <a id="3457" class="Symbol">(</a><a id="3458" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3463" href="Ledger.Utxo.html#3409" class="Bound">l</a>   <a id="3467" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3469" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3474" href="Ledger.Utxo.html#3411" class="Bound">r</a><a id="3475" class="Symbol">)</a>
    <a id="3481" href="Ledger.Utxo.html#3481" class="InductiveConstructor">lower</a>  <a id="3488" class="Symbol">:</a> <a id="3490" class="Symbol">∀</a> <a id="3492" class="Symbol">{</a><a id="3493" href="Ledger.Utxo.html#3493" class="Bound">l</a><a id="3494" class="Symbol">}</a>    <a id="3499" class="Symbol">→</a> <a id="3501" href="Ledger.Utxo.html#3493" class="Bound">l</a> <a id="3503" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="3505" href="Ledger.Utxo.html#3340" class="Bound">slot</a>             <a id="3522" class="Symbol">→</a>  <a id="3525" href="Ledger.Utxo.html#3328" class="Datatype">inInterval</a> <a id="3536" href="Ledger.Utxo.html#3340" class="Bound">slot</a> <a id="3541" class="Symbol">(</a><a id="3542" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3547" href="Ledger.Utxo.html#3493" class="Bound">l</a>   <a id="3551" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3553" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="3560" class="Symbol">)</a>
    <a id="3566" href="Ledger.Utxo.html#3566" class="InductiveConstructor">upper</a>  <a id="3573" class="Symbol">:</a> <a id="3575" class="Symbol">∀</a> <a id="3577" class="Symbol">{</a><a id="3578" href="Ledger.Utxo.html#3578" class="Bound">r</a><a id="3579" class="Symbol">}</a>    <a id="3584" class="Symbol">→</a> <a id="3586" href="Ledger.Utxo.html#3340" class="Bound">slot</a> <a id="3591" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="3593" href="Ledger.Utxo.html#3578" class="Bound">r</a>             <a id="3607" class="Symbol">→</a>  <a id="3610" href="Ledger.Utxo.html#3328" class="Datatype">inInterval</a> <a id="3621" href="Ledger.Utxo.html#3340" class="Bound">slot</a> <a id="3626" class="Symbol">(</a><a id="3627" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>  <a id="3636" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3638" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3643" href="Ledger.Utxo.html#3578" class="Bound">r</a><a id="3644" class="Symbol">)</a>
    <a id="3650" href="Ledger.Utxo.html#3650" class="InductiveConstructor">none</a>   <a id="3657" class="Symbol">:</a>                                    <a id="3694" href="Ledger.Utxo.html#3328" class="Datatype">inInterval</a> <a id="3705" href="Ledger.Utxo.html#3340" class="Bound">slot</a> <a id="3710" class="Symbol">(</a><a id="3711" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>  <a id="3720" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3722" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="3729" class="Symbol">)</a>

<a id="3732" class="Markup">\end{code}</a><a id="3742" class="Background">
</a><a id="3743" class="Markup">\begin{code}[hide]</a>
<a id="3762" class="Keyword">instance</a>
  <a id="3773" class="Keyword">unquoteDecl</a> <a id="DecEq-DepositPurpose"></a><a id="3785" href="Ledger.Utxo.html#3785" class="Function">DecEq-DepositPurpose</a> <a id="3806" class="Symbol">=</a> <a id="3808" href="Tactic.Derive.DecEq.html#3471" class="Function">derive-DecEq</a>
    <a id="3825" class="Symbol">((</a><a id="3827" class="Keyword">quote</a> <a id="3833" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="3848" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3850" href="Ledger.Utxo.html#3785" class="Function">DecEq-DepositPurpose</a><a id="3870" class="Symbol">)</a> <a id="3872" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3874" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3876" class="Symbol">)</a>

  <a id="HasCoin-UTxO"></a><a id="3881" href="Ledger.Utxo.html#3881" class="Function">HasCoin-UTxO</a> <a id="3894" class="Symbol">:</a> <a id="3896" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="3904" href="Ledger.Transaction.html#2976" class="Function">UTxO</a>
  <a id="3911" href="Ledger.Utxo.html#3881" class="Function">HasCoin-UTxO</a> <a id="3924" class="Symbol">.</a><a id="3925" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="3933" class="Symbol">=</a> <a id="3935" href="Ledger.Utxo.html#1815" class="Function">cbalance</a>
<a id="3944" class="Markup">\end{code}</a><a id="3954" class="Background">

\caption{Functions used in UTxO rules}
\label{fig:functions:utxo}
\end{figure*}

\AgdaTarget{UTxOEnv, UTxOState, \_⊢\_⇀⦇\_,UTXO⦈\_}
\begin{figure*}[h]
\emph{Derived types}
</a><a id="4128" class="Markup">\begin{code}</a>
<a id="Deposits"></a><a id="4141" href="Ledger.Utxo.html#4141" class="Function">Deposits</a> <a id="4150" class="Symbol">=</a> <a id="4152" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="4167" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="4169" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="4174" class="Markup">\end{code}</a><a id="4184" class="Background">
\emph{UTxO environment}
</a><a id="4209" class="Markup">\begin{code}</a>
<a id="4222" class="Keyword">record</a> <a id="UTxOEnv"></a><a id="4229" href="Ledger.Utxo.html#4229" class="Record">UTxOEnv</a> <a id="4237" class="Symbol">:</a> <a id="4239" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4243" class="Keyword">where</a>
  <a id="4251" class="Keyword">field</a> <a id="UTxOEnv.slot"></a><a id="4257" href="Ledger.Utxo.html#4257" class="Field">slot</a>     <a id="4266" class="Symbol">:</a> <a id="4268" href="Ledger.Epoch.html#548" class="Function">Slot</a>
        <a id="UTxOEnv.ppolicy"></a><a id="4281" href="Ledger.Utxo.html#4281" class="Field">ppolicy</a>  <a id="4290" class="Symbol">:</a> <a id="4292" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4298" href="Ledger.Crypto.html#1632" class="Function">ScriptHash</a>
        <a id="UTxOEnv.pparams"></a><a id="4317" href="Ledger.Utxo.html#4317" class="Field">pparams</a>  <a id="4326" class="Symbol">:</a> <a id="4328" href="Ledger.PParams.html#1022" class="Record">PParams</a>
<a id="4336" class="Markup">\end{code}</a><a id="4346" class="Background">
\emph{UTxO states}
</a><a id="4366" class="Markup">\begin{code}</a>
<a id="4379" class="Keyword">record</a> <a id="UTxOState"></a><a id="4386" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a> <a id="4396" class="Symbol">:</a> <a id="4398" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4402" class="Keyword">where</a>
  <a id="4410" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ᵘ"></a><a id="4422" href="Ledger.Utxo.html#4422" class="InductiveConstructor Operator">⟦_,_,_,_⟧ᵘ</a>
  <a id="4435" class="Keyword">field</a> <a id="UTxOState.utxo"></a><a id="4441" href="Ledger.Utxo.html#4441" class="Field">utxo</a>       <a id="4452" class="Symbol">:</a> <a id="4454" href="Ledger.Transaction.html#2976" class="Function">UTxO</a>
        <a id="UTxOState.fees"></a><a id="4467" href="Ledger.Utxo.html#4467" class="Field">fees</a>       <a id="4478" class="Symbol">:</a> <a id="4480" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
        <a id="UTxOState.deposits"></a><a id="4493" href="Ledger.Utxo.html#4493" class="Field">deposits</a>   <a id="4504" class="Symbol">:</a> <a id="4506" href="Ledger.Utxo.html#4141" class="Function">Deposits</a>
        <a id="UTxOState.donations"></a><a id="4523" href="Ledger.Utxo.html#4523" class="Field">donations</a>  <a id="4534" class="Symbol">:</a> <a id="4536" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="4541" class="Markup">\end{code}</a><a id="4551" class="Background">
\emph{UTxO transitions}

</a><a id="4577" class="Markup">\begin{code}[hide]</a>
<a id="⟦_⟧"></a><a id="4596" href="Ledger.Utxo.html#4596" class="Function Operator">⟦_⟧</a> <a id="4600" class="Symbol">:</a> <a id="4602" class="Symbol">{</a><a id="4603" href="Ledger.Utxo.html#4603" class="Bound">A</a> <a id="4605" class="Symbol">:</a> <a id="4607" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="4610" class="Symbol">}</a> <a id="4612" class="Symbol">→</a> <a id="4614" href="Ledger.Utxo.html#4603" class="Bound">A</a> <a id="4616" class="Symbol">→</a> <a id="4618" href="Ledger.Utxo.html#4603" class="Bound">A</a>
<a id="4620" href="Ledger.Utxo.html#4596" class="Function Operator">⟦_⟧</a> <a id="4624" class="Symbol">=</a> <a id="4626" href="Function.Base.html#695" class="Function">id</a>

<a id="4630" class="Keyword">open</a> <a id="4635" href="Interface.HasOrder.html#658" class="Module">HasDecPartialOrder</a> <a id="4654" class="Symbol">⦃</a> <a id="4656" class="Symbol">...</a> <a id="4660" class="Symbol">⦄</a>
<a id="4662" class="Keyword">instance</a>
  <a id="netId?"></a><a id="4673" href="Ledger.Utxo.html#4673" class="Function">netId?</a> <a id="4680" class="Symbol">:</a> <a id="4682" class="Symbol">∀</a> <a id="4684" class="Symbol">{</a><a id="4685" href="Ledger.Utxo.html#4685" class="Bound">A</a> <a id="4687" class="Symbol">:</a> <a id="4689" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="4692" class="Symbol">}</a> <a id="4694" class="Symbol">{</a><a id="4695" href="Ledger.Utxo.html#4695" class="Bound">networkId</a> <a id="4705" class="Symbol">:</a> <a id="4707" href="Ledger.Epoch.html#3648" class="Function">Network</a><a id="4714" class="Symbol">}</a> <a id="4716" class="Symbol">{</a><a id="4717" href="Ledger.Utxo.html#4717" class="Bound">f</a> <a id="4719" class="Symbol">:</a> <a id="4721" href="Ledger.Utxo.html#4685" class="Bound">A</a> <a id="4723" class="Symbol">→</a> <a id="4725" href="Ledger.Epoch.html#3648" class="Function">Network</a><a id="4732" class="Symbol">}</a>
    <a id="4738" class="Symbol">→</a> <a id="4740" href="Interface.Decidable.Instance.html#655" class="Record">Dec₁</a> <a id="4745" class="Symbol">(λ</a> <a id="4748" href="Ledger.Utxo.html#4748" class="Bound">a</a> <a id="4750" class="Symbol">→</a> <a id="4752" href="Ledger.Utxo.html#4717" class="Bound">f</a> <a id="4754" href="Ledger.Utxo.html#4748" class="Bound">a</a> <a id="4756" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4758" href="Ledger.Utxo.html#4695" class="Bound">networkId</a><a id="4767" class="Symbol">)</a>
  <a id="4771" href="Ledger.Utxo.html#4673" class="Function">netId?</a> <a id="4778" class="Symbol">{_}</a> <a id="4782" class="Symbol">{</a><a id="4783" href="Ledger.Utxo.html#4783" class="Bound">networkId</a><a id="4792" class="Symbol">}</a> <a id="4794" class="Symbol">{</a><a id="4795" href="Ledger.Utxo.html#4795" class="Bound">f</a><a id="4796" class="Symbol">}</a> <a id="4798" class="Symbol">.</a><a id="4799" href="Interface.Decidable.Instance.html#720" class="Field">Dec₁.P?</a> <a id="4807" href="Ledger.Utxo.html#4807" class="Bound">a</a> <a id="4809" class="Symbol">=</a> <a id="4811" href="Ledger.Utxo.html#4795" class="Bound">f</a> <a id="4813" href="Ledger.Utxo.html#4807" class="Bound">a</a> <a id="4815" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="4817" href="Ledger.Utxo.html#4783" class="Bound">networkId</a>

  <a id="Dec-inInterval"></a><a id="4830" href="Ledger.Utxo.html#4830" class="Function">Dec-inInterval</a> <a id="4845" class="Symbol">:</a> <a id="4847" class="Symbol">{</a><a id="4848" href="Ledger.Utxo.html#4848" class="Bound">slot</a> <a id="4853" class="Symbol">:</a> <a id="4855" href="Ledger.Epoch.html#548" class="Function">Slot</a><a id="4859" class="Symbol">}</a> <a id="4861" class="Symbol">{</a><a id="4862" href="Ledger.Utxo.html#4862" class="Bound">I</a> <a id="4864" class="Symbol">:</a> <a id="4866" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4872" href="Ledger.Epoch.html#548" class="Function">Slot</a> <a id="4877" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="4879" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4885" href="Ledger.Epoch.html#548" class="Function">Slot</a><a id="4889" class="Symbol">}</a> <a id="4891" class="Symbol">→</a> <a id="4893" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="4897" class="Symbol">(</a><a id="4898" href="Ledger.Utxo.html#3328" class="Datatype">inInterval</a> <a id="4909" href="Ledger.Utxo.html#4848" class="Bound">slot</a> <a id="4914" href="Ledger.Utxo.html#4862" class="Bound">I</a><a id="4915" class="Symbol">)</a>
  <a id="4919" href="Ledger.Utxo.html#4830" class="Function">Dec-inInterval</a> <a id="4934" class="Symbol">{</a><a id="4935" href="Ledger.Utxo.html#4935" class="Bound">slot</a><a id="4939" class="Symbol">}</a> <a id="4941" class="Symbol">{</a><a id="4942" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4947" href="Ledger.Utxo.html#4947" class="Bound">x</a>  <a id="4950" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4952" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4957" href="Ledger.Utxo.html#4957" class="Bound">y</a> <a id="4959" class="Symbol">}</a> <a id="4961" class="Keyword">with</a> <a id="4966" href="Ledger.Utxo.html#4947" class="Bound">x</a> <a id="4968" href="Interface.HasOrder.html#779" class="Field Operator">≤?</a> <a id="4971" href="Ledger.Utxo.html#4935" class="Bound">slot</a> <a id="4976" class="Symbol">|</a> <a id="4978" href="Ledger.Utxo.html#4935" class="Bound">slot</a> <a id="4983" href="Interface.HasOrder.html#779" class="Field Operator">≤?</a> <a id="4986" href="Ledger.Utxo.html#4957" class="Bound">y</a>
  <a id="4990" class="Symbol">...</a> <a id="4994" class="Symbol">|</a> <a id="4996" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="4999" href="Ledger.Utxo.html#4999" class="Bound">¬p₁</a> <a id="5003" class="Symbol">|</a> <a id="5005" class="Symbol">_</a>      <a id="5012" class="Symbol">=</a> <a id="5014" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5017" class="Symbol">λ</a> <a id="5019" class="Keyword">where</a> <a id="5025" class="Symbol">(</a><a id="5026" href="Ledger.Utxo.html#3397" class="InductiveConstructor">both</a> <a id="5031" class="Symbol">(</a><a id="5032" href="Ledger.Utxo.html#5032" class="Bound">h₁</a> <a id="5035" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5037" href="Ledger.Utxo.html#5037" class="Bound">h₂</a><a id="5039" class="Symbol">))</a> <a id="5042" class="Symbol">→</a> <a id="5044" href="Ledger.Utxo.html#4999" class="Bound">¬p₁</a> <a id="5048" href="Ledger.Utxo.html#5032" class="Bound">h₁</a>
  <a id="5053" class="Symbol">...</a> <a id="5057" class="Symbol">|</a> <a id="5059" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5063" href="Ledger.Utxo.html#5063" class="Bound">p₁</a> <a id="5066" class="Symbol">|</a> <a id="5068" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5071" href="Ledger.Utxo.html#5071" class="Bound">¬p₂</a> <a id="5075" class="Symbol">=</a> <a id="5077" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5080" class="Symbol">λ</a> <a id="5082" class="Keyword">where</a> <a id="5088" class="Symbol">(</a><a id="5089" href="Ledger.Utxo.html#3397" class="InductiveConstructor">both</a> <a id="5094" class="Symbol">(</a><a id="5095" href="Ledger.Utxo.html#5095" class="Bound">h₁</a> <a id="5098" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5100" href="Ledger.Utxo.html#5100" class="Bound">h₂</a><a id="5102" class="Symbol">))</a> <a id="5105" class="Symbol">→</a> <a id="5107" href="Ledger.Utxo.html#5071" class="Bound">¬p₂</a> <a id="5111" href="Ledger.Utxo.html#5100" class="Bound">h₂</a>
  <a id="5116" class="Symbol">...</a> <a id="5120" class="Symbol">|</a> <a id="5122" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5126" href="Ledger.Utxo.html#5126" class="Bound">p₁</a> <a id="5129" class="Symbol">|</a> <a id="5131" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5135" href="Ledger.Utxo.html#5135" class="Bound">p₂</a> <a id="5138" class="Symbol">=</a> <a id="5140" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5144" class="Symbol">(</a><a id="5145" href="Ledger.Utxo.html#3397" class="InductiveConstructor">both</a> <a id="5150" class="Symbol">(</a><a id="5151" href="Ledger.Utxo.html#5126" class="Bound">p₁</a> <a id="5154" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5156" href="Ledger.Utxo.html#5135" class="Bound">p₂</a><a id="5158" class="Symbol">))</a>
  <a id="5163" href="Ledger.Utxo.html#4830" class="Function">Dec-inInterval</a> <a id="5178" class="Symbol">{</a><a id="5179" href="Ledger.Utxo.html#5179" class="Bound">slot</a><a id="5183" class="Symbol">}</a> <a id="5185" class="Symbol">{</a><a id="5186" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5191" href="Ledger.Utxo.html#5191" class="Bound">x</a>  <a id="5194" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5196" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="5203" class="Symbol">}</a> <a id="5205" class="Keyword">with</a> <a id="5210" href="Ledger.Utxo.html#5191" class="Bound">x</a> <a id="5212" href="Interface.HasOrder.html#779" class="Field Operator">≤?</a> <a id="5215" href="Ledger.Utxo.html#5179" class="Bound">slot</a>
  <a id="5222" class="Symbol">...</a> <a id="5226" class="Symbol">|</a> <a id="5228" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5231" href="Ledger.Utxo.html#5231" class="Bound">¬p</a> <a id="5234" class="Symbol">=</a> <a id="5236" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a>  <a id="5240" class="Symbol">(λ</a> <a id="5243" class="Keyword">where</a> <a id="5249" class="Symbol">(</a><a id="5250" href="Ledger.Utxo.html#3481" class="InductiveConstructor">lower</a> <a id="5256" href="Ledger.Utxo.html#5256" class="Bound">h</a><a id="5257" class="Symbol">)</a> <a id="5259" class="Symbol">→</a> <a id="5261" href="Ledger.Utxo.html#5231" class="Bound">¬p</a> <a id="5264" href="Ledger.Utxo.html#5256" class="Bound">h</a><a id="5265" class="Symbol">)</a>
  <a id="5269" class="Symbol">...</a> <a id="5273" class="Symbol">|</a> <a id="5275" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5279" href="Ledger.Utxo.html#5279" class="Bound">p</a> <a id="5281" class="Symbol">=</a> <a id="5283" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5287" class="Symbol">(</a><a id="5288" href="Ledger.Utxo.html#3481" class="InductiveConstructor">lower</a> <a id="5294" href="Ledger.Utxo.html#5279" class="Bound">p</a><a id="5295" class="Symbol">)</a>
  <a id="5299" href="Ledger.Utxo.html#4830" class="Function">Dec-inInterval</a> <a id="5314" class="Symbol">{</a><a id="5315" href="Ledger.Utxo.html#5315" class="Bound">slot</a><a id="5319" class="Symbol">}</a> <a id="5321" class="Symbol">{</a><a id="5322" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="5330" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5332" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5337" href="Ledger.Utxo.html#5337" class="Bound">x</a> <a id="5339" class="Symbol">}</a> <a id="5341" class="Keyword">with</a> <a id="5346" href="Ledger.Utxo.html#5315" class="Bound">slot</a> <a id="5351" href="Interface.HasOrder.html#779" class="Field Operator">≤?</a> <a id="5354" href="Ledger.Utxo.html#5337" class="Bound">x</a>
  <a id="5358" class="Symbol">...</a> <a id="5362" class="Symbol">|</a> <a id="5364" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="5367" href="Ledger.Utxo.html#5367" class="Bound">¬p</a> <a id="5370" class="Symbol">=</a> <a id="5372" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a>  <a id="5376" class="Symbol">(λ</a> <a id="5379" class="Keyword">where</a> <a id="5385" class="Symbol">(</a><a id="5386" href="Ledger.Utxo.html#3566" class="InductiveConstructor">upper</a> <a id="5392" href="Ledger.Utxo.html#5392" class="Bound">h</a><a id="5393" class="Symbol">)</a> <a id="5395" class="Symbol">→</a> <a id="5397" href="Ledger.Utxo.html#5367" class="Bound">¬p</a> <a id="5400" href="Ledger.Utxo.html#5392" class="Bound">h</a><a id="5401" class="Symbol">)</a>
  <a id="5405" class="Symbol">...</a> <a id="5409" class="Symbol">|</a> <a id="5411" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5415" href="Ledger.Utxo.html#5415" class="Bound">p</a> <a id="5417" class="Symbol">=</a> <a id="5419" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5423" class="Symbol">(</a><a id="5424" href="Ledger.Utxo.html#3566" class="InductiveConstructor">upper</a> <a id="5430" href="Ledger.Utxo.html#5415" class="Bound">p</a><a id="5431" class="Symbol">)</a>
  <a id="5435" href="Ledger.Utxo.html#4830" class="Function">Dec-inInterval</a> <a id="5450" class="Symbol">{</a><a id="5451" href="Ledger.Utxo.html#5451" class="Bound">slot</a><a id="5455" class="Symbol">}</a> <a id="5457" class="Symbol">{</a><a id="5458" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="5466" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5468" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="5475" class="Symbol">}</a> <a id="5477" class="Symbol">=</a> <a id="5479" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="5483" href="Ledger.Utxo.html#3650" class="InductiveConstructor">none</a>

  <a id="HasCoin-UTxOState"></a><a id="5491" href="Ledger.Utxo.html#5491" class="Function">HasCoin-UTxOState</a> <a id="5509" class="Symbol">:</a> <a id="5511" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="5519" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a>
  <a id="5531" href="Ledger.Utxo.html#5491" class="Function">HasCoin-UTxOState</a> <a id="5549" class="Symbol">.</a><a id="5550" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="5558" href="Ledger.Utxo.html#5558" class="Bound">s</a> <a id="5560" class="Symbol">=</a> <a id="5562" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="5570" class="Symbol">(</a><a id="5571" href="Ledger.Utxo.html#4441" class="Field">UTxOState.utxo</a> <a id="5586" href="Ledger.Utxo.html#5558" class="Bound">s</a><a id="5587" class="Symbol">)</a>
                               <a id="5620" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="5622" class="Symbol">(</a><a id="5623" href="Ledger.Utxo.html#4467" class="Field">UTxOState.fees</a> <a id="5638" href="Ledger.Utxo.html#5558" class="Bound">s</a><a id="5639" class="Symbol">)</a>
                               <a id="5672" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="5674" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="5682" class="Symbol">(</a><a id="5683" href="Ledger.Utxo.html#4493" class="Field">UTxOState.deposits</a> <a id="5702" href="Ledger.Utxo.html#5558" class="Bound">s</a><a id="5703" class="Symbol">)</a>
                               <a id="5736" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="5738" href="Ledger.Utxo.html#4523" class="Field">UTxOState.donations</a> <a id="5758" href="Ledger.Utxo.html#5558" class="Bound">s</a>
<a id="5760" class="Keyword">data</a>
<a id="5765" class="Markup">\end{code}</a><a id="5775" class="Background">
</a><a id="5776" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXO⦈_"></a><a id="5791" href="Ledger.Utxo.html#5791" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a> <a id="5805" class="Symbol">:</a> <a id="5807" href="Ledger.Utxo.html#4229" class="Record">UTxOEnv</a> <a id="5815" class="Symbol">→</a> <a id="5817" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a> <a id="5827" class="Symbol">→</a> <a id="5829" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="5836" class="Symbol">→</a> <a id="5838" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a> <a id="5848" class="Symbol">→</a> <a id="5850" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="5854" class="Markup">\end{code}</a><a id="5864" class="Background">
\caption{UTxO transition-system types}
\label{fig:ts-types:utxo-shelley}
\end{figure*}

\begin{figure*}
</a><a id="5969" class="Markup">\begin{code}[hide]</a>
<a id="5988" class="Keyword">module</a> <a id="5995" href="Ledger.Utxo.html#5995" class="Module">_</a> <a id="5997" class="Symbol">(</a><a id="5998" class="Keyword">let</a> <a id="6002" class="Keyword">open</a> <a id="6007" href="Ledger.Utxo.html#4386" class="Module">UTxOState</a><a id="6016" class="Symbol">;</a> <a id="6018" class="Keyword">open</a> <a id="6023" href="Ledger.Transaction.html#3346" class="Module">TxBody</a><a id="6029" class="Symbol">)</a> <a id="6031" class="Keyword">where</a>
<a id="6037" class="Markup">\end{code}</a><a id="6047" class="Background">
</a><a id="6048" class="Markup">\begin{code}</a>
  <a id="6063" href="Ledger.Utxo.html#6063" class="Function">updateCertDeposits</a> <a id="6082" class="Symbol">:</a> <a id="6084" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="6092" class="Symbol">→</a> <a id="6094" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="6099" href="Ledger.Deleg.html#354" class="Datatype">DCert</a> <a id="6105" class="Symbol">→</a> <a id="6107" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="6122" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="6124" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="6133" class="Symbol">→</a> <a id="6135" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="6150" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="6152" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6159" href="Ledger.Utxo.html#6063" class="Function">updateCertDeposits</a> <a id="6178" href="Ledger.Utxo.html#6178" class="Bound">pp</a> <a id="6181" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="6184" href="Ledger.Utxo.html#6184" class="Bound">deposits</a> <a id="6193" class="Symbol">=</a> <a id="6195" href="Ledger.Utxo.html#6184" class="Bound">deposits</a>
  <a id="6206" href="Ledger.Utxo.html#6063" class="Function">updateCertDeposits</a> <a id="6225" href="Ledger.Utxo.html#6225" class="Bound">pp</a> <a id="6228" class="Symbol">(</a><a id="6229" href="Ledger.Utxo.html#6229" class="Bound">cert</a> <a id="6234" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6236" href="Ledger.Utxo.html#6236" class="Bound">certs</a><a id="6241" class="Symbol">)</a> <a id="6243" href="Ledger.Utxo.html#6243" class="Bound">deposits</a>
    <a id="6256" class="Symbol">=</a>  <a id="6259" href="Ledger.Utxo.html#6063" class="Function">updateCertDeposits</a> <a id="6278" href="Ledger.Utxo.html#6225" class="Bound">pp</a> <a id="6281" href="Ledger.Utxo.html#6236" class="Bound">certs</a> <a id="6287" href="Ledger.Utxo.html#6243" class="Bound">deposits</a> <a id="6296" href="Axiom.Set.Map.Dec.html#1841" class="Function Operator">∪⁺</a> <a id="6299" href="Ledger.Utxo.html#2554" class="Function">certDepositᵐ</a> <a id="6312" href="Ledger.Utxo.html#6225" class="Bound">pp</a> <a id="6315" href="Ledger.Utxo.html#6229" class="Bound">cert</a>
    <a id="6324" href="Axiom.Set.Map.html#8830" class="Function Operator">∣</a>  <a id="6327" href="Ledger.Utxo.html#3181" class="Function">certRefundˢ</a> <a id="6339" href="Ledger.Utxo.html#6229" class="Bound">cert</a> <a id="6344" href="Axiom.Set.Map.html#8830" class="Function Operator">ᶜ</a>

  <a id="6349" href="Ledger.Utxo.html#6349" class="Function">updateProposalDeposits</a> <a id="6372" class="Symbol">:</a> <a id="6374" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="6382" class="Symbol">→</a> <a id="6384" href="Ledger.Transaction.html#1520" class="Field">TxId</a> <a id="6389" class="Symbol">→</a> <a id="6391" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="6396" href="Ledger.GovernanceActions.html#8542" class="Record">GovProposal</a> <a id="6408" class="Symbol">→</a> <a id="6410" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="6425" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="6427" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="6436" class="Symbol">→</a> <a id="6438" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="6453" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="6455" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6462" href="Ledger.Utxo.html#6349" class="Function">updateProposalDeposits</a> <a id="6485" href="Ledger.Utxo.html#6485" class="Bound">pp</a> <a id="6488" href="Ledger.Utxo.html#6488" class="Bound">txid</a> <a id="6493" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="6496" href="Ledger.Utxo.html#6496" class="Bound">deposits</a> <a id="6505" class="Symbol">=</a> <a id="6507" href="Ledger.Utxo.html#6496" class="Bound">deposits</a>
  <a id="6518" href="Ledger.Utxo.html#6349" class="Function">updateProposalDeposits</a> <a id="6541" href="Ledger.Utxo.html#6541" class="Bound">pp</a> <a id="6544" href="Ledger.Utxo.html#6544" class="Bound">txid</a> <a id="6549" class="Symbol">(</a><a id="6550" href="Ledger.Utxo.html#6550" class="Bound">prop</a> <a id="6555" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6557" href="Ledger.Utxo.html#6557" class="Bound">props</a><a id="6562" class="Symbol">)</a> <a id="6564" href="Ledger.Utxo.html#6564" class="Bound">deposits</a>
    <a id="6577" class="Symbol">=</a>   <a id="6581" href="Ledger.Utxo.html#6349" class="Function">updateProposalDeposits</a> <a id="6604" href="Ledger.Utxo.html#6541" class="Bound">pp</a> <a id="6607" href="Ledger.Utxo.html#6544" class="Bound">txid</a> <a id="6612" href="Ledger.Utxo.html#6557" class="Bound">props</a> <a id="6618" href="Ledger.Utxo.html#6564" class="Bound">deposits</a>
    <a id="6631" href="Axiom.Set.Map.Dec.html#1841" class="Function Operator">∪⁺</a>  <a id="6635" href="Ledger.Utxo.html#2731" class="Function">propDepositᵐ</a> <a id="6648" href="Ledger.Utxo.html#6541" class="Bound">pp</a> <a id="6651" class="Symbol">(</a><a id="6652" href="Ledger.Utxo.html#6544" class="Bound">txid</a> <a id="6657" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6659" href="Data.List.Base.html#5058" class="Function">length</a> <a id="6666" href="Ledger.Utxo.html#6557" class="Bound">props</a><a id="6671" class="Symbol">)</a> <a id="6673" href="Ledger.Utxo.html#6550" class="Bound">prop</a>

  <a id="6681" href="Ledger.Utxo.html#6681" class="Function">updateDeposits</a> <a id="6696" class="Symbol">:</a> <a id="6698" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="6706" class="Symbol">→</a> <a id="6708" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="6715" class="Symbol">→</a> <a id="6717" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="6732" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="6734" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="6739" class="Symbol">→</a> <a id="6741" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="6756" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="6758" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6765" href="Ledger.Utxo.html#6681" class="Function">updateDeposits</a> <a id="6780" href="Ledger.Utxo.html#6780" class="Bound">pp</a> <a id="6783" href="Ledger.Utxo.html#6783" class="Bound">txb</a>
    <a id="6791" class="Symbol">=</a>  <a id="6794" href="Ledger.Utxo.html#6063" class="Function">updateCertDeposits</a> <a id="6813" href="Ledger.Utxo.html#6780" class="Bound">pp</a> <a id="6816" class="Symbol">(</a><a id="6817" href="Ledger.Utxo.html#6783" class="Bound">txb</a> <a id="6821" class="Symbol">.</a><a id="6822" href="Ledger.Transaction.html#3548" class="Field">txcerts</a><a id="6829" class="Symbol">)</a>
    <a id="6835" href="Function.Base.html#1106" class="Function Operator">∘</a>  <a id="6838" href="Ledger.Utxo.html#6349" class="Function">updateProposalDeposits</a> <a id="6861" href="Ledger.Utxo.html#6780" class="Bound">pp</a> <a id="6864" class="Symbol">(</a><a id="6865" href="Ledger.Utxo.html#6783" class="Bound">txb</a> <a id="6869" class="Symbol">.</a><a id="6870" href="Ledger.Transaction.html#3857" class="Field">txid</a><a id="6874" class="Symbol">)</a> <a id="6876" class="Symbol">(</a><a id="6877" href="Ledger.Utxo.html#6783" class="Bound">txb</a> <a id="6881" class="Symbol">.</a><a id="6882" href="Ledger.Transaction.html#3649" class="Field">txprop</a><a id="6888" class="Symbol">)</a>

  <a id="6893" href="Ledger.Utxo.html#6893" class="Function">depositsChange</a> <a id="6908" class="Symbol">:</a> <a id="6910" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="6918" class="Symbol">→</a> <a id="6920" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="6927" class="Symbol">→</a> <a id="6929" href="Ledger.Utxo.html#1964" class="Datatype">DepositPurpose</a> <a id="6944" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="6946" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="6951" class="Symbol">→</a> <a id="6953" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a>
  <a id="6957" href="Ledger.Utxo.html#6893" class="Function">depositsChange</a> <a id="6972" href="Ledger.Utxo.html#6972" class="Bound">pp</a> <a id="6975" href="Ledger.Utxo.html#6975" class="Bound">txb</a> <a id="6979" href="Ledger.Utxo.html#6979" class="Bound">deposits</a>
    <a id="6992" class="Symbol">=</a>  <a id="6995" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="7003" class="Symbol">(</a><a id="7004" href="Ledger.Utxo.html#6681" class="Function">updateDeposits</a> <a id="7019" href="Ledger.Utxo.html#6972" class="Bound">pp</a> <a id="7022" href="Ledger.Utxo.html#6975" class="Bound">txb</a> <a id="7026" href="Ledger.Utxo.html#6979" class="Bound">deposits</a><a id="7034" class="Symbol">)</a>
    <a id="7040" href="Data.Integer.Base.html#4899" class="Function Operator">⊖</a>  <a id="7043" href="Ledger.Interface.HasCoin.html#170" class="Field">getCoin</a> <a id="7051" href="Ledger.Utxo.html#6979" class="Bound">deposits</a>

  <a id="7063" href="Ledger.Utxo.html#7063" class="Function">depositRefunds</a> <a id="7078" class="Symbol">:</a> <a id="7080" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="7088" class="Symbol">→</a> <a id="7090" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a> <a id="7100" class="Symbol">→</a> <a id="7102" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="7109" class="Symbol">→</a> <a id="7111" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="7118" href="Ledger.Utxo.html#7063" class="Function">depositRefunds</a> <a id="7133" href="Ledger.Utxo.html#7133" class="Bound">pp</a> <a id="7136" href="Ledger.Utxo.html#7136" class="Bound">st</a> <a id="7139" href="Ledger.Utxo.html#7139" class="Bound">txb</a> <a id="7143" class="Symbol">=</a> <a id="7145" href="Data.Integer.Ext.html#300" class="Function">negPart</a> <a id="7153" class="Symbol">(</a><a id="7154" href="Ledger.Utxo.html#6893" class="Function">depositsChange</a> <a id="7169" href="Ledger.Utxo.html#7133" class="Bound">pp</a> <a id="7172" href="Ledger.Utxo.html#7139" class="Bound">txb</a> <a id="7176" class="Symbol">(</a><a id="7177" href="Ledger.Utxo.html#7136" class="Bound">st</a> <a id="7180" class="Symbol">.</a><a id="7181" href="Ledger.Utxo.html#4493" class="Field">deposits</a><a id="7189" class="Symbol">))</a>

  <a id="7195" href="Ledger.Utxo.html#7195" class="Function">newDeposits</a> <a id="7207" class="Symbol">:</a> <a id="7209" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="7217" class="Symbol">→</a> <a id="7219" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a> <a id="7229" class="Symbol">→</a> <a id="7231" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="7238" class="Symbol">→</a> <a id="7240" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="7247" href="Ledger.Utxo.html#7195" class="Function">newDeposits</a> <a id="7259" href="Ledger.Utxo.html#7259" class="Bound">pp</a> <a id="7262" href="Ledger.Utxo.html#7262" class="Bound">st</a> <a id="7265" href="Ledger.Utxo.html#7265" class="Bound">txb</a> <a id="7269" class="Symbol">=</a> <a id="7271" href="Data.Integer.Ext.html#209" class="Function">posPart</a> <a id="7279" class="Symbol">(</a><a id="7280" href="Ledger.Utxo.html#6893" class="Function">depositsChange</a> <a id="7295" href="Ledger.Utxo.html#7259" class="Bound">pp</a> <a id="7298" href="Ledger.Utxo.html#7265" class="Bound">txb</a> <a id="7302" class="Symbol">(</a><a id="7303" href="Ledger.Utxo.html#7262" class="Bound">st</a> <a id="7306" class="Symbol">.</a><a id="7307" href="Ledger.Utxo.html#4493" class="Field">deposits</a><a id="7315" class="Symbol">))</a>

  <a id="7321" href="Ledger.Utxo.html#7321" class="Function">consumed</a> <a id="7330" class="Symbol">:</a> <a id="7332" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="7340" class="Symbol">→</a> <a id="7342" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a> <a id="7352" class="Symbol">→</a> <a id="7354" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="7361" class="Symbol">→</a> <a id="7363" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
  <a id="7371" href="Ledger.Utxo.html#7321" class="Function">consumed</a> <a id="7380" href="Ledger.Utxo.html#7380" class="Bound">pp</a> <a id="7383" href="Ledger.Utxo.html#7383" class="Bound">st</a> <a id="7386" href="Ledger.Utxo.html#7386" class="Bound">txb</a>
    <a id="7394" class="Symbol">=</a>  <a id="7397" href="Ledger.Utxo.html#1742" class="Function">balance</a> <a id="7405" class="Symbol">(</a><a id="7406" href="Ledger.Utxo.html#7383" class="Bound">st</a> <a id="7409" class="Symbol">.</a><a id="7410" href="Ledger.Utxo.html#4441" class="Field">utxo</a> <a id="7415" href="Axiom.Set.Map.html#8760" class="Function Operator">∣</a> <a id="7417" href="Ledger.Utxo.html#7386" class="Bound">txb</a> <a id="7421" class="Symbol">.</a><a id="7422" href="Ledger.Transaction.html#3375" class="Field">txins</a><a id="7427" class="Symbol">)</a>
    <a id="7433" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="7436" href="Ledger.Utxo.html#7386" class="Bound">txb</a> <a id="7440" class="Symbol">.</a><a id="7441" href="Ledger.Transaction.html#3470" class="Field">mint</a>
    <a id="7450" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="7453" href="Ledger.TokenAlgebra.html#974" class="Function">inject</a> <a id="7460" class="Symbol">(</a><a id="7461" href="Ledger.Utxo.html#7063" class="Function">depositRefunds</a> <a id="7476" href="Ledger.Utxo.html#7380" class="Bound">pp</a> <a id="7479" href="Ledger.Utxo.html#7383" class="Bound">st</a> <a id="7482" href="Ledger.Utxo.html#7386" class="Bound">txb</a><a id="7485" class="Symbol">)</a>

  <a id="7490" href="Ledger.Utxo.html#7490" class="Function">produced</a> <a id="7499" class="Symbol">:</a> <a id="7501" href="Ledger.PParams.html#1022" class="Record">PParams</a> <a id="7509" class="Symbol">→</a> <a id="7511" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a> <a id="7521" class="Symbol">→</a> <a id="7523" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="7530" class="Symbol">→</a> <a id="7532" href="Ledger.TokenAlgebra.html#781" class="Function">Value</a>
  <a id="7540" href="Ledger.Utxo.html#7490" class="Function">produced</a> <a id="7549" href="Ledger.Utxo.html#7549" class="Bound">pp</a> <a id="7552" href="Ledger.Utxo.html#7552" class="Bound">st</a> <a id="7555" href="Ledger.Utxo.html#7555" class="Bound">txb</a>
    <a id="7563" class="Symbol">=</a>  <a id="7566" href="Ledger.Utxo.html#1742" class="Function">balance</a> <a id="7574" class="Symbol">(</a><a id="7575" href="Ledger.Utxo.html#1671" class="Function">outs</a> <a id="7580" href="Ledger.Utxo.html#7555" class="Bound">txb</a><a id="7583" class="Symbol">)</a>
    <a id="7589" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="7592" href="Ledger.TokenAlgebra.html#974" class="Function">inject</a> <a id="7599" class="Symbol">(</a><a id="7600" href="Ledger.Utxo.html#7555" class="Bound">txb</a> <a id="7604" class="Symbol">.</a><a id="7605" href="Ledger.Transaction.html#3441" class="Field">txfee</a><a id="7610" class="Symbol">)</a>
    <a id="7616" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="7619" href="Ledger.TokenAlgebra.html#974" class="Function">inject</a> <a id="7626" class="Symbol">(</a><a id="7627" href="Ledger.Utxo.html#7195" class="Function">newDeposits</a> <a id="7639" href="Ledger.Utxo.html#7549" class="Bound">pp</a> <a id="7642" href="Ledger.Utxo.html#7552" class="Bound">st</a> <a id="7645" href="Ledger.Utxo.html#7555" class="Bound">txb</a><a id="7648" class="Symbol">)</a>
    <a id="7654" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="7657" href="Ledger.TokenAlgebra.html#974" class="Function">inject</a> <a id="7664" class="Symbol">(</a><a id="7665" href="Ledger.Utxo.html#7555" class="Bound">txb</a> <a id="7669" class="Symbol">.</a><a id="7670" href="Ledger.Transaction.html#3690" class="Field">txdonation</a><a id="7680" class="Symbol">)</a>
<a id="7682" class="Markup">\end{code}</a><a id="7692" class="Background">
\caption{Functions used in UTxO rules, continued}
\label{fig:functions:utxo-2}
\end{figure*}

\begin{figure*}[h]
</a><a id="7806" class="Markup">\begin{code}[hide]</a>
<a id="7825" class="Keyword">open</a> <a id="7830" href="Ledger.PParams.html#1022" class="Module">PParams</a>

<a id="7839" class="Keyword">private</a> <a id="7847" class="Keyword">variable</a>
  <a id="7858" href="Ledger.Utxo.html#7858" class="Generalizable">Γ</a> <a id="7860" class="Symbol">:</a> <a id="7862" href="Ledger.Utxo.html#4229" class="Record">UTxOEnv</a>
  <a id="7872" href="Ledger.Utxo.html#7872" class="Generalizable">s</a> <a id="7874" class="Symbol">:</a> <a id="7876" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a>
  <a id="7888" href="Ledger.Utxo.html#7888" class="Generalizable">tx</a> <a id="7891" class="Symbol">:</a> <a id="7893" href="Ledger.Transaction.html#3346" class="Record">TxBody</a>

<a id="7901" class="Keyword">data</a> <a id="7906" href="Ledger.Utxo.html#5791" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a> <a id="7920" class="Keyword">where</a>
<a id="7926" class="Markup">\end{code}</a><a id="7936" class="Background">
</a><a id="7937" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXO⦈_.UTXO-inductive"></a><a id="7952" href="Ledger.Utxo.html#7952" class="InductiveConstructor">UTXO-inductive</a> <a id="7967" class="Symbol">:</a>
    <a id="7973" class="Keyword">let</a> <a id="7977" class="Keyword">open</a> <a id="7982" href="Ledger.Transaction.html#3346" class="Module">TxBody</a> <a id="7989" href="Ledger.Utxo.html#7888" class="Generalizable">tx</a>
        <a id="8000" class="Keyword">open</a> <a id="8005" href="Ledger.Utxo.html#4229" class="Module">UTxOEnv</a> <a id="8013" href="Ledger.Utxo.html#7858" class="Generalizable">Γ</a> <a id="8015" class="Keyword">renaming</a> <a id="8024" class="Symbol">(</a><a id="8025" href="Ledger.Utxo.html#4317" class="Field">pparams</a> <a id="8033" class="Symbol">to</a> <a id="8036" class="Field">pp</a><a id="8038" class="Symbol">)</a>
        <a id="8048" class="Keyword">open</a> <a id="8053" href="Ledger.Utxo.html#4386" class="Module">UTxOState</a> <a id="8063" href="Ledger.Utxo.html#7872" class="Generalizable">s</a>
      <a id="8071" class="Keyword">in</a>
       <a id="8081" href="Ledger.Transaction.html#3375" class="Function">txins</a> <a id="8087" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="8089" href="Axiom.Set.html#5746" class="Function">∅</a>                            <a id="8118" class="Symbol">→</a> <a id="8120" href="Ledger.Transaction.html#3375" class="Function">txins</a> <a id="8126" href="Axiom.Set.html#1697" class="Function Operator">⊆</a> <a id="8128" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="8132" href="Ledger.Utxo.html#4441" class="Function">utxo</a>
    <a id="8141" class="Symbol">→</a>  <a id="8144" href="Ledger.Utxo.html#3328" class="Datatype">inInterval</a> <a id="8155" href="Ledger.Utxo.html#4257" class="Function">slot</a> <a id="8160" href="Ledger.Transaction.html#3500" class="Function">txvldt</a>               <a id="8181" class="Symbol">→</a> <a id="8183" href="Ledger.Utxo.html#1879" class="Function">minfee</a> <a id="8190" href="Ledger.Utxo.html#8036" class="Function">pp</a> <a id="8193" href="Ledger.Utxo.html#7888" class="Generalizable">tx</a> <a id="8196" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="8198" href="Ledger.Transaction.html#3441" class="Function">txfee</a>
    <a id="8208" class="Symbol">→</a>  <a id="8211" href="Ledger.Utxo.html#7321" class="Function">consumed</a> <a id="8220" href="Ledger.Utxo.html#8036" class="Function">pp</a> <a id="8223" href="Ledger.Utxo.html#7872" class="Generalizable">s</a> <a id="8225" href="Ledger.Utxo.html#7888" class="Generalizable">tx</a> <a id="8228" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="8230" href="Ledger.Utxo.html#7490" class="Function">produced</a> <a id="8239" href="Ledger.Utxo.html#8036" class="Function">pp</a> <a id="8242" href="Ledger.Utxo.html#7872" class="Generalizable">s</a> <a id="8244" href="Ledger.Utxo.html#7888" class="Generalizable">tx</a>  <a id="8248" class="Symbol">→</a> <a id="8250" href="Ledger.TokenAlgebra.html#924" class="Function">coin</a> <a id="8255" href="Ledger.Transaction.html#3470" class="Function">mint</a> <a id="8260" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="8262" class="Number">0</a>
    <a id="8268" class="Symbol">→</a>  <a id="8271" href="Ledger.Transaction.html#3831" class="Function">txsize</a> <a id="8278" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="8280" href="Ledger.PParams.html#1202" class="Field">maxTxSize</a> <a id="8290" href="Ledger.Utxo.html#8036" class="Function">pp</a>
       <a id="8300" href="Interface.STS.html#244" class="Function Operator">────────────────────────────────</a>
       <a id="8340" href="Ledger.Utxo.html#7858" class="Generalizable">Γ</a> <a id="8342" href="Ledger.Utxo.html#5791" class="Datatype Operator">⊢</a> <a id="8344" href="Ledger.Utxo.html#7872" class="Generalizable">s</a> <a id="8346" href="Ledger.Utxo.html#5791" class="Datatype Operator">⇀⦇</a> <a id="8349" href="Ledger.Utxo.html#7888" class="Generalizable">tx</a> <a id="8352" href="Ledger.Utxo.html#5791" class="Datatype Operator">,UTXO⦈</a>  <a id="8360" href="Ledger.Utxo.html#4422" class="InductiveConstructor Operator">⟦</a> <a id="8362" class="Symbol">(</a><a id="8363" href="Ledger.Utxo.html#4441" class="Function">utxo</a> <a id="8368" href="Axiom.Set.Map.html#8830" class="Function Operator">∣</a> <a id="8370" href="Ledger.Transaction.html#3375" class="Function">txins</a> <a id="8376" href="Axiom.Set.Map.html#8830" class="Function Operator">ᶜ</a><a id="8377" class="Symbol">)</a> <a id="8379" href="Axiom.Set.Map.html#4771" class="Function Operator">∪ᵐˡ</a> <a id="8383" class="Symbol">(</a><a id="8384" href="Ledger.Utxo.html#1671" class="Function">outs</a> <a id="8389" href="Ledger.Utxo.html#7888" class="Generalizable">tx</a><a id="8391" class="Symbol">)</a>
                           <a id="8420" href="Ledger.Utxo.html#4422" class="InductiveConstructor Operator">,</a> <a id="8422" href="Ledger.Utxo.html#4467" class="Function">fees</a> <a id="8427" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="8429" href="Ledger.Transaction.html#3441" class="Function">txfee</a>
                           <a id="8462" href="Ledger.Utxo.html#4422" class="InductiveConstructor Operator">,</a> <a id="8464" href="Ledger.Utxo.html#6681" class="Function">updateDeposits</a> <a id="8479" href="Ledger.Utxo.html#8036" class="Function">pp</a> <a id="8482" href="Ledger.Utxo.html#7888" class="Generalizable">tx</a> <a id="8485" href="Ledger.Utxo.html#4493" class="Function">deposits</a>
                           <a id="8521" href="Ledger.Utxo.html#4422" class="InductiveConstructor Operator">,</a> <a id="8523" href="Ledger.Utxo.html#4523" class="Function">donations</a> <a id="8533" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="8535" href="Ledger.Transaction.html#3690" class="Function">txdonation</a>
                           <a id="8573" href="Ledger.Utxo.html#4422" class="InductiveConstructor Operator">⟧ᵘ</a>
<a id="8576" class="Markup">\end{code}</a><a id="8586" class="Background">
</a><a id="8587" class="Markup">\begin{code}[hide]</a>
<a id="8606" class="Keyword">instance</a>
  <a id="Computational-UTXO"></a><a id="8617" href="Ledger.Utxo.html#8617" class="Function">Computational-UTXO</a> <a id="8636" class="Symbol">:</a> <a id="8638" href="Interface.ComputationalRelation.html#627" class="Record">Computational</a> <a id="8652" href="Ledger.Utxo.html#5791" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a>
  <a id="8668" href="Ledger.Utxo.html#8617" class="Function">Computational-UTXO</a> <a id="8687" class="Symbol">=</a> <a id="8689" class="Keyword">record</a> <a id="8696" class="Symbol">{</a><a id="8697" href="Ledger.Utxo.html#8714" class="Module">go</a><a id="8699" class="Symbol">}</a> <a id="8701" class="Keyword">where</a> <a id="8707" class="Keyword">module</a> <a id="8714" href="Ledger.Utxo.html#8714" class="Module">go</a> <a id="8717" href="Ledger.Utxo.html#8717" class="Bound">Γ</a> <a id="8719" href="Ledger.Utxo.html#8719" class="Bound">s</a> <a id="8721" href="Ledger.Utxo.html#8721" class="Bound">tx</a> <a id="8724" class="Keyword">where</a>
    <a id="8734" class="Keyword">open</a> <a id="8739" href="Ledger.Transaction.html#3346" class="Module">TxBody</a> <a id="8746" href="Ledger.Utxo.html#8721" class="Bound">tx</a>
    <a id="8753" class="Keyword">open</a> <a id="8758" href="Ledger.Utxo.html#4229" class="Module">UTxOEnv</a> <a id="8766" href="Ledger.Utxo.html#8717" class="Bound">Γ</a> <a id="8768" class="Keyword">renaming</a> <a id="8777" class="Symbol">(</a><a id="8778" href="Ledger.Utxo.html#4317" class="Field">pparams</a> <a id="8786" class="Symbol">to</a> <a id="8789" class="Field">pp</a><a id="8791" class="Symbol">)</a>
    <a id="8797" class="Keyword">open</a> <a id="8802" href="Ledger.Utxo.html#4386" class="Module">UTxOState</a> <a id="8812" href="Ledger.Utxo.html#8719" class="Bound">s</a>

    <a id="8819" href="Ledger.Utxo.html#8819" class="Function">UTXO-premises</a> <a id="8833" class="Symbol">:</a> <a id="8835" href="Agda.Primitive.html#320" class="Primitive">Set</a>
    <a id="8843" href="Ledger.Utxo.html#8819" class="Function">UTXO-premises</a>
      <a id="8863" class="Symbol">=</a> <a id="8865" href="Ledger.Transaction.html#3375" class="Field">txins</a> <a id="8871" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="8873" href="Axiom.Set.html#5746" class="Function">∅</a>
      <a id="8881" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="8883" href="Ledger.Transaction.html#3375" class="Field">txins</a> <a id="8889" href="Axiom.Set.html#1697" class="Function Operator">⊆</a> <a id="8891" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="8895" href="Ledger.Utxo.html#4441" class="Function">utxo</a>
      <a id="8906" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="8908" href="Ledger.Utxo.html#3328" class="Datatype">inInterval</a> <a id="8919" href="Ledger.Utxo.html#4257" class="Function">slot</a> <a id="8924" href="Ledger.Transaction.html#3500" class="Field">txvldt</a>
      <a id="8937" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="8939" href="Ledger.Utxo.html#1879" class="Function">minfee</a> <a id="8946" href="Ledger.Utxo.html#8789" class="Function">pp</a> <a id="8949" href="Ledger.Utxo.html#8721" class="Bound">tx</a> <a id="8952" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="8954" href="Ledger.Transaction.html#3441" class="Field">txfee</a>
      <a id="8966" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="8968" href="Ledger.Utxo.html#7321" class="Function">consumed</a> <a id="8977" href="Ledger.Utxo.html#8789" class="Function">pp</a> <a id="8980" href="Ledger.Utxo.html#8719" class="Bound">s</a> <a id="8982" href="Ledger.Utxo.html#8721" class="Bound">tx</a> <a id="8985" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="8987" href="Ledger.Utxo.html#7490" class="Function">produced</a> <a id="8996" href="Ledger.Utxo.html#8789" class="Function">pp</a> <a id="8999" href="Ledger.Utxo.html#8719" class="Bound">s</a> <a id="9001" href="Ledger.Utxo.html#8721" class="Bound">tx</a>
      <a id="9010" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="9012" href="Ledger.TokenAlgebra.html#924" class="Function">coin</a> <a id="9017" href="Ledger.Transaction.html#3470" class="Field">mint</a> <a id="9022" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="9024" class="Number">0</a>
      <a id="9032" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="9034" href="Ledger.Transaction.html#3831" class="Field">txsize</a> <a id="9041" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="9043" href="Ledger.PParams.html#1202" class="Field">maxTxSize</a> <a id="9053" href="Ledger.Utxo.html#8789" class="Function">pp</a>

    <a id="9061" href="Ledger.Utxo.html#9061" class="Function">UTXO-premises?</a> <a id="9076" class="Symbol">:</a> <a id="9078" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="9082" href="Ledger.Utxo.html#8819" class="Function">UTXO-premises</a>
    <a id="9100" href="Ledger.Utxo.html#9061" class="Function">UTXO-premises?</a> <a id="9115" class="Symbol">=</a> <a id="9117" href="Interface.Decidable.Instance.html#739" class="Function Operator">¿</a> <a id="9119" href="Ledger.Utxo.html#8819" class="Function">UTXO-premises</a> <a id="9133" href="Interface.Decidable.Instance.html#739" class="Function Operator">¿</a>

    <a id="9140" href="Ledger.Utxo.html#9140" class="Function">computeProof</a> <a id="9153" class="Symbol">=</a>
      <a id="9161" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="9166" href="Ledger.Utxo.html#9061" class="Function">UTXO-premises?</a> <a id="9181" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="9184" class="Symbol">λ</a> <a id="9186" class="Keyword">where</a>
        <a id="9200" class="Symbol">(</a><a id="9201" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="9205" class="Symbol">(</a><a id="9206" href="Ledger.Utxo.html#9206" class="Bound">p₀</a> <a id="9209" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9211" href="Ledger.Utxo.html#9211" class="Bound">p₁</a> <a id="9214" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9216" href="Ledger.Utxo.html#9216" class="Bound">p₂</a> <a id="9219" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9221" href="Ledger.Utxo.html#9221" class="Bound">p₃</a> <a id="9224" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9226" href="Ledger.Utxo.html#9226" class="Bound">p₄</a> <a id="9229" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9231" href="Ledger.Utxo.html#9231" class="Bound">p₅</a> <a id="9234" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9236" href="Ledger.Utxo.html#9236" class="Bound">p₆</a><a id="9238" class="Symbol">))</a> <a id="9241" class="Symbol">→</a>
          <a id="9253" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9258" class="Symbol">(_</a> <a id="9261" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9263" href="Ledger.Utxo.html#7952" class="InductiveConstructor">UTXO-inductive</a> <a id="9278" href="Ledger.Utxo.html#9206" class="Bound">p₀</a> <a id="9281" href="Ledger.Utxo.html#9211" class="Bound">p₁</a> <a id="9284" href="Ledger.Utxo.html#9216" class="Bound">p₂</a> <a id="9287" href="Ledger.Utxo.html#9221" class="Bound">p₃</a> <a id="9290" href="Ledger.Utxo.html#9226" class="Bound">p₄</a> <a id="9293" href="Ledger.Utxo.html#9231" class="Bound">p₅</a> <a id="9296" href="Ledger.Utxo.html#9236" class="Bound">p₆</a><a id="9298" class="Symbol">)</a>
        <a id="9308" class="Symbol">(</a><a id="9309" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="9312" class="Symbol">_)</a> <a id="9315" class="Symbol">→</a> <a id="9317" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>

    <a id="9330" href="Ledger.Utxo.html#9330" class="Function">completeness</a> <a id="9343" class="Symbol">:</a> <a id="9345" class="Symbol">∀</a> <a id="9347" href="Ledger.Utxo.html#9347" class="Bound">s&#39;</a> <a id="9350" class="Symbol">→</a> <a id="9352" href="Ledger.Utxo.html#8717" class="Bound">Γ</a> <a id="9354" href="Ledger.Utxo.html#5791" class="Datatype Operator">⊢</a> <a id="9356" href="Ledger.Utxo.html#8719" class="Bound">s</a> <a id="9358" href="Ledger.Utxo.html#5791" class="Datatype Operator">⇀⦇</a> <a id="9361" href="Ledger.Utxo.html#8721" class="Bound">tx</a> <a id="9364" href="Ledger.Utxo.html#5791" class="Datatype Operator">,UTXO⦈</a> <a id="9371" href="Ledger.Utxo.html#9347" class="Bound">s&#39;</a> <a id="9374" class="Symbol">→</a> <a id="9376" class="Symbol">_</a>
    <a id="9382" href="Ledger.Utxo.html#9330" class="Function">completeness</a> <a id="9395" href="Ledger.Utxo.html#9395" class="Bound">s&#39;</a> <a id="9398" href="Ledger.Utxo.html#9398" class="Bound">h</a><a id="9399" class="Symbol">@(</a><a id="9401" href="Ledger.Utxo.html#7952" class="InductiveConstructor">UTXO-inductive</a> <a id="9416" href="Ledger.Utxo.html#9416" class="Bound">q₀</a> <a id="9419" href="Ledger.Utxo.html#9419" class="Bound">q₁</a> <a id="9422" href="Ledger.Utxo.html#9422" class="Bound">q₂</a> <a id="9425" href="Ledger.Utxo.html#9425" class="Bound">q₃</a> <a id="9428" href="Ledger.Utxo.html#9428" class="Bound">q₄</a> <a id="9431" href="Ledger.Utxo.html#9431" class="Bound">q₅</a> <a id="9434" href="Ledger.Utxo.html#9434" class="Bound">q₆</a><a id="9436" class="Symbol">)</a> <a id="9438" class="Symbol">=</a> <a id="9440" href="Ledger.Utxo.html#9462" class="Function">QED</a>
      <a id="9450" class="Keyword">where</a>
      <a id="9462" href="Ledger.Utxo.html#9462" class="Function">QED</a> <a id="9466" class="Symbol">:</a> <a id="9468" href="Interface.Functor.html#448" class="Function">map</a> <a id="9472" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="9478" href="Ledger.Utxo.html#9140" class="Function">computeProof</a> <a id="9491" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="9493" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9498" href="Ledger.Utxo.html#9395" class="Bound">s&#39;</a>
      <a id="9507" href="Ledger.Utxo.html#9462" class="Function">QED</a> <a id="9511" class="Keyword">with</a> <a id="9516" href="Ledger.Utxo.html#9061" class="Function">UTXO-premises?</a>
      <a id="9537" href="Ledger.Utxo.html#9462" class="Function">...</a> <a id="9541" class="Symbol">|</a> <a id="9543" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="9547" class="Symbol">(</a><a id="9548" href="Ledger.Utxo.html#9548" class="Bound">p₀</a> <a id="9551" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9553" href="Ledger.Utxo.html#9553" class="Bound">p₁</a> <a id="9556" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9558" href="Ledger.Utxo.html#9558" class="Bound">p₂</a> <a id="9561" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9563" href="Ledger.Utxo.html#9563" class="Bound">p₃</a> <a id="9566" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9568" href="Ledger.Utxo.html#9568" class="Bound">p₄</a> <a id="9571" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9573" href="Ledger.Utxo.html#9573" class="Bound">p₅</a> <a id="9576" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9578" href="Ledger.Utxo.html#9578" class="Bound">p₆</a><a id="9580" class="Symbol">)</a> <a id="9582" class="Symbol">=</a> <a id="9584" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a>
      <a id="9595" href="Ledger.Utxo.html#9462" class="Function">...</a> <a id="9599" class="Symbol">|</a> <a id="9601" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="9604" href="Ledger.Utxo.html#9604" class="Bound">q</a> <a id="9606" class="Symbol">=</a> <a id="9608" href="Data.Empty.html#1041" class="Function">⊥-elim</a> <a id="9615" class="Symbol">(</a><a id="9616" href="Ledger.Utxo.html#9604" class="Bound">q</a> <a id="9618" class="Symbol">(</a><a id="9619" href="Ledger.Utxo.html#9416" class="Bound">q₀</a> <a id="9622" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9624" href="Ledger.Utxo.html#9419" class="Bound">q₁</a> <a id="9627" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9629" href="Ledger.Utxo.html#9422" class="Bound">q₂</a> <a id="9632" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9634" href="Ledger.Utxo.html#9425" class="Bound">q₃</a> <a id="9637" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9639" href="Ledger.Utxo.html#9428" class="Bound">q₄</a> <a id="9642" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9644" href="Ledger.Utxo.html#9431" class="Bound">q₅</a> <a id="9647" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9649" href="Ledger.Utxo.html#9434" class="Bound">q₆</a><a id="9651" class="Symbol">))</a>
<a id="9654" class="Markup">\end{code}</a><a id="9664" class="Background">
\caption{UTXO inference rules}
\label{fig:rules:utxo-shelley}
\end{figure*}
</a></pre></body></html>