<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Ledger</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Ledger State Transition}

</a><a id="36" class="Markup">\begin{code}[hide]</a>
<a id="55" class="Symbol">{-#</a> <a id="59" class="Keyword">OPTIONS</a> <a id="67" class="Pragma">--safe</a> <a id="74" class="Symbol">#-}</a>

<a id="79" class="Keyword">open</a> <a id="84" class="Keyword">import</a> <a id="91" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="106" class="Keyword">open</a> <a id="111" class="Keyword">import</a> <a id="118" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a> <a id="137" class="Keyword">using</a> <a id="143" class="Symbol">(</a><a id="144" href="Ledger.Transaction.html#617" class="Record">TransactionStructure</a><a id="164" class="Symbol">)</a>

<a id="167" class="Keyword">module</a> <a id="174" href="Ledger.Ledger.html" class="Module">Ledger.Ledger</a> <a id="188" class="Symbol">(</a><a id="189" href="Ledger.Ledger.html#189" class="Bound">txs</a> <a id="193" class="Symbol">:</a> <a id="195" class="Symbol">_)</a> <a id="198" class="Symbol">(</a><a id="199" class="Keyword">open</a> <a id="204" href="Ledger.Transaction.html#617" class="Module">TransactionStructure</a> <a id="225" href="Ledger.Ledger.html#189" class="Bound">txs</a><a id="228" class="Symbol">)</a> <a id="230" class="Keyword">where</a>

<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="260" href="Ledger.Transaction.html#2486" class="Function">govStructure</a>
<a id="273" class="Keyword">open</a> <a id="278" class="Keyword">import</a> <a id="285" href="Ledger.PPUp.html" class="Module">Ledger.PPUp</a> <a id="297" href="Ledger.Ledger.html#189" class="Bound">txs</a>
<a id="301" class="Keyword">open</a> <a id="306" class="Keyword">import</a> <a id="313" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="325" href="Ledger.Ledger.html#189" class="Bound">txs</a>
<a id="329" class="Keyword">open</a> <a id="334" class="Keyword">import</a> <a id="341" href="Ledger.Utxow.html" class="Module">Ledger.Utxow</a> <a id="354" href="Ledger.Ledger.html#189" class="Bound">txs</a>
<a id="358" class="Keyword">open</a> <a id="363" href="Ledger.Transaction.html#4052" class="Module">Tx</a>
<a id="366" class="Markup">\end{code}</a><a id="376" class="Background">

The entire state transformation of the ledger state caused by a valid
transaction can now be given as a combination of the previously
defined transition systems.

\begin{figure*}[h]
</a><a id="560" class="Markup">\begin{code}</a>
<a id="573" class="Keyword">record</a> <a id="LEnv"></a><a id="580" href="Ledger.Ledger.html#580" class="Record">LEnv</a> <a id="585" class="Symbol">:</a> <a id="587" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="591" class="Keyword">where</a>
  <a id="599" class="Keyword">constructor</a> <a id="⟦_,_,_⟧ˡᵉ"></a><a id="611" href="Ledger.Ledger.html#611" class="InductiveConstructor Operator">⟦_,_,_⟧ˡᵉ</a>
  <a id="623" class="Keyword">field</a> <a id="LEnv.slot"></a><a id="629" href="Ledger.Ledger.html#629" class="Field">slot</a>     <a id="638" class="Symbol">:</a> <a id="640" href="Ledger.Epoch.html#548" class="Function">Slot</a>
        <a id="LEnv.ppolicy"></a><a id="653" href="Ledger.Ledger.html#653" class="Field">ppolicy</a>  <a id="662" class="Symbol">:</a> <a id="664" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="670" href="Ledger.Crypto.html#1632" class="Function">ScriptHash</a>
        <a id="LEnv.pparams"></a><a id="689" href="Ledger.Ledger.html#689" class="Field">pparams</a>  <a id="698" class="Symbol">:</a> <a id="700" href="Ledger.PParams.html#1022" class="Record">PParams</a>

<a id="709" class="Keyword">record</a> <a id="LState"></a><a id="716" href="Ledger.Ledger.html#716" class="Record">LState</a> <a id="723" class="Symbol">:</a> <a id="725" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="729" class="Keyword">where</a>
  <a id="737" class="Keyword">constructor</a> <a id="⟦_,_,_⟧ˡ"></a><a id="749" href="Ledger.Ledger.html#749" class="InductiveConstructor Operator">⟦_,_,_⟧ˡ</a>
  <a id="760" class="Keyword">field</a> <a id="LState.utxoSt"></a><a id="766" href="Ledger.Ledger.html#766" class="Field">utxoSt</a>     <a id="777" class="Symbol">:</a> <a id="779" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a>
        <a id="LState.govSt"></a><a id="797" href="Ledger.Ledger.html#797" class="Field">govSt</a>      <a id="808" class="Symbol">:</a> <a id="810" href="Ledger.Gov.html#899" class="Function">GovState</a>
        <a id="LState.certState"></a><a id="827" href="Ledger.Ledger.html#827" class="Field">certState</a>  <a id="838" class="Symbol">:</a> <a id="840" href="Ledger.Deleg.html#1344" class="Record">CertState</a>

<a id="txgov"></a><a id="851" href="Ledger.Ledger.html#851" class="Function">txgov</a> <a id="857" class="Symbol">:</a> <a id="859" href="Ledger.Transaction.html#3346" class="Record">TxBody</a> <a id="866" class="Symbol">→</a> <a id="868" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="873" class="Symbol">(</a><a id="874" href="Ledger.GovernanceActions.html#8355" class="Record">GovVote</a> <a id="882" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="884" href="Ledger.GovernanceActions.html#8542" class="Record">GovProposal</a><a id="895" class="Symbol">)</a>
<a id="897" href="Ledger.Ledger.html#851" class="Function">txgov</a> <a id="903" href="Ledger.Ledger.html#903" class="Bound">txb</a> <a id="907" class="Symbol">=</a> <a id="909" href="Interface.Functor.html#448" class="Function">map</a> <a id="913" href="Data.Sum.Base.html#666" class="InductiveConstructor">inj₁</a> <a id="918" href="Ledger.Transaction.html#3612" class="Field">txvote</a> <a id="925" href="Data.List.Base.html#1929" class="Function Operator">++</a> <a id="928" href="Interface.Functor.html#448" class="Function">map</a> <a id="932" href="Data.Sum.Base.html#691" class="InductiveConstructor">inj₂</a> <a id="937" href="Ledger.Transaction.html#3649" class="Field">txprop</a>
  <a id="946" class="Keyword">where</a> <a id="952" class="Keyword">open</a> <a id="957" href="Ledger.Transaction.html#3346" class="Module">TxBody</a> <a id="964" href="Ledger.Ledger.html#903" class="Bound">txb</a>

<a id="969" class="Markup">\end{code}</a><a id="979" class="Background">
\caption{Types and functions for the LEDGER transition system}
\end{figure*}
</a><a id="1057" class="Markup">\begin{code}[hide]</a>
<a id="1076" class="Keyword">private</a> <a id="1084" class="Keyword">variable</a>
  <a id="1095" href="Ledger.Ledger.html#1095" class="Generalizable">Γ</a> <a id="1097" class="Symbol">:</a> <a id="1099" href="Ledger.Ledger.html#580" class="Record">LEnv</a>
  <a id="1106" href="Ledger.Ledger.html#1106" class="Generalizable">s</a> <a id="1108" href="Ledger.Ledger.html#1108" class="Generalizable">s&#39;</a> <a id="1111" href="Ledger.Ledger.html#1111" class="Generalizable">s&#39;&#39;</a> <a id="1115" class="Symbol">:</a> <a id="1117" href="Ledger.Ledger.html#716" class="Record">LState</a>
  <a id="1126" href="Ledger.Ledger.html#1126" class="Generalizable">utxoSt&#39;</a> <a id="1134" class="Symbol">:</a> <a id="1136" href="Ledger.Utxo.html#4386" class="Record">UTxOState</a>
  <a id="1148" href="Ledger.Ledger.html#1148" class="Generalizable">govSt&#39;</a> <a id="1155" class="Symbol">:</a> <a id="1157" href="Ledger.Gov.html#899" class="Function">GovState</a>
  <a id="1168" href="Ledger.Ledger.html#1168" class="Generalizable">certState&#39;</a> <a id="1179" class="Symbol">:</a> <a id="1181" href="Ledger.Deleg.html#1344" class="Record">CertState</a>
  <a id="1193" href="Ledger.Ledger.html#1193" class="Generalizable">tx</a> <a id="1196" class="Symbol">:</a> <a id="1198" href="Ledger.Transaction.html#4052" class="Record">Tx</a>
<a id="1201" class="Markup">\end{code}</a><a id="1211" class="Background">

\begin{figure*}[h]
</a><a id="1232" class="Markup">\begin{code}[hide]</a>
<a id="1251" class="Keyword">open</a> <a id="1256" href="Ledger.Address.html#1216" class="Module">RwdAddr</a>
<a id="1264" class="Keyword">open</a> <a id="1269" href="Ledger.Deleg.html#816" class="Module">DState</a>
<a id="1276" class="Keyword">open</a> <a id="1281" href="Ledger.Deleg.html#1344" class="Module">CertState</a>

<a id="1292" class="Keyword">data</a>
<a id="1297" class="Markup">\end{code}</a><a id="1307" class="Background">
</a><a id="1308" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,LEDGER⦈_"></a><a id="1323" href="Ledger.Ledger.html#1323" class="Datatype Operator">_⊢_⇀⦇_,LEDGER⦈_</a> <a id="1339" class="Symbol">:</a> <a id="1341" href="Ledger.Ledger.html#580" class="Record">LEnv</a> <a id="1346" class="Symbol">→</a> <a id="1348" href="Ledger.Ledger.html#716" class="Record">LState</a> <a id="1355" class="Symbol">→</a> <a id="1357" href="Ledger.Transaction.html#4052" class="Record">Tx</a> <a id="1360" class="Symbol">→</a> <a id="1362" href="Ledger.Ledger.html#716" class="Record">LState</a> <a id="1369" class="Symbol">→</a> <a id="1371" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="1375" class="Markup">\end{code}</a><a id="1385" class="Background">
</a><a id="1386" class="Markup">\begin{code}[hide]</a>
  <a id="1407" class="Keyword">where</a>
<a id="1413" class="Markup">\end{code}</a><a id="1423" class="Background">
\caption{The type of the LEDGER transition system}
\end{figure*}

\begin{figure*}[h]
</a><a id="1509" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,LEDGER⦈_.LEDGER"></a><a id="1524" href="Ledger.Ledger.html#1524" class="InductiveConstructor">LEDGER</a> <a id="1531" class="Symbol">:</a> <a id="1533" class="Keyword">let</a> <a id="1537" class="Keyword">open</a> <a id="1542" href="Ledger.Ledger.html#716" class="Module">LState</a> <a id="1549" href="Ledger.Ledger.html#1106" class="Generalizable">s</a><a id="1550" class="Symbol">;</a> <a id="1552" href="Ledger.Ledger.html#1552" class="Bound">txb</a> <a id="1556" class="Symbol">=</a> <a id="1558" href="Ledger.Ledger.html#1193" class="Generalizable">tx</a> <a id="1561" class="Symbol">.</a><a id="1562" href="Ledger.Transaction.html#4077" class="Field">body</a><a id="1566" class="Symbol">;</a> <a id="1568" class="Keyword">open</a> <a id="1573" href="Ledger.Transaction.html#3346" class="Module">TxBody</a> <a id="1580" href="Ledger.Ledger.html#1552" class="Bound">txb</a><a id="1583" class="Symbol">;</a> <a id="1585" class="Keyword">open</a> <a id="1590" href="Ledger.Ledger.html#580" class="Module">LEnv</a> <a id="1595" href="Ledger.Ledger.html#1095" class="Generalizable">Γ</a> <a id="1597" class="Keyword">in</a>
       <a id="1607" class="Keyword">record</a> <a id="1614" class="Symbol">{</a> <a id="1616" href="Ledger.Ledger.html#1616" class="Module">LEnv</a> <a id="1621" href="Ledger.Ledger.html#1095" class="Generalizable">Γ</a> <a id="1623" class="Symbol">}</a> <a id="1625" href="Ledger.Utxow.html#1136" class="Datatype Operator">⊢</a> <a id="1627" href="Ledger.Ledger.html#766" class="Function">utxoSt</a> <a id="1634" href="Ledger.Utxow.html#1136" class="Datatype Operator">⇀⦇</a> <a id="1637" href="Ledger.Ledger.html#1193" class="Generalizable">tx</a> <a id="1640" href="Ledger.Utxow.html#1136" class="Datatype Operator">,UTXOW⦈</a> <a id="1648" href="Ledger.Ledger.html#1126" class="Generalizable">utxoSt&#39;</a>
    <a id="1660" class="Symbol">→</a>  <a id="1663" href="Ledger.Deleg.html#721" class="InductiveConstructor Operator">⟦</a> <a id="1665" href="Ledger.Epoch.html#587" class="Function">epoch</a> <a id="1671" href="Ledger.Ledger.html#629" class="Function">slot</a> <a id="1676" href="Ledger.Deleg.html#721" class="InductiveConstructor Operator">,</a> <a id="1678" href="Ledger.Ledger.html#689" class="Function">pparams</a> <a id="1686" href="Ledger.Deleg.html#721" class="InductiveConstructor Operator">,</a> <a id="1688" href="Ledger.Transaction.html#3612" class="Function">txvote</a> <a id="1695" href="Ledger.Deleg.html#721" class="InductiveConstructor Operator">⟧ᶜ</a> <a id="1698" href="Ledger.Deleg.html#5589" class="Function Operator">⊢</a> <a id="1700" href="Ledger.Ledger.html#827" class="Function">certState</a> <a id="1710" href="Ledger.Deleg.html#5589" class="Function Operator">⇀⦇</a> <a id="1713" href="Ledger.Transaction.html#3548" class="Function">txcerts</a> <a id="1721" href="Ledger.Deleg.html#5589" class="Function Operator">,CERTS⦈</a> <a id="1729" href="Ledger.Ledger.html#1168" class="Generalizable">certState&#39;</a>
    <a id="1744" class="Symbol">→</a>  <a id="1747" href="Ledger.Gov.html#1002" class="InductiveConstructor Operator">⟦</a> <a id="1749" href="Ledger.Transaction.html#3857" class="Function">txid</a> <a id="1754" href="Ledger.Gov.html#1002" class="InductiveConstructor Operator">,</a> <a id="1756" href="Ledger.Epoch.html#587" class="Function">epoch</a> <a id="1762" href="Ledger.Ledger.html#629" class="Function">slot</a> <a id="1767" href="Ledger.Gov.html#1002" class="InductiveConstructor Operator">,</a> <a id="1769" href="Ledger.Ledger.html#689" class="Function">pparams</a> <a id="1777" href="Ledger.Gov.html#1002" class="InductiveConstructor Operator">⟧ᵗ</a> <a id="1780" href="Ledger.Gov.html#1261" class="Function Operator">⊢</a> <a id="1782" href="Ledger.Ledger.html#797" class="Function">govSt</a> <a id="1788" href="Ledger.Gov.html#1261" class="Function Operator">⇀⦇</a> <a id="1791" href="Ledger.Ledger.html#851" class="Function">txgov</a> <a id="1797" href="Ledger.Ledger.html#1552" class="Bound">txb</a> <a id="1801" href="Ledger.Gov.html#1261" class="Function Operator">,GOV⦈</a> <a id="1807" href="Ledger.Ledger.html#1148" class="Generalizable">govSt&#39;</a>
    <a id="1818" class="Symbol">→</a>  <a id="1821" href="Ledger.Prelude.html#1544" class="Function">mapˢ</a> <a id="1826" href="Ledger.Address.html#1269" class="Field">stake</a> <a id="1832" class="Symbol">(</a><a id="1833" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="1837" href="Ledger.Transaction.html#3583" class="Function">txwdrls</a><a id="1844" class="Symbol">)</a> <a id="1846" href="Axiom.Set.html#1697" class="Function Operator">⊆</a> <a id="1848" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="1852" class="Symbol">(</a><a id="1853" href="Ledger.Ledger.html#1168" class="Generalizable">certState&#39;</a> <a id="1864" class="Symbol">.</a><a id="1865" href="Ledger.Deleg.html#1397" class="Field">dState</a> <a id="1872" class="Symbol">.</a><a id="1873" href="Ledger.Deleg.html#870" class="Field">voteDelegs</a><a id="1883" class="Symbol">)</a>
       <a id="1892" href="Interface.STS.html#244" class="Function Operator">────────────────────────────────</a>
       <a id="1932" href="Ledger.Ledger.html#1095" class="Generalizable">Γ</a> <a id="1934" href="Ledger.Ledger.html#1323" class="Datatype Operator">⊢</a> <a id="1936" href="Ledger.Ledger.html#1106" class="Generalizable">s</a> <a id="1938" href="Ledger.Ledger.html#1323" class="Datatype Operator">⇀⦇</a> <a id="1941" href="Ledger.Ledger.html#1193" class="Generalizable">tx</a> <a id="1944" href="Ledger.Ledger.html#1323" class="Datatype Operator">,LEDGER⦈</a> <a id="1953" href="Ledger.Ledger.html#749" class="InductiveConstructor Operator">⟦</a> <a id="1955" href="Ledger.Ledger.html#1126" class="Generalizable">utxoSt&#39;</a> <a id="1963" href="Ledger.Ledger.html#749" class="InductiveConstructor Operator">,</a> <a id="1965" href="Ledger.Ledger.html#1148" class="Generalizable">govSt&#39;</a> <a id="1972" href="Ledger.Ledger.html#749" class="InductiveConstructor Operator">,</a> <a id="1974" href="Ledger.Ledger.html#1168" class="Generalizable">certState&#39;</a> <a id="1985" href="Ledger.Ledger.html#749" class="InductiveConstructor Operator">⟧ˡ</a>
<a id="1988" class="Markup">\end{code}</a><a id="1998" class="Background">
\caption{LEDGER transition system}
\end{figure*}
\begin{figure*}[h]
</a><a id="2067" class="Markup">\begin{code}</a>
<a id="_⊢_⇀⦇_,LEDGERS⦈_"></a><a id="2080" href="Ledger.Ledger.html#2080" class="Function Operator">_⊢_⇀⦇_,LEDGERS⦈_</a> <a id="2097" class="Symbol">:</a> <a id="2099" href="Ledger.Ledger.html#580" class="Record">LEnv</a> <a id="2104" class="Symbol">→</a> <a id="2106" href="Ledger.Ledger.html#716" class="Record">LState</a> <a id="2113" class="Symbol">→</a> <a id="2115" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2120" href="Ledger.Transaction.html#4052" class="Record">Tx</a> <a id="2123" class="Symbol">→</a> <a id="2125" href="Ledger.Ledger.html#716" class="Record">LState</a> <a id="2132" class="Symbol">→</a> <a id="2134" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="2138" href="Ledger.Ledger.html#2080" class="Function Operator">_⊢_⇀⦇_,LEDGERS⦈_</a> <a id="2155" class="Symbol">=</a> <a id="2157" href="Interface.STS.html#1607" class="Function">SS⇒BS</a> <a id="2163" href="Ledger.Ledger.html#1323" class="Datatype Operator">_⊢_⇀⦇_,LEDGER⦈_</a>
<a id="2179" class="Markup">\end{code}</a><a id="2189" class="Background">
\caption{LEDGERS transition system}
\end{figure*}
</a></pre></body></html>