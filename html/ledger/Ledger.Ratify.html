<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Ratify</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Ratification}
\label{sec:ratification}
Governance actions are \defn{ratified} through on-chain voting actions.
Different kinds of governance actions have different ratification requirements
but always involve \textit{two of the three} governance bodies, with the exception
of a hard-fork initiation, which requires ratification by all governance bodies.
Depending on the type of governance action, an action will thus be ratified when
a combination of the following occurs:
\begin{itemize}
\item
  the \defn{constitutional committee} (\CC) approves of the action; for this to occur,
  the number of \CC members who vote \yes must meet the \CC vote threshold;
\item
  the \defn{delegation representatives} (\DReps) approve of the action; for this to occur,
  the stake controlled by the \DReps who vote \yes must meet the \DRep vote threshold
  as a percentage of the \defn{total participating voting stake} (\totalStake);
\item
  the stake pool operators (\SPOs) approve of the action; for this to occur,
  the stake controlled by the \SPOs who vote \yes must meet a certain threshold as a percentage of
  the \defn{total registered voting stake} (\totalStake).
\end{itemize}
\textbf{Warning}. Different stake distributions apply to \DReps and \SPOs.
\\[4pt]
A successful motion of no-confidence, election of a new constitutional
committee, a constitutional change, or a hard-fork delays ratification of
all other governance actions until the first epoch after their
enactment. This gives a new constitutional committee enough time to vote
on current proposals, re-evaluate existing proposals with respect to a
new constitution, and ensures that the in principle arbitrary semantic
changes caused by enacting a hard-fork do not have unintended
consequences in combination with other actions.

\subsection{Ratification requirements}
\label{sec:ratification-requirements}
Figure~\ref{fig:ratification-requirements} details the ratification requirements for each
governance action scenario. The columns represent
\begin{itemize}
\item
  \GovAction: the action under consideration;
\item
  \CC: a \ding{51} indicates that the constitutional committee must approve this action;
  a - symbol means that constitutional committee votes do not apply;
\item
  \DRep: the vote threshold that must be met as a percentage of \totalStake;
\item
  \SPO: the vote threshold that must be met as a percentage of the stake held by
  all stake pools; a - symbol means that \SPO votes do not apply.
\end{itemize}
\begin{figure*}[h!]
\begin{longtable}[]{@{}
   &gt;{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.65}}
  &gt;{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.11}}
  &gt;{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.12}}
  &gt;{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.12}}@{}}
\GovAction  &amp; \CC  &amp;  \DRep &amp; \SPO \\
\hline
\endhead
1. Motion of no-confidence &amp; - &amp; \Pone &amp; \Qone \\
2a. New committee/threshold (\emph{normal state}) &amp; - &amp; \Ptwoa &amp; \Qtwoa \\
2b. New committee/threshold (\emph{state of no-confidence}) &amp; - &amp; \Ptwob &amp; \Qtwob \\
3. Update to the Constitution &amp; \ding{51} &amp; \Pthree &amp; - \\
4. Hard-fork initiation &amp; \ding{51} &amp; \Pfour &amp; \Qfour \\
5a. Changes to protocol parameters in the \NetworkGroup &amp; \ding{51} &amp; \Pfivea &amp; - \\
5b. Changes to protocol parameters in the \EconomicGroup &amp; \ding{51} &amp; \Pfiveb &amp; - \\
5c. Changes to protocol parameters in the \TechnicalGroup &amp; \ding{51} &amp; \Pfivec &amp; - \\
5d. Changes to protocol parameters in the \GovernanceGroup &amp; \ding{51} &amp; \Pfived &amp; - \\
6. Treasury withdrawal &amp; \ding{51} &amp; \Psix &amp; - \\
7. Info &amp; \ding{51} &amp; \(100\) &amp; \(100\) \\
\end{longtable}
\caption{Ratification requirements}
\label{fig:ratification-requirements}
\end{figure*}
Each of these thresholds is a governance parameter.  The two thresholds for the \Info
action are set to 100\% since setting it any lower would result in not being able to poll
above the threshold.

\subsection{Ratification restrictions}
\label{sec:ratification-restrictions}
</a><a id="4061" class="Markup">\begin{code}[hide]</a>
<a id="4080" class="Symbol">{-#</a> <a id="4084" class="Keyword">OPTIONS</a> <a id="4092" class="Pragma">--safe</a> <a id="4099" class="Symbol">#-}</a>

<a id="4104" class="Keyword">import</a> <a id="4111" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="4124" class="Symbol">as</a> <a id="4127" class="Module">Z</a>
<a id="4129" class="Keyword">import</a> <a id="4136" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="4150" class="Symbol">as</a> <a id="4153" class="Module">R</a>
<a id="4155" class="Keyword">open</a> <a id="4160" class="Keyword">import</a> <a id="4167" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="4176" class="Keyword">using</a> <a id="4182" class="Symbol">(</a><a id="4183" href="Data.Nat.Base.html#1894" class="Function Operator">_≥_</a><a id="4186" class="Symbol">)</a>
<a id="4188" class="Keyword">open</a> <a id="4193" class="Keyword">import</a> <a id="4200" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="4220" class="Keyword">hiding</a> <a id="4227" class="Symbol">(</a><a id="4228" href="Data.Nat.Properties.html#2936" class="Function Operator">_≟_</a><a id="4231" class="Symbol">)</a>
<a id="4233" class="Keyword">open</a> <a id="4238" class="Keyword">import</a> <a id="4245" href="Data.Nat.Properties.Ext.html" class="Module">Data.Nat.Properties.Ext</a>

<a id="4270" class="Keyword">open</a> <a id="4275" class="Keyword">import</a> <a id="4282" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="4297" class="Keyword">hiding</a> <a id="4304" class="Symbol">(</a><a id="4305" href="Data.Bool.Base.html#986" class="Function Operator">_∧_</a><a id="4308" class="Symbol">)</a>
<a id="4310" class="Keyword">open</a> <a id="4315" class="Keyword">import</a> <a id="4322" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="4342" class="Keyword">module</a> <a id="4349" href="Ledger.Ratify.html" class="Module">Ledger.Ratify</a> <a id="4363" class="Symbol">(</a><a id="4364" href="Ledger.Ratify.html#4364" class="Bound">txs</a> <a id="4368" class="Symbol">:</a> <a id="4370" class="Symbol">_)</a> <a id="4373" class="Symbol">(</a><a id="4374" class="Keyword">open</a> <a id="4379" href="Ledger.Transaction.html#617" class="Module">TransactionStructure</a> <a id="4400" href="Ledger.Ratify.html#4364" class="Bound">txs</a><a id="4403" class="Symbol">)</a> <a id="4405" class="Keyword">where</a>

<a id="4412" class="Keyword">open</a> <a id="4417" class="Keyword">import</a> <a id="4424" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="4435" href="Ledger.Transaction.html#2486" class="Function">govStructure</a>

<a id="4449" class="Keyword">infixr</a> <a id="4456" class="Number">2</a> <a id="4458" href="Ledger.Ratify.html#4462" class="Function Operator">_∧_</a>
<a id="_∧_"></a><a id="4462" href="Ledger.Ratify.html#4462" class="Function Operator">_∧_</a> <a id="4466" class="Symbol">=</a> <a id="4468" href="Data.Product.Base.html#1109" class="Function Operator">_×_</a>

<a id="4473" class="Keyword">instance</a>
  <a id="4484" href="Ledger.Ratify.html#4484" class="Function">_</a> <a id="4486" class="Symbol">=</a> <a id="4488" href="Data.Nat.Properties.html#16466" class="Function">+-0-commutativeMonoid</a>
  <a id="4512" href="Ledger.Ratify.html#4512" class="Function">_</a> <a id="4514" class="Symbol">=</a> <a id="4516" href="Data.Nat.Properties.html#16387" class="Function">+-0-monoid</a>
<a id="4527" class="Markup">\end{code}</a><a id="4537" class="Background">
\begin{figure*}[h!]
{\small
</a><a id="4566" class="Markup">\begin{code}</a>
<a id="4579" class="Keyword">record</a> <a id="StakeDistrs"></a><a id="4586" href="Ledger.Ratify.html#4586" class="Record">StakeDistrs</a> <a id="4598" class="Symbol">:</a> <a id="4600" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4604" class="Keyword">where</a>
  <a id="4612" class="Keyword">field</a> <a id="StakeDistrs.stakeDistr"></a><a id="4618" href="Ledger.Ratify.html#4618" class="Field">stakeDistr</a>  <a id="4630" class="Symbol">:</a> <a id="4632" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="4639" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="4641" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>

<a id="4647" class="Keyword">record</a> <a id="RatifyEnv"></a><a id="4654" href="Ledger.Ratify.html#4654" class="Record">RatifyEnv</a> <a id="4664" class="Symbol">:</a> <a id="4666" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4670" class="Keyword">where</a>
  <a id="4678" class="Keyword">field</a> <a id="RatifyEnv.stakeDistrs"></a><a id="4684" href="Ledger.Ratify.html#4684" class="Field">stakeDistrs</a>   <a id="4698" class="Symbol">:</a> <a id="4700" href="Ledger.Ratify.html#4586" class="Record">StakeDistrs</a>
        <a id="RatifyEnv.currentEpoch"></a><a id="4720" href="Ledger.Ratify.html#4720" class="Field">currentEpoch</a>  <a id="4734" class="Symbol">:</a> <a id="4736" href="Ledger.Epoch.html#502" class="Function">Epoch</a>
        <a id="RatifyEnv.dreps"></a><a id="4750" href="Ledger.Ratify.html#4750" class="Field">dreps</a>         <a id="4764" class="Symbol">:</a> <a id="4766" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="4777" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="4779" href="Ledger.Epoch.html#502" class="Function">Epoch</a>
        <a id="RatifyEnv.ccHotKeys"></a><a id="4793" href="Ledger.Ratify.html#4793" class="Field">ccHotKeys</a>     <a id="4807" class="Symbol">:</a> <a id="4809" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="4820" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="4822" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4828" href="Ledger.Address.html#713" class="Function">Credential</a>
        <a id="RatifyEnv.treasury"></a><a id="4847" href="Ledger.Ratify.html#4847" class="Field">treasury</a>      <a id="4861" class="Symbol">:</a> <a id="4863" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>

<a id="4869" class="Keyword">record</a> <a id="RatifyState"></a><a id="4876" href="Ledger.Ratify.html#4876" class="Record">RatifyState</a> <a id="4888" class="Symbol">:</a> <a id="4890" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4894" class="Keyword">where</a>
  <a id="4902" class="Keyword">constructor</a> <a id="⟦_,_,_⟧ʳ"></a><a id="4914" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟦_,_,_⟧ʳ</a>
  <a id="4925" class="Keyword">field</a> <a id="RatifyState.es"></a><a id="4931" href="Ledger.Ratify.html#4931" class="Field">es</a>              <a id="4947" class="Symbol">:</a> <a id="4949" href="Ledger.GovernanceActions.html#11944" class="Record">EnactState</a>
        <a id="RatifyState.removed"></a><a id="4968" href="Ledger.Ratify.html#4968" class="Field">removed</a>         <a id="4984" class="Symbol">:</a> <a id="4986" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="4988" class="Symbol">(</a><a id="4989" href="Ledger.GovernanceActions.html#957" class="Function">GovActionID</a> <a id="5001" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5003" href="Ledger.Gov.html#690" class="Record">GovActionState</a><a id="5017" class="Symbol">)</a>
        <a id="RatifyState.delay"></a><a id="5027" href="Ledger.Ratify.html#5027" class="Field">delay</a>           <a id="5043" class="Symbol">:</a> <a id="5045" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>

<a id="CCData"></a><a id="5051" href="Ledger.Ratify.html#5051" class="Function">CCData</a> <a id="5058" class="Symbol">:</a> <a id="5060" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="5064" href="Ledger.Ratify.html#5051" class="Function">CCData</a> <a id="5071" class="Symbol">=</a> <a id="5073" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5079" class="Symbol">(</a><a id="5080" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="5091" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="5093" href="Ledger.Epoch.html#502" class="Function">Epoch</a> <a id="5099" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="5101" href="Data.Rational.Base.html#1287" class="Record">R.ℚ</a><a id="5104" class="Symbol">)</a>

<a id="isCC"></a><a id="5107" href="Ledger.Ratify.html#5107" class="Function">isCC</a> <a id="5112" class="Symbol">:</a> <a id="5114" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="5121" class="Symbol">→</a> <a id="5123" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="5128" href="Ledger.Ratify.html#5107" class="Function">isCC</a> <a id="5133" class="Symbol">(</a><a id="5134" href="Ledger.GovernanceActions.html#1075" class="InductiveConstructor">credVoter</a> <a id="5144" href="Ledger.GovernanceActions.html#1026" class="InductiveConstructor">CC</a> <a id="5147" class="Symbol">_)</a>  <a id="5151" class="Symbol">=</a> <a id="5153" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="5158" href="Ledger.Ratify.html#5107" class="CatchallClause Function">isCC</a><a id="5162" class="CatchallClause"> </a><a id="5163" class="CatchallClause Symbol">_</a>                 <a id="5181" class="Symbol">=</a> <a id="5183" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>

<a id="isDRep"></a><a id="5190" href="Ledger.Ratify.html#5190" class="Function">isDRep</a> <a id="5197" class="Symbol">:</a> <a id="5199" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="5206" class="Symbol">→</a> <a id="5208" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="5213" href="Ledger.Ratify.html#5190" class="Function">isDRep</a> <a id="5220" class="Symbol">(</a><a id="5221" href="Ledger.GovernanceActions.html#1075" class="InductiveConstructor">credVoter</a> <a id="5231" href="Ledger.GovernanceActions.html#1029" class="InductiveConstructor">DRep</a> <a id="5236" class="Symbol">_)</a>  <a id="5240" class="Symbol">=</a> <a id="5242" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="5247" href="Ledger.Ratify.html#5190" class="CatchallClause Function">isDRep</a><a id="5253" class="CatchallClause"> </a><a id="5254" class="CatchallClause Symbol">(</a><a id="5255" href="Ledger.GovernanceActions.html#1075" class="CatchallClause InductiveConstructor">credVoter</a><a id="5264" class="CatchallClause"> </a><a id="5265" class="CatchallClause Symbol">_</a><a id="5266" class="CatchallClause"> </a><a id="5267" class="CatchallClause Symbol">_)</a>     <a id="5274" class="Symbol">=</a> <a id="5276" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
<a id="5282" href="Ledger.Ratify.html#5190" class="Function">isDRep</a> <a id="5289" href="Ledger.GovernanceActions.html#1126" class="InductiveConstructor">abstainRep</a>          <a id="5309" class="Symbol">=</a> <a id="5311" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="5316" href="Ledger.Ratify.html#5190" class="Function">isDRep</a> <a id="5323" href="Ledger.GovernanceActions.html#1154" class="InductiveConstructor">noConfidenceRep</a>     <a id="5343" class="Symbol">=</a> <a id="5345" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>

<a id="isSPO"></a><a id="5351" href="Ledger.Ratify.html#5351" class="Function">isSPO</a> <a id="5357" class="Symbol">:</a> <a id="5359" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="5366" class="Symbol">→</a> <a id="5368" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="5373" href="Ledger.Ratify.html#5351" class="Function">isSPO</a> <a id="5379" class="Symbol">(</a><a id="5380" href="Ledger.GovernanceActions.html#1075" class="InductiveConstructor">credVoter</a> <a id="5390" href="Ledger.GovernanceActions.html#1034" class="InductiveConstructor">SPO</a> <a id="5394" class="Symbol">_)</a>  <a id="5398" class="Symbol">=</a> <a id="5400" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="5405" href="Ledger.Ratify.html#5351" class="CatchallClause Function">isSPO</a><a id="5410" class="CatchallClause"> </a><a id="5411" class="CatchallClause Symbol">_</a>                  <a id="5430" class="Symbol">=</a> <a id="5432" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
<a id="5438" class="Markup">\end{code}</a><a id="5448" class="Background">
</a><a id="5449" class="Markup">\begin{code}[hide]</a>
<a id="isCCProp"></a><a id="5468" href="Ledger.Ratify.html#5468" class="Function">isCCProp</a> <a id="5477" class="Symbol">:</a> <a id="5479" href="Axiom.Set.html#1164" class="Function">specProperty</a> <a id="5492" class="Symbol">λ</a> <a id="5494" href="Ledger.Ratify.html#5494" class="Bound">x</a> <a id="5496" class="Symbol">→</a> <a id="5498" href="Ledger.Ratify.html#5107" class="Function">isCC</a> <a id="5503" href="Ledger.Ratify.html#5494" class="Bound">x</a> <a id="5505" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5507" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="5512" href="Ledger.Ratify.html#5468" class="Function">isCCProp</a> <a id="5521" class="Symbol">=</a> <a id="5523" href="Ledger.Prelude.html#1675" class="Function">to-sp</a> <a id="5529" class="Symbol">(λ</a> <a id="5532" href="Ledger.Ratify.html#5532" class="Bound">x</a> <a id="5534" class="Symbol">→</a> <a id="5536" href="Ledger.Ratify.html#5107" class="Function">isCC</a> <a id="5541" href="Ledger.Ratify.html#5532" class="Bound">x</a> <a id="5543" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="5545" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="5549" class="Symbol">)</a>

<a id="isDRepProp"></a><a id="5552" href="Ledger.Ratify.html#5552" class="Function">isDRepProp</a> <a id="5563" class="Symbol">:</a> <a id="5565" href="Axiom.Set.html#1164" class="Function">specProperty</a> <a id="5578" class="Symbol">λ</a> <a id="5580" href="Ledger.Ratify.html#5580" class="Bound">x</a> <a id="5582" class="Symbol">→</a> <a id="5584" href="Ledger.Ratify.html#5190" class="Function">isDRep</a> <a id="5591" href="Ledger.Ratify.html#5580" class="Bound">x</a> <a id="5593" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5595" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="5600" href="Ledger.Ratify.html#5552" class="Function">isDRepProp</a> <a id="5611" class="Symbol">=</a> <a id="5613" href="Ledger.Prelude.html#1675" class="Function">to-sp</a> <a id="5619" class="Symbol">(λ</a> <a id="5622" href="Ledger.Ratify.html#5622" class="Bound">x</a> <a id="5624" class="Symbol">→</a> <a id="5626" href="Ledger.Ratify.html#5190" class="Function">isDRep</a> <a id="5633" href="Ledger.Ratify.html#5622" class="Bound">x</a> <a id="5635" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="5637" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="5641" class="Symbol">)</a>

<a id="isSPOProp"></a><a id="5644" href="Ledger.Ratify.html#5644" class="Function">isSPOProp</a> <a id="5654" class="Symbol">:</a> <a id="5656" href="Axiom.Set.html#1164" class="Function">specProperty</a> <a id="5669" class="Symbol">λ</a> <a id="5671" href="Ledger.Ratify.html#5671" class="Bound">x</a> <a id="5673" class="Symbol">→</a> <a id="5675" href="Ledger.Ratify.html#5351" class="Function">isSPO</a> <a id="5681" href="Ledger.Ratify.html#5671" class="Bound">x</a> <a id="5683" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5685" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="5690" href="Ledger.Ratify.html#5644" class="Function">isSPOProp</a> <a id="5700" class="Symbol">=</a> <a id="5702" href="Ledger.Prelude.html#1675" class="Function">to-sp</a> <a id="5708" class="Symbol">(λ</a> <a id="5711" href="Ledger.Ratify.html#5711" class="Bound">x</a> <a id="5713" class="Symbol">→</a> <a id="5715" href="Ledger.Ratify.html#5351" class="Function">isSPO</a> <a id="5721" href="Ledger.Ratify.html#5711" class="Bound">x</a> <a id="5723" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="5725" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="5729" class="Symbol">)</a>
<a id="5731" class="Markup">\end{code}</a><a id="5741" class="Background">
} %% end small
\caption{Types and functions for the RATIFY transition system}
\label{fig:types-and-functions-for-the-ratify-transition-system}
\end{figure*}
As mentioned earlier, each \GovAction must include a \GovActionID
for the most recently enacted action of its given type. Consequently, two actions of the
same type can be enacted at the same time, but they must be \emph{deliberately}
designed to do so.

Figure~\ref{fig:types-and-functions-for-the-ratify-transition-system} defines three more types and some helper functions used in the ratification transition system.
\begin{itemize}
\item \StakeDistrs represents a map relating each voting delegate to an amount of stake;
\item \RatifyEnv denotes an environment with data required for ratification;
\item \RatifyState denotes an enactment state that exists during ratification;
\item \CCData stores data about the constitutional committee.
\item \isCC, \isDRep, and \isSPO, which return \true if the given delegate is a \CC member, a \DRep, or an \SPO (resp.) and \false otherwise.
\end{itemize}
</a><a id="6798" class="Markup">\begin{code}[hide]</a>
<a id="6817" class="Comment">-- TODO: remove these or put them into RatifyState</a>
<a id="coinThreshold"></a><a id="6868" href="Ledger.Ratify.html#6868" class="Function">coinThreshold</a> <a id="rankThreshold"></a><a id="6882" href="Ledger.Ratify.html#6882" class="Function">rankThreshold</a> <a id="6896" class="Symbol">:</a> <a id="6898" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
<a id="6900" href="Ledger.Ratify.html#6868" class="Function">coinThreshold</a> <a id="6914" class="Symbol">=</a> <a id="6916" class="Number">1000000000</a>
<a id="6927" href="Ledger.Ratify.html#6882" class="Function">rankThreshold</a> <a id="6941" class="Symbol">=</a> <a id="6943" class="Number">1000</a>

<a id="6949" class="Comment">-- DReps with at least `c` coins</a>
<a id="mostStakeDRepDist"></a><a id="6982" href="Ledger.Ratify.html#6982" class="Function">mostStakeDRepDist</a> <a id="7000" class="Symbol">:</a> <a id="7002" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="7013" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="7015" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="7020" class="Symbol">→</a> <a id="7022" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="7027" class="Symbol">→</a> <a id="7029" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="7040" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="7042" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="7047" href="Ledger.Ratify.html#6982" class="Function">mostStakeDRepDist</a> <a id="7065" href="Ledger.Ratify.html#7065" class="Bound">dist</a> <a id="7070" href="Ledger.Ratify.html#7070" class="Bound">c</a> <a id="7072" class="Symbol">=</a> <a id="7074" href="Ledger.Ratify.html#7065" class="Bound">dist</a> <a id="7079" href="Axiom.Set.Map.html#7506" class="Function Operator">↾&#39;</a> <a id="7082" href="Ledger.Prelude.html#1675" class="Function">to-sp</a> <a id="7088" class="Symbol">(</a><a id="7089" href="Data.Nat.Properties.html#5938" class="Function Operator">_≥?</a> <a id="7093" href="Ledger.Ratify.html#7070" class="Bound">c</a><a id="7094" class="Symbol">)</a>

<a id="7097" class="Comment">-- mostStakeDRepDist-homomorphic : ∀ {dist} → Homomorphic₂ _ _ _&gt;_ (_⊆_ on _ˢ) (mostStakeDRepDist dist)</a>
<a id="7201" class="Comment">-- mostStakeDRepDist-homomorphic x&gt;y = impl⇒cores⊆ _ _ {!!} --(&lt;-trans x&gt;y)</a>

<a id="mostStakeDRepDist-0"></a><a id="7278" href="Ledger.Ratify.html#7278" class="Function">mostStakeDRepDist-0</a> <a id="7298" class="Symbol">:</a> <a id="7300" class="Symbol">∀</a> <a id="7302" class="Symbol">{</a><a id="7303" href="Ledger.Ratify.html#7303" class="Bound">dist</a><a id="7307" class="Symbol">}</a> <a id="7309" class="Symbol">→</a> <a id="7311" href="Ledger.Ratify.html#6982" class="Function">mostStakeDRepDist</a> <a id="7329" href="Ledger.Ratify.html#7303" class="Bound">dist</a> <a id="7334" class="Number">0</a> <a id="7336" href="Axiom.Set.Map.html#2441" class="Function Operator">≡ᵉᵐ</a> <a id="7340" href="Ledger.Ratify.html#7303" class="Bound">dist</a>
<a id="7345" href="Ledger.Ratify.html#7278" class="Function">mostStakeDRepDist-0</a> <a id="7365" class="Symbol">=</a> <a id="7367" class="Symbol">(</a><a id="7368" href="Data.Product.Base.html#622" class="Field">proj₂</a> <a id="7374" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="7376" href="Function.Bundles.html#4422" class="Field">Equivalence.from</a> <a id="7393" href="Axiom.Set.html#5370" class="Function">∈-filter</a><a id="7401" class="Symbol">)</a>
                    <a id="7423" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="7425" class="Symbol">λ</a> <a id="7427" href="Ledger.Ratify.html#7427" class="Bound">x</a> <a id="7429" class="Symbol">→</a> <a id="7431" href="Function.Bundles.html#4398" class="Field">Equivalence.to</a> <a id="7446" href="Axiom.Set.html#5370" class="Function">∈-filter</a> <a id="7455" class="Symbol">(</a><a id="7456" href="Data.Nat.Base.html#1558" class="InductiveConstructor">z≤n</a> <a id="7460" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="7462" href="Ledger.Ratify.html#7427" class="Bound">x</a><a id="7463" class="Symbol">)</a>

<a id="7466" class="Comment">-- TODO: maybe this can be proven easier with the maximum?</a>
<a id="mostStakeDRepDist-∅"></a><a id="7525" href="Ledger.Ratify.html#7525" class="Function">mostStakeDRepDist-∅</a> <a id="7545" class="Symbol">:</a> <a id="7547" class="Symbol">∀</a> <a id="7549" class="Symbol">{</a><a id="7550" href="Ledger.Ratify.html#7550" class="Bound">dist</a><a id="7554" class="Symbol">}</a> <a id="7556" class="Symbol">→</a> <a id="7558" href="Data.Product.html#1085" class="Function">∃[</a> <a id="7561" href="Ledger.Ratify.html#7561" class="Bound">N</a> <a id="7563" href="Data.Product.html#1085" class="Function">]</a> <a id="7565" href="Ledger.Ratify.html#6982" class="Function">mostStakeDRepDist</a> <a id="7583" href="Ledger.Ratify.html#7550" class="Bound">dist</a> <a id="7588" href="Ledger.Ratify.html#7561" class="Bound">N</a> <a id="7590" href="Axiom.Set.Map.html#2295" class="Function Operator">ˢ</a> <a id="7592" href="Axiom.Set.html#2471" class="Function Operator">≡ᵉ</a> <a id="7595" href="Axiom.Set.html#5746" class="Function">∅</a>
<a id="7597" href="Ledger.Ratify.html#7525" class="Function">mostStakeDRepDist-∅</a> <a id="7617" class="Symbol">{</a><a id="7618" href="Ledger.Ratify.html#7618" class="Bound">dist</a><a id="7622" class="Symbol">}</a> <a id="7624" class="Symbol">=</a> <a id="7626" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="7630" class="Symbol">(</a><a id="7631" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="7636" href="Ledger.Ratify.html#7636" class="Bound">x</a> <a id="7638" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="7640" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="7645" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="7648" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="7650" href="Ledger.Ratify.html#7636" class="Bound">x</a><a id="7651" class="Symbol">)</a> <a id="7653" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="7655" href="Axiom.Set.Properties.html#5373" class="Function">Properties.∅-least</a>
  <a id="7676" class="Symbol">(</a><a id="7677" href="Data.Empty.html#1041" class="Function">⊥-elim</a> <a id="7684" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="7686" href="Data.Product.Base.html#2600" class="Function">uncurry</a> <a id="7694" href="Ledger.Ratify.html#7764" class="Function">helper</a> <a id="7701" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="7703" href="Function.Bundles.html#4422" class="Field">Equivalence.from</a> <a id="7720" href="Axiom.Set.html#5370" class="Function">∈-filter</a><a id="7728" class="Symbol">)</a>
  <a id="7732" class="Keyword">where</a>
    <a id="7742" class="Keyword">open</a> <a id="7747" href="Data.Nat.Properties.html#13860" class="Module">≤-Reasoning</a>

    <a id="7764" href="Ledger.Ratify.html#7764" class="Function">helper</a> <a id="7771" class="Symbol">:</a> <a id="7773" class="Symbol">∀</a> <a id="7775" class="Symbol">{</a><a id="7776" href="Ledger.Ratify.html#7776" class="Bound">k</a> <a id="7778" href="Ledger.Ratify.html#7778" class="Bound">v</a><a id="7779" class="Symbol">}</a> <a id="7781" class="Symbol">→</a> <a id="7783" href="Ledger.Ratify.html#7778" class="Bound">v</a> <a id="7785" href="Data.Nat.Base.html#1924" class="Function Operator">&gt;</a> <a id="7787" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="7792" href="Ledger.Ratify.html#7792" class="Bound">x</a> <a id="7794" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="7796" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="7801" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="7804" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="7806" href="Ledger.Ratify.html#7792" class="Bound">x</a> <a id="7808" class="Symbol">→</a> <a id="7810" class="Symbol">(</a><a id="7811" href="Ledger.Ratify.html#7776" class="Bound">k</a> <a id="7813" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="7815" href="Ledger.Ratify.html#7778" class="Bound">v</a><a id="7816" class="Symbol">)</a> <a id="7818" href="Interface.IsSet.html#497" class="Function Operator">∉</a> <a id="7820" href="Ledger.Ratify.html#7618" class="Bound">dist</a>
    <a id="7829" href="Ledger.Ratify.html#7764" class="Function">helper</a> <a id="7836" class="Symbol">{</a><a id="7837" href="Ledger.Ratify.html#7837" class="Bound">k</a><a id="7838" class="Symbol">}</a> <a id="7840" class="Symbol">{</a><a id="7841" href="Ledger.Ratify.html#7841" class="Bound">v</a><a id="7842" class="Symbol">}</a> <a id="7844" href="Ledger.Ratify.html#7844" class="Bound">v&gt;sum</a> <a id="7850" href="Ledger.Ratify.html#7850" class="Bound">kv∈dist</a> <a id="7858" class="Symbol">=</a> <a id="7860" href="Data.Nat.Properties.html#7762" class="Function">1+n≰n</a> <a id="7866" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7868" href="Relation.Binary.Reasoning.Base.Triple.html#3164" class="Function Operator">begin-strict</a>
      <a id="7887" href="Ledger.Ratify.html#7841" class="Bound">v</a>
        <a id="7897" href="Relation.Binary.Reasoning.Base.Triple.html#4880" class="Function">≡˘⟨</a> <a id="7901" href="Axiom.Set.Sum.html#3962" class="Function">indexedSum-singleton&#39;</a> <a id="7923" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="7925" href="Ledger.Prelude.html#1755" class="Function">finiteness</a> <a id="7936" href="Axiom.Set.html#5995" class="Function Operator">❴</a> <a id="7938" href="Ledger.Ratify.html#7837" class="Bound">k</a> <a id="7940" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="7942" href="Ledger.Ratify.html#7841" class="Bound">v</a> <a id="7944" href="Axiom.Set.html#5995" class="Function Operator">❵</a> <a id="7946" href="Relation.Binary.Reasoning.Base.Triple.html#4880" class="Function">⟩</a>
      <a id="7954" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="7959" href="Ledger.Ratify.html#7959" class="Bound">x</a> <a id="7961" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="7963" href="Axiom.Set.Map.html#4558" class="Function Operator">❴</a> <a id="7965" href="Ledger.Ratify.html#7837" class="Bound">k</a> <a id="7967" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="7969" href="Ledger.Ratify.html#7841" class="Bound">v</a> <a id="7971" href="Axiom.Set.Map.html#4558" class="Function Operator">❵ᵐ</a> <a id="7974" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="7977" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="7979" href="Ledger.Ratify.html#7959" class="Bound">x</a>
        <a id="7989" href="Relation.Binary.Reasoning.Base.Triple.html#4880" class="Function">≡˘⟨</a> <a id="7993" href="Axiom.Set.Sum.html#4509" class="Function">indexedSumᵐ-cong</a> <a id="8010" class="Symbol">{</a><a id="8011" class="Argument">x</a> <a id="8013" class="Symbol">=</a> <a id="8015" class="Symbol">(</a><a id="8016" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="8021" href="Axiom.Set.Map.html#8760" class="Function Operator">∣</a> <a id="8023" href="Axiom.Set.html#5995" class="Function Operator">❴</a> <a id="8025" href="Ledger.Ratify.html#7837" class="Bound">k</a> <a id="8027" href="Axiom.Set.html#5995" class="Function Operator">❵</a><a id="8028" class="Symbol">)</a> <a id="8030" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a><a id="8032" class="Symbol">}</a> <a id="8034" class="Symbol">{</a><a id="8035" class="Argument">y</a> <a id="8037" class="Symbol">=</a> <a id="8039" href="Axiom.Set.Map.html#4558" class="Function Operator">❴</a> <a id="8041" href="Ledger.Ratify.html#7837" class="Bound">k</a> <a id="8043" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8045" href="Ledger.Ratify.html#7841" class="Bound">v</a> <a id="8047" href="Axiom.Set.Map.html#4558" class="Function Operator">❵ᵐ</a> <a id="8050" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a><a id="8052" class="Symbol">}</a>
          <a id="8064" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8066" href="Axiom.Set.Map.html#9796" class="Function">res-singleton&#39;</a> <a id="8081" class="Symbol">{</a><a id="8082" class="Argument">m</a> <a id="8084" class="Symbol">=</a> <a id="8086" href="Ledger.Ratify.html#7618" class="Bound">dist</a><a id="8090" class="Symbol">}</a> <a id="8092" href="Ledger.Ratify.html#7850" class="Bound">kv∈dist</a> <a id="8100" href="Relation.Binary.Reasoning.Base.Triple.html#4880" class="Function">⟩</a>
      <a id="8108" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="8113" href="Ledger.Ratify.html#8113" class="Bound">x</a> <a id="8115" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="8117" class="Symbol">(</a><a id="8118" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="8123" href="Axiom.Set.Map.html#8760" class="Function Operator">∣</a> <a id="8125" href="Axiom.Set.html#5995" class="Function Operator">❴</a> <a id="8127" href="Ledger.Ratify.html#7837" class="Bound">k</a> <a id="8129" href="Axiom.Set.html#5995" class="Function Operator">❵</a><a id="8130" class="Symbol">)</a> <a id="8132" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="8135" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="8137" href="Ledger.Ratify.html#8113" class="Bound">x</a>
        <a id="8147" href="Relation.Binary.Reasoning.Base.Triple.html#3755" class="Function">≤⟨</a> <a id="8150" href="Data.Nat.Properties.html#18325" class="Function">m≤m+n</a> <a id="8156" class="Symbol">_</a> <a id="8158" class="Symbol">_</a> <a id="8160" href="Relation.Binary.Reasoning.Base.Triple.html#3755" class="Function">⟩</a>
      <a id="8168" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="8173" href="Ledger.Ratify.html#8173" class="Bound">x</a> <a id="8175" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="8177" class="Symbol">(</a><a id="8178" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="8183" href="Axiom.Set.Map.html#8760" class="Function Operator">∣</a> <a id="8185" href="Axiom.Set.html#5995" class="Function Operator">❴</a> <a id="8187" href="Ledger.Ratify.html#7837" class="Bound">k</a> <a id="8189" href="Axiom.Set.html#5995" class="Function Operator">❵</a><a id="8190" class="Symbol">)</a> <a id="8192" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="8195" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="8197" href="Ledger.Ratify.html#8173" class="Bound">x</a> <a id="8199" href="Prelude.html#897" class="Primitive Operator">+ℕ</a> <a id="8202" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="8207" href="Ledger.Ratify.html#8207" class="Bound">x</a> <a id="8209" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="8211" class="Symbol">(</a><a id="8212" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="8217" href="Axiom.Set.Map.html#8830" class="Function Operator">∣</a> <a id="8219" href="Axiom.Set.html#5995" class="Function Operator">❴</a> <a id="8221" href="Ledger.Ratify.html#7837" class="Bound">k</a> <a id="8223" href="Axiom.Set.html#5995" class="Function Operator">❵</a> <a id="8225" href="Axiom.Set.Map.html#8830" class="Function Operator">ᶜ</a><a id="8226" class="Symbol">)</a> <a id="8228" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="8231" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="8233" href="Ledger.Ratify.html#8207" class="Bound">x</a>
        <a id="8243" href="Relation.Binary.Reasoning.Base.Triple.html#4880" class="Function">≡˘⟨</a> <a id="8247" href="Axiom.Set.Sum.html#5750" class="Function">indexedSumᵐ-partition</a> <a id="8269" class="Symbol">{</a><a id="8270" class="Argument">m</a> <a id="8272" class="Symbol">=</a> <a id="8274" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="8279" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a><a id="8281" class="Symbol">}</a> <a id="8283" class="Symbol">{(</a><a id="8285" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="8290" href="Axiom.Set.Map.html#8760" class="Function Operator">∣</a> <a id="8292" href="Axiom.Set.html#5995" class="Function Operator">❴</a> <a id="8294" href="Ledger.Ratify.html#7837" class="Bound">k</a> <a id="8296" href="Axiom.Set.html#5995" class="Function Operator">❵</a><a id="8297" class="Symbol">)</a> <a id="8299" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a><a id="8301" class="Symbol">}</a> <a id="8303" class="Symbol">{(</a><a id="8305" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="8310" href="Axiom.Set.Map.html#8830" class="Function Operator">∣</a> <a id="8312" href="Axiom.Set.html#5995" class="Function Operator">❴</a> <a id="8314" href="Ledger.Ratify.html#7837" class="Bound">k</a> <a id="8316" href="Axiom.Set.html#5995" class="Function Operator">❵</a> <a id="8318" href="Axiom.Set.Map.html#8830" class="Function Operator">ᶜ</a><a id="8319" class="Symbol">)</a> <a id="8321" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a><a id="8323" class="Symbol">}</a>
          <a id="8335" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8337" href="Axiom.Set.Rel.html#5864" class="Function">res-ex-disj-∪</a> <a id="8351" href="Axiom.Set.Properties.html#6485" class="Function">Properties.Dec-∈-singleton</a> <a id="8378" href="Relation.Binary.Reasoning.Base.Triple.html#4880" class="Function">⟩</a>
      <a id="8386" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="8391" href="Ledger.Ratify.html#8391" class="Bound">x</a> <a id="8393" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="8395" href="Ledger.Ratify.html#7618" class="Bound">dist</a> <a id="8400" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="8403" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="8405" href="Ledger.Ratify.html#8391" class="Bound">x</a>
        <a id="8415" href="Relation.Binary.Reasoning.Base.Triple.html#3470" class="Function">&lt;⟨</a> <a id="8418" href="Ledger.Ratify.html#7844" class="Bound">v&gt;sum</a> <a id="8424" href="Relation.Binary.Reasoning.Base.Triple.html#3470" class="Function">⟩</a>
      <a id="8432" href="Ledger.Ratify.html#7841" class="Bound">v</a> <a id="8434" href="Relation.Binary.Reasoning.Base.Triple.html#5129" class="Function Operator">∎</a>

<a id="∃topNDRepDist"></a><a id="8437" href="Ledger.Ratify.html#8437" class="Function">∃topNDRepDist</a> <a id="8451" class="Symbol">:</a> <a id="8453" class="Symbol">∀</a> <a id="8455" class="Symbol">{</a><a id="8456" href="Ledger.Ratify.html#8456" class="Bound">n</a> <a id="8458" href="Ledger.Ratify.html#8458" class="Bound">dist</a><a id="8462" class="Symbol">}</a> <a id="8464" class="Symbol">→</a> <a id="8466" href="Ledger.Prelude.html#1856" class="Function">lengthˢ</a> <a id="8474" class="Symbol">(</a><a id="8475" href="Ledger.Ratify.html#8458" class="Bound">dist</a> <a id="8480" href="Axiom.Set.Map.html#2295" class="Function Operator">ˢ</a><a id="8481" class="Symbol">)</a> <a id="8483" href="Data.Nat.Base.html#1894" class="Function Operator">≥</a> <a id="8485" href="Ledger.Ratify.html#8456" class="Bound">n</a> <a id="8487" class="Symbol">→</a> <a id="8489" href="Ledger.Ratify.html#8456" class="Bound">n</a> <a id="8491" href="Data.Nat.Base.html#1924" class="Function Operator">&gt;</a> <a id="8493" class="Number">0</a>
                <a id="8511" class="Symbol">→</a> <a id="8513" href="Data.Product.html#1085" class="Function">∃[</a> <a id="8516" href="Ledger.Ratify.html#8516" class="Bound">c</a> <a id="8518" href="Data.Product.html#1085" class="Function">]</a> <a id="8520" href="Ledger.Prelude.html#1856" class="Function">lengthˢ</a> <a id="8528" class="Symbol">(</a><a id="8529" href="Ledger.Ratify.html#6982" class="Function">mostStakeDRepDist</a> <a id="8547" href="Ledger.Ratify.html#8458" class="Bound">dist</a> <a id="8552" href="Ledger.Ratify.html#8516" class="Bound">c</a> <a id="8554" href="Axiom.Set.Map.html#2295" class="Function Operator">ˢ</a><a id="8555" class="Symbol">)</a> <a id="8557" href="Data.Nat.Base.html#1894" class="Function Operator">≥</a> <a id="8559" href="Ledger.Ratify.html#8456" class="Bound">n</a>
                       <a id="8584" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="8586" href="Ledger.Prelude.html#1856" class="Function">lengthˢ</a> <a id="8594" class="Symbol">(</a><a id="8595" href="Ledger.Ratify.html#6982" class="Function">mostStakeDRepDist</a> <a id="8613" href="Ledger.Ratify.html#8458" class="Bound">dist</a> <a id="8618" class="Symbol">(</a><a id="8619" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="8623" href="Ledger.Ratify.html#8516" class="Bound">c</a><a id="8624" class="Symbol">)</a> <a id="8626" href="Axiom.Set.Map.html#2295" class="Function Operator">ˢ</a><a id="8627" class="Symbol">)</a> <a id="8629" href="Data.Nat.Base.html#1645" class="Function Operator">Data.Nat.&lt;</a> <a id="8640" href="Ledger.Ratify.html#8456" class="Bound">n</a>
<a id="8642" href="Ledger.Ratify.html#8437" class="Function">∃topNDRepDist</a> <a id="8656" class="Symbol">{</a><a id="8657" href="Ledger.Ratify.html#8657" class="Bound">n</a><a id="8658" class="Symbol">}</a> <a id="8660" class="Symbol">{</a><a id="8661" href="Ledger.Ratify.html#8661" class="Bound">dist</a><a id="8665" class="Symbol">}</a> <a id="8667" href="Ledger.Ratify.html#8667" class="Bound">length≥n</a> <a id="8676" href="Ledger.Ratify.html#8676" class="Bound">n&gt;0</a> <a id="8680" class="Symbol">=</a>
  <a id="8684" class="Keyword">let</a>
    <a id="8692" href="Ledger.Ratify.html#8692" class="Bound">c</a> <a id="8694" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8696" href="Ledger.Ratify.html#8696" class="Bound">h</a> <a id="8698" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8700" href="Ledger.Ratify.html#8700" class="Bound">h&#39;</a> <a id="8703" class="Symbol">=</a>
      <a id="8711" href="Data.Nat.Properties.Ext.html#288" class="Function">negInduction</a> <a id="8724" class="Symbol">(λ</a> <a id="8727" href="Ledger.Ratify.html#8727" class="Bound">_</a> <a id="8729" class="Symbol">→</a> <a id="8731" class="Symbol">_</a> <a id="8733" href="Data.Nat.Properties.html#5938" class="Function Operator">≥?</a> <a id="8736" href="Ledger.Ratify.html#8657" class="Bound">n</a><a id="8737" class="Symbol">)</a>
        <a id="8747" class="Symbol">(</a><a id="8748" href="Relation.Binary.PropositionalEquality.Core.html#1794" class="Function">subst</a> <a id="8754" class="Symbol">(</a><a id="8755" href="Data.Nat.Base.html#1894" class="Function Operator">_≥</a> <a id="8758" href="Ledger.Ratify.html#8657" class="Bound">n</a><a id="8759" class="Symbol">)</a> <a id="8761" class="Symbol">(</a><a id="8762" href="Relation.Binary.PropositionalEquality.Core.html#1698" class="Function">sym</a> <a id="8766" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="8768" href="Ledger.Prelude.html#1971" class="Function">lengthˢ-≡ᵉ</a> <a id="8779" class="Symbol">_</a> <a id="8781" class="Symbol">_</a> <a id="8783" class="Symbol">(</a><a id="8784" href="Ledger.Ratify.html#7278" class="Function">mostStakeDRepDist-0</a> <a id="8804" class="Symbol">{</a><a id="8805" href="Ledger.Ratify.html#8661" class="Bound">dist</a><a id="8809" class="Symbol">}))</a> <a id="8813" href="Ledger.Ratify.html#8667" class="Bound">length≥n</a><a id="8821" class="Symbol">)</a>
        <a id="8831" class="Symbol">(</a><a id="8832" href="Interface.Bifunctor.html#813" class="Function">map₂′</a> <a id="8838" class="Symbol">(λ</a> <a id="8841" href="Ledger.Ratify.html#8841" class="Bound">h</a> <a id="8843" href="Ledger.Ratify.html#8843" class="Bound">h&#39;</a>
                  <a id="8864" class="Symbol">→</a> <a id="8866" href="Data.Nat.Properties.html#8366" class="Function">≤⇒≯</a> <a id="8870" class="Symbol">(</a><a id="8871" href="Relation.Binary.PropositionalEquality.Core.html#1794" class="Function">subst</a> <a id="8877" class="Symbol">(</a><a id="8878" href="Data.Nat.Base.html#1894" class="Function Operator">_≥</a> <a id="8881" href="Ledger.Ratify.html#8657" class="Bound">n</a><a id="8882" class="Symbol">)</a> <a id="8884" class="Symbol">(</a><a id="8885" href="Relation.Binary.PropositionalEquality.Core.html#1743" class="Function">trans</a> <a id="8891" class="Symbol">(</a><a id="8892" href="Ledger.Prelude.html#1971" class="Function">lengthˢ-≡ᵉ</a> <a id="8903" class="Symbol">_</a> <a id="8905" class="Symbol">_</a> <a id="8907" href="Ledger.Ratify.html#8841" class="Bound">h</a><a id="8908" class="Symbol">)</a> <a id="8910" href="Ledger.Prelude.html#2275" class="Function">lengthˢ-∅</a><a id="8919" class="Symbol">)</a> <a id="8921" href="Ledger.Ratify.html#8843" class="Bound">h&#39;</a><a id="8923" class="Symbol">)</a> <a id="8925" href="Ledger.Ratify.html#8676" class="Bound">n&gt;0</a><a id="8928" class="Symbol">)</a>
               <a id="8945" class="Symbol">(</a><a id="8946" href="Ledger.Ratify.html#7525" class="Function">mostStakeDRepDist-∅</a> <a id="8966" class="Symbol">{</a><a id="8967" href="Ledger.Ratify.html#8661" class="Bound">dist</a><a id="8971" class="Symbol">}))</a>
  <a id="8977" class="Keyword">in</a>
   <a id="8983" href="Ledger.Ratify.html#8692" class="Bound">c</a> <a id="8985" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8987" href="Ledger.Ratify.html#8696" class="Bound">h</a> <a id="8989" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="8991" href="Data.Nat.Properties.html#8584" class="Function">≰⇒&gt;</a> <a id="8995" href="Ledger.Ratify.html#8700" class="Bound">h&#39;</a>

<a id="topNDRepDist"></a><a id="8999" href="Ledger.Ratify.html#8999" class="Function">topNDRepDist</a> <a id="9012" class="Symbol">:</a> <a id="9014" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="9016" class="Symbol">→</a> <a id="9018" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="9029" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="9031" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="9036" class="Symbol">→</a> <a id="9038" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="9049" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="9051" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="9056" href="Ledger.Ratify.html#8999" class="Function">topNDRepDist</a> <a id="9069" href="Ledger.Ratify.html#9069" class="Bound">n</a> <a id="9071" href="Ledger.Ratify.html#9071" class="Bound">dist</a> <a id="9076" class="Symbol">=</a> <a id="9078" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="9083" class="Symbol">(</a><a id="9084" href="Ledger.Prelude.html#1856" class="Function">lengthˢ</a> <a id="9092" class="Symbol">(</a><a id="9093" href="Ledger.Ratify.html#9071" class="Bound">dist</a> <a id="9098" href="Axiom.Set.Map.html#2295" class="Function Operator">ˢ</a><a id="9099" class="Symbol">)</a> <a id="9101" href="Data.Nat.Properties.html#5938" class="Function Operator">≥?</a> <a id="9104" href="Ledger.Ratify.html#9069" class="Bound">n</a><a id="9105" class="Symbol">)</a> <a id="9107" href="Data.Product.Base.html#1177" class="Function Operator">,′</a> <a id="9110" class="Symbol">(</a><a id="9111" href="Ledger.Ratify.html#9069" class="Bound">n</a> <a id="9113" href="Data.Nat.Properties.html#10685" class="Function Operator">&gt;?</a> <a id="9116" class="Number">0</a><a id="9117" class="Symbol">)</a> <a id="9119" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="9122" class="Symbol">λ</a> <a id="9124" class="Keyword">where</a>
  <a id="9132" class="Symbol">(_</a>     <a id="9139" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9141" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a>  <a id="9145" class="Symbol">_)</a>  <a id="9149" class="Symbol">→</a> <a id="9151" href="Axiom.Set.Map.html#2741" class="Function">∅ᵐ</a>
  <a id="9156" class="Symbol">(</a><a id="9157" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="9160" class="Symbol">_</a>  <a id="9163" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9165" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="9169" class="Symbol">_)</a>  <a id="9173" class="Symbol">→</a> <a id="9175" href="Ledger.Ratify.html#9071" class="Bound">dist</a>
  <a id="9182" class="Symbol">(</a><a id="9183" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="9187" href="Ledger.Ratify.html#9187" class="Bound">p</a> <a id="9189" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="9191" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="9195" href="Ledger.Ratify.html#9195" class="Bound">p₁</a><a id="9197" class="Symbol">)</a> <a id="9199" class="Symbol">→</a> <a id="9201" href="Ledger.Ratify.html#6982" class="Function">mostStakeDRepDist</a> <a id="9219" href="Ledger.Ratify.html#9071" class="Bound">dist</a> <a id="9224" class="Symbol">(</a><a id="9225" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="9231" class="Symbol">(</a><a id="9232" href="Ledger.Ratify.html#8437" class="Function">∃topNDRepDist</a> <a id="9246" class="Symbol">{</a><a id="9247" class="Argument">dist</a> <a id="9252" class="Symbol">=</a> <a id="9254" href="Ledger.Ratify.html#9071" class="Bound">dist</a><a id="9258" class="Symbol">}</a> <a id="9260" href="Ledger.Ratify.html#9187" class="Bound">p</a> <a id="9262" href="Ledger.Ratify.html#9195" class="Bound">p₁</a><a id="9264" class="Symbol">))</a>

<a id="9268" class="Comment">-- restrict the DRep stake distribution</a>
<a id="9308" class="Comment">-- commented out for now, since we don&#39;t know if that&#39;ll actually be implemented</a>
<a id="restrictedDists"></a><a id="9389" href="Ledger.Ratify.html#9389" class="Function">restrictedDists</a> <a id="9405" class="Symbol">:</a> <a id="9407" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="9409" class="Symbol">→</a> <a id="9411" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="9413" class="Symbol">→</a> <a id="9415" href="Ledger.Ratify.html#4586" class="Record">StakeDistrs</a> <a id="9427" class="Symbol">→</a> <a id="9429" href="Ledger.Ratify.html#4586" class="Record">StakeDistrs</a>
<a id="9441" href="Ledger.Ratify.html#9389" class="Function">restrictedDists</a> <a id="9457" href="Ledger.Ratify.html#9457" class="Bound">coins</a> <a id="9463" href="Ledger.Ratify.html#9463" class="Bound">rank</a> <a id="9468" href="Ledger.Ratify.html#9468" class="Bound">dists</a> <a id="9474" class="Symbol">=</a> <a id="9476" href="Ledger.Ratify.html#9468" class="Bound">dists</a>
  <a id="9484" class="Comment">-- record dists { drepStakeDistr = restrict drepStakeDistr }</a>
  <a id="9547" class="Keyword">where</a> <a id="9553" class="Keyword">open</a> <a id="9558" href="Ledger.Ratify.html#4586" class="Module">StakeDistrs</a> <a id="9570" href="Ledger.Ratify.html#9468" class="Bound">dists</a>
        <a id="9584" class="Comment">-- one always includes the other</a>
        <a id="9625" href="Ledger.Ratify.html#9625" class="Function">restrict</a> <a id="9634" class="Symbol">:</a> <a id="9636" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="9647" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="9649" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="9654" class="Symbol">→</a> <a id="9656" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="9667" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="9669" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
        <a id="9682" href="Ledger.Ratify.html#9625" class="Function">restrict</a> <a id="9691" href="Ledger.Ratify.html#9691" class="Bound">dist</a> <a id="9696" class="Symbol">=</a> <a id="9698" href="Ledger.Ratify.html#8999" class="Function">topNDRepDist</a> <a id="9711" href="Ledger.Ratify.html#9463" class="Bound">rank</a> <a id="9716" href="Ledger.Ratify.html#9691" class="Bound">dist</a> <a id="9721" href="Axiom.Set.Map.html#4771" class="Function Operator">∪ᵐˡ</a> <a id="9725" href="Ledger.Ratify.html#6982" class="Function">mostStakeDRepDist</a> <a id="9743" href="Ledger.Ratify.html#9691" class="Bound">dist</a> <a id="9748" href="Ledger.Ratify.html#9457" class="Bound">coins</a>
<a id="9754" class="Markup">\end{code}</a><a id="9764" class="Background">
\begin{figure*}[h!]
{\small
</a><a id="9793" class="Markup">\begin{code}</a>
<a id="actualVotes"></a><a id="9806" href="Ledger.Ratify.html#9806" class="Function">actualVotes</a> <a id="9818" class="Symbol">:</a> <a id="9820" href="Ledger.Ratify.html#4654" class="Record">RatifyEnv</a> <a id="9830" class="Symbol">→</a> <a id="9832" href="Ledger.Ratify.html#5051" class="Function">CCData</a> <a id="9839" class="Symbol">→</a> <a id="9841" class="Symbol">(</a><a id="9842" href="Ledger.GovernanceActions.html#1004" class="Datatype">GovRole</a> <a id="9850" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="9852" href="Ledger.Address.html#713" class="Function">Credential</a><a id="9862" class="Symbol">)</a> <a id="9864" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="9866" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a> <a id="9871" class="Symbol">→</a> <a id="9873" href="Ledger.GovernanceActions.html#1262" class="Datatype">GovAction</a> <a id="9883" class="Symbol">→</a> <a id="9885" href="Ledger.PParams.html#1022" class="Record">PParams</a>
            <a id="9905" class="Symbol">→</a> <a id="9907" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="9914" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="9916" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a>
<a id="9921" href="Ledger.Ratify.html#9806" class="Function">actualVotes</a> <a id="9933" href="Ledger.Ratify.html#9933" class="Bound">Γ</a> <a id="9935" href="Ledger.Ratify.html#9935" class="Bound">cc</a> <a id="9938" href="Ledger.Ratify.html#9938" class="Bound">votes</a> <a id="9944" href="Ledger.Ratify.html#9944" class="Bound">ga</a> <a id="9947" href="Ledger.Ratify.html#9947" class="Bound">pparams</a>
  <a id="9957" class="Symbol">=</a>    <a id="9962" href="Axiom.Set.Map.html#6655" class="Function">mapKeys</a> <a id="9970" class="Symbol">(</a><a id="9971" href="Ledger.GovernanceActions.html#1075" class="InductiveConstructor">credVoter</a> <a id="9981" href="Ledger.GovernanceActions.html#1026" class="InductiveConstructor">CC</a><a id="9983" class="Symbol">)</a> <a id="9985" href="Ledger.Ratify.html#10800" class="Function">actualCCVotes</a>
  <a id="10001" href="Axiom.Set.Map.html#4771" class="Function Operator">∪ᵐˡ</a>  <a id="10006" href="Ledger.Ratify.html#11072" class="Function">actualPDRepVotes</a> <a id="10023" href="Axiom.Set.Map.html#4771" class="Function Operator">∪ᵐˡ</a> <a id="10027" href="Ledger.Ratify.html#11301" class="Function">actualDRepVotes</a>
  <a id="10045" href="Axiom.Set.Map.html#4771" class="Function Operator">∪ᵐˡ</a>  <a id="10050" href="Ledger.Ratify.html#11420" class="Function">actualSPOVotes</a>
  <a id="10067" class="Keyword">where</a>
    <a id="10077" class="Keyword">open</a> <a id="10082" href="Ledger.Ratify.html#4654" class="Module">RatifyEnv</a> <a id="10092" href="Ledger.Ratify.html#9933" class="Bound">Γ</a>
    <a id="10098" class="Keyword">open</a> <a id="10103" href="Ledger.PParams.html#1022" class="Module">PParams</a> <a id="10111" href="Ledger.Ratify.html#9947" class="Bound">pparams</a>

    <a id="10124" href="Ledger.Ratify.html#10124" class="Function">roleVotes</a> <a id="10134" class="Symbol">:</a> <a id="10136" href="Ledger.GovernanceActions.html#1004" class="Datatype">GovRole</a> <a id="10144" class="Symbol">→</a> <a id="10146" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="10153" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="10155" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a>
    <a id="10164" href="Ledger.Ratify.html#10124" class="Function">roleVotes</a> <a id="10174" href="Ledger.Ratify.html#10174" class="Bound">r</a> <a id="10176" class="Symbol">=</a> <a id="10178" href="Axiom.Set.Map.html#6655" class="Function">mapKeys</a> <a id="10186" class="Symbol">(</a><a id="10187" href="Data.Product.Base.html#2600" class="Function">uncurry</a> <a id="10195" href="Ledger.GovernanceActions.html#1075" class="InductiveConstructor">credVoter</a><a id="10204" class="Symbol">)</a> <a id="10206" class="Symbol">(</a><a id="10207" href="Ledger.Prelude.html#3831" class="Function">filterᵐ?</a> <a id="10216" class="Symbol">((</a><a id="10218" href="Ledger.Ratify.html#10174" class="Bound">r</a> <a id="10220" href="Interface.DecEq.html#243" class="Field Operator">≟_</a><a id="10222" class="Symbol">)</a> <a id="10224" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="10226" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="10232" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="10234" href="Data.Product.Base.html#608" class="Field">proj₁</a><a id="10239" class="Symbol">)</a> <a id="10241" href="Ledger.Ratify.html#9938" class="Bound">votes</a><a id="10246" class="Symbol">)</a>

    <a id="10253" href="Ledger.Ratify.html#10253" class="Function">activeCC</a> <a id="10262" href="Ledger.Ratify.html#10262" class="Function">activeDReps</a> <a id="10274" class="Symbol">:</a> <a id="10276" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="10278" href="Ledger.Address.html#713" class="Function">Credential</a>
    <a id="10293" href="Ledger.Ratify.html#10253" class="Function">activeCC</a> <a id="10302" class="Symbol">=</a> <a id="10304" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="10309" href="Ledger.Ratify.html#9935" class="Bound">cc</a> <a id="10312" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="10315" class="Symbol">λ</a> <a id="10317" class="Keyword">where</a>
      <a id="10329" class="Symbol">(</a><a id="10330" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="10335" class="Symbol">(</a><a id="10336" href="Ledger.Ratify.html#10336" class="Bound">cc</a> <a id="10339" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10341" class="Symbol">_))</a>  <a id="10346" class="Symbol">→</a> <a id="10348" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="10352" class="Symbol">(</a><a id="10353" href="Ledger.Prelude.html#3938" class="Function">filterᵐᵇ</a> <a id="10362" class="Symbol">(</a><a id="10363" href="Data.Maybe.Base.html#1096" class="Function">is-just</a> <a id="10371" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="10373" href="Data.Product.Base.html#622" class="Field">proj₂</a><a id="10378" class="Symbol">)</a> <a id="10380" class="Symbol">(</a><a id="10381" href="Ledger.Ratify.html#4793" class="Function">ccHotKeys</a> <a id="10391" href="Axiom.Set.Map.html#8760" class="Function Operator">∣</a> <a id="10393" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="10397" href="Ledger.Ratify.html#10336" class="Bound">cc</a><a id="10399" class="Symbol">))</a>
      <a id="10408" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>          <a id="10425" class="Symbol">→</a> <a id="10427" href="Axiom.Set.html#5746" class="Function">∅</a>

    <a id="10434" href="Ledger.Ratify.html#10262" class="Function">activeDReps</a> <a id="10446" class="Symbol">=</a> <a id="10448" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="10452" class="Symbol">(</a><a id="10453" href="Ledger.Prelude.html#3831" class="Function">filterᵐ?</a> <a id="10462" class="Symbol">(</a><a id="10463" href="Ledger.Ratify.html#4720" class="Function">currentEpoch</a> <a id="10476" href="Ledger.Epoch.html#2675" class="Function Operator">≤ᵉ?_</a> <a id="10481" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="10483" href="Data.Product.Base.html#622" class="Field">proj₂</a><a id="10488" class="Symbol">)</a> <a id="10490" href="Ledger.Ratify.html#4750" class="Function">dreps</a><a id="10495" class="Symbol">)</a>

    <a id="10502" href="Ledger.Ratify.html#10502" class="Function">actualCCVote</a> <a id="10515" class="Symbol">:</a> <a id="10517" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="10528" class="Symbol">→</a> <a id="10530" href="Ledger.Epoch.html#502" class="Function">Epoch</a> <a id="10536" class="Symbol">→</a> <a id="10538" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a>
    <a id="10547" href="Ledger.Ratify.html#10502" class="Function">actualCCVote</a> <a id="10560" href="Ledger.Ratify.html#10560" class="Bound">c</a> <a id="10562" href="Ledger.Ratify.html#10562" class="Bound">e</a> <a id="10564" class="Symbol">=</a>
      <a id="10572" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="10577" href="Interface.Decidable.Instance.html#796" class="Function Operator">¿</a> <a id="10579" href="Ledger.Ratify.html#4720" class="Function">currentEpoch</a> <a id="10592" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="10594" href="Ledger.Ratify.html#10562" class="Bound">e</a> <a id="10596" href="Interface.Decidable.Instance.html#796" class="Function Operator">¿ᵇ</a> <a id="10599" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10601" href="Axiom.Set.Map.html#10514" class="Function">lookupᵐ?</a> <a id="10610" href="Ledger.Ratify.html#4793" class="Function">ccHotKeys</a> <a id="10620" href="Ledger.Ratify.html#10560" class="Bound">c</a> <a id="10622" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="10625" class="Symbol">λ</a> <a id="10627" class="Keyword">where</a>
        <a id="10641" class="Symbol">(</a><a id="10642" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="10647" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10649" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="10654" class="Symbol">(</a><a id="10655" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="10660" href="Ledger.Ratify.html#10660" class="Bound">c&#39;</a><a id="10662" class="Symbol">))</a>  <a id="10666" class="Symbol">→</a> <a id="10668" href="Data.Maybe.Base.html#1377" class="Function">maybe</a> <a id="10674" href="Function.Base.html#695" class="Function">id</a> <a id="10677" href="Ledger.GovernanceActions.html#8328" class="InductiveConstructor">Vote.no</a> <a id="10685" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="10687" href="Axiom.Set.Map.html#10514" class="Function">lookupᵐ?</a> <a id="10696" href="Ledger.Ratify.html#9938" class="Bound">votes</a> <a id="10702" class="Symbol">(</a><a id="10703" href="Ledger.GovernanceActions.html#1026" class="InductiveConstructor">CC</a> <a id="10706" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10708" href="Ledger.Ratify.html#10660" class="Bound">c&#39;</a><a id="10710" class="Symbol">)</a>
        <a id="10720" class="CatchallClause Symbol">_</a>                        <a id="10745" class="Symbol">→</a> <a id="10747" href="Ledger.GovernanceActions.html#8331" class="InductiveConstructor">Vote.abstain</a> <a id="10760" class="Comment">-- expired, no hot key or resigned</a>

    <a id="10800" href="Ledger.Ratify.html#10800" class="Function">actualCCVotes</a> <a id="10814" class="Symbol">:</a> <a id="10816" href="Ledger.Address.html#713" class="Function">Credential</a> <a id="10827" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="10829" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a>
    <a id="10838" href="Ledger.Ratify.html#10800" class="Function">actualCCVotes</a> <a id="10852" class="Symbol">=</a> <a id="10854" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="10859" href="Ledger.Ratify.html#9935" class="Bound">cc</a> <a id="10862" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10864" href="Interface.Decidable.Instance.html#796" class="Function Operator">¿</a> <a id="10866" href="Ledger.PParams.html#2146" class="Field">ccMinSize</a> <a id="10876" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="10878" href="Ledger.Prelude.html#1856" class="Function">lengthˢ</a> <a id="10886" href="Ledger.Ratify.html#10253" class="Function">activeCC</a> <a id="10895" href="Interface.Decidable.Instance.html#796" class="Function Operator">¿ᵇ</a> <a id="10898" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="10901" class="Symbol">λ</a> <a id="10903" class="Keyword">where</a>
      <a id="10915" class="Symbol">(</a><a id="10916" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="10921" class="Symbol">(</a><a id="10922" href="Ledger.Ratify.html#10922" class="Bound">cc</a> <a id="10925" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10927" class="Symbol">_)</a>  <a id="10931" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10933" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="10937" class="Symbol">)</a>   <a id="10941" class="Symbol">→</a> <a id="10943" href="Axiom.Set.Map.html#7180" class="Function">mapWithKey</a> <a id="10954" href="Ledger.Ratify.html#10502" class="Function">actualCCVote</a> <a id="10967" href="Ledger.Ratify.html#10922" class="Bound">cc</a>
      <a id="10976" class="Symbol">(</a><a id="10977" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="10982" class="Symbol">(</a><a id="10983" href="Ledger.Ratify.html#10983" class="Bound">cc</a> <a id="10986" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10988" class="Symbol">_)</a>  <a id="10992" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="10994" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a><a id="10999" class="Symbol">)</a>  <a id="11002" class="Symbol">→</a> <a id="11004" href="Axiom.Set.Map.html#7602" class="Function">constMap</a> <a id="11013" class="Symbol">(</a><a id="11014" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="11018" href="Ledger.Ratify.html#10983" class="Bound">cc</a><a id="11020" class="Symbol">)</a> <a id="11022" href="Ledger.GovernanceActions.html#8328" class="InductiveConstructor">Vote.no</a>
      <a id="11036" class="Symbol">(</a><a id="11037" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>        <a id="11052" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11054" class="Symbol">_)</a>      <a id="11062" class="Symbol">→</a> <a id="11064" href="Axiom.Set.Map.html#2741" class="Function">∅ᵐ</a>

    <a id="11072" href="Ledger.Ratify.html#11072" class="Function">actualPDRepVotes</a>
      <a id="11095" class="Symbol">=</a>    <a id="11100" href="Axiom.Set.Map.html#4558" class="Function Operator">❴</a> <a id="11102" href="Ledger.GovernanceActions.html#1126" class="InductiveConstructor">abstainRep</a>       <a id="11119" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11121" href="Ledger.GovernanceActions.html#8331" class="InductiveConstructor">Vote.abstain</a> <a id="11134" href="Axiom.Set.Map.html#4558" class="Function Operator">❵ᵐ</a>
      <a id="11143" href="Axiom.Set.Map.html#4771" class="Function Operator">∪ᵐˡ</a>  <a id="11148" href="Axiom.Set.Map.html#4558" class="Function Operator">❴</a> <a id="11150" href="Ledger.GovernanceActions.html#1154" class="InductiveConstructor">noConfidenceRep</a>  <a id="11167" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11169" class="Symbol">(</a><a id="11170" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="11175" href="Ledger.Ratify.html#9944" class="Bound">ga</a> <a id="11178" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="11181" class="Symbol">λ</a> <a id="11183" class="Keyword">where</a>  <a id="11190" href="Ledger.GovernanceActions.html#1286" class="InductiveConstructor">NoConfidence</a>  <a id="11204" class="Symbol">→</a> <a id="11206" href="Ledger.GovernanceActions.html#8324" class="InductiveConstructor">Vote.yes</a>
                                                     <a id="11268" class="CatchallClause Symbol">_</a>             <a id="11282" class="Symbol">→</a> <a id="11284" href="Ledger.GovernanceActions.html#8328" class="InductiveConstructor">Vote.no</a><a id="11291" class="Symbol">)</a> <a id="11293" href="Axiom.Set.Map.html#4558" class="Function Operator">❵ᵐ</a>

    <a id="11301" href="Ledger.Ratify.html#11301" class="Function">actualDRepVotes</a>
      <a id="11323" class="Symbol">=</a>    <a id="11328" href="Ledger.Ratify.html#10124" class="Function">roleVotes</a> <a id="11338" href="Ledger.GovernanceActions.html#1029" class="InductiveConstructor">GovRole.DRep</a>
      <a id="11357" href="Axiom.Set.Map.html#4771" class="Function Operator">∪ᵐˡ</a>  <a id="11362" href="Axiom.Set.Map.html#7602" class="Function">constMap</a> <a id="11371" class="Symbol">(</a><a id="11372" href="Ledger.Prelude.html#1544" class="Function">mapˢ</a> <a id="11377" class="Symbol">(</a><a id="11378" href="Ledger.GovernanceActions.html#1075" class="InductiveConstructor">credVoter</a> <a id="11388" href="Ledger.GovernanceActions.html#1029" class="InductiveConstructor">DRep</a><a id="11392" class="Symbol">)</a> <a id="11394" href="Ledger.Ratify.html#10262" class="Function">activeDReps</a><a id="11405" class="Symbol">)</a> <a id="11407" href="Ledger.GovernanceActions.html#8328" class="InductiveConstructor">Vote.no</a>

    <a id="11420" href="Ledger.Ratify.html#11420" class="Function">actualSPOVotes</a>
      <a id="11441" class="Symbol">=</a>    <a id="11446" href="Ledger.Ratify.html#10124" class="Function">roleVotes</a> <a id="11456" href="Ledger.GovernanceActions.html#1034" class="InductiveConstructor">GovRole.SPO</a>
      <a id="11474" href="Axiom.Set.Map.html#4771" class="Function Operator">∪ᵐˡ</a>  <a id="11479" href="Axiom.Set.Map.html#7602" class="Function">constMap</a> <a id="11488" href="Ledger.Ratify.html#11554" class="Function">spos</a> <a id="11493" class="Symbol">(</a><a id="11494" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="11497" href="Ledger.Ratify.html#11655" class="Function">isHF</a> <a id="11502" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="11507" href="Ledger.GovernanceActions.html#8328" class="InductiveConstructor">Vote.no</a> <a id="11515" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="11520" href="Ledger.GovernanceActions.html#8331" class="InductiveConstructor">Vote.abstain</a><a id="11532" class="Symbol">)</a>
      <a id="11540" class="Keyword">where</a>
        <a id="11554" href="Ledger.Ratify.html#11554" class="Function">spos</a> <a id="11559" class="Symbol">:</a> <a id="11561" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="11563" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a>
        <a id="11578" href="Ledger.Ratify.html#11554" class="Function">spos</a> <a id="11583" class="Symbol">=</a> <a id="11585" href="Ledger.Prelude.html#1528" class="Function">filterˢ</a> <a id="11593" href="Ledger.Ratify.html#5644" class="Function">isSPOProp</a> <a id="11603" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="11605" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="11609" class="Symbol">(</a><a id="11610" href="Ledger.Ratify.html#4618" class="Field">StakeDistrs.stakeDistr</a> <a id="11633" href="Ledger.Ratify.html#4684" class="Function">stakeDistrs</a><a id="11644" class="Symbol">)</a>

        <a id="11655" href="Ledger.Ratify.html#11655" class="Function">isHF</a> <a id="11660" class="Symbol">:</a> <a id="11662" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
        <a id="11675" href="Ledger.Ratify.html#11655" class="Function">isHF</a> <a id="11680" class="Symbol">=</a> <a id="11682" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="11687" href="Ledger.Ratify.html#9944" class="Bound">ga</a> <a id="11690" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="11693" class="Symbol">λ</a> <a id="11695" class="Keyword">where</a>
          <a id="11711" class="Symbol">(</a><a id="11712" href="Ledger.GovernanceActions.html#1502" class="InductiveConstructor">TriggerHF</a> <a id="11722" class="Symbol">_)</a>  <a id="11726" class="Symbol">→</a> <a id="11728" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
          <a id="11743" class="CatchallClause Symbol">_</a>              <a id="11758" class="Symbol">→</a> <a id="11760" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
<a id="11766" class="Markup">\end{code}</a><a id="11776" class="Background">
} %% end small
\caption{%Ratify i:
Types and proofs for the ratification of governance actions}
\label{fig:defs:ratify-i}
\end{figure*}
The code in Figure~\ref{fig:defs:ratify-i} defines some of the types required for ratification of a governance action.
\begin{itemize}
  \item Assuming a ratification environment \AgdaPostulate{Γ},
  \begin{itemize}
    \item \agdaboundcc contains constitutional committee data;
    \item \agdaboundvotes is a relation associating each role-credential pair with the vote cast by the individual denoted by that pair;
    \item \agdaboundga denotes the governance action being voted upon.
  \end{itemize}

  \item \roleVotes filters the votes based on the given governance role.

  \item \actualCCVote determines how the vote of each \CC member will be counted; specifically, if a \CC member has not yet registered a hot key, has
  \expired, or has resigned, then \actualCCVote returns \abstain;
  if those none of these conditions is met, then
  \begin{itemize}
    \item if the \CC member has voted, then that vote is returned;
    \item if the \CC member has not voted, then the default value of \no is returned.
  \end{itemize}

  \item \actualCCVotes uses \actualCCVote to determine how the votes of all \CC members will be counted.

  \item \actualPDRepVotes determines how the votes will be counted for \DReps;
  here, \abstainRep is mapped to \abstain and \noConfidenceRep is mapped to either \yes or \no,
  depending on the value of \agdaboundga.

  \item \actualDRepVotes determines how the votes of \DReps will be counted; \activeDReps that didn&#39;t vote count as a \no.

  \item \actualVotes is a partial function relating delegates to the actual vote that will be counted on their behalf;
  it accomplishes this by aggregating the results of \actualCCVotes, \actualPDRepVotes, and \actualDRepVotes.
\end{itemize}
\begin{figure*}[h!]
{\small
</a><a id="13663" class="Markup">\begin{code}</a>
<a id="votedHashes"></a><a id="13676" href="Ledger.Ratify.html#13676" class="Function">votedHashes</a> <a id="13688" class="Symbol">:</a> <a id="13690" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a> <a id="13695" class="Symbol">→</a> <a id="13697" class="Symbol">(</a><a id="13698" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="13705" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="13707" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a><a id="13711" class="Symbol">)</a> <a id="13713" class="Symbol">→</a> <a id="13715" href="Ledger.GovernanceActions.html#1004" class="Datatype">GovRole</a> <a id="13723" class="Symbol">→</a> <a id="13725" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="13727" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a>
<a id="13734" href="Ledger.Ratify.html#13676" class="Function">votedHashes</a> <a id="13746" href="Ledger.Ratify.html#13746" class="Bound">v</a> <a id="13748" href="Ledger.Ratify.html#13748" class="Bound">votes</a> <a id="13754" href="Ledger.Ratify.html#13754" class="Bound">r</a> <a id="13756" class="Symbol">=</a> <a id="13758" href="Ledger.Ratify.html#13748" class="Bound">votes</a> <a id="13764" href="Axiom.Set.Map.html#10896" class="Function Operator">⁻¹</a> <a id="13767" href="Ledger.Ratify.html#13746" class="Bound">v</a>

<a id="votedYesHashes"></a><a id="13770" href="Ledger.Ratify.html#13770" class="Function">votedYesHashes</a> <a id="13785" class="Symbol">:</a> <a id="13787" class="Symbol">(</a><a id="13788" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="13795" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="13797" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a><a id="13801" class="Symbol">)</a> <a id="13803" class="Symbol">→</a> <a id="13805" href="Ledger.GovernanceActions.html#1004" class="Datatype">GovRole</a> <a id="13813" class="Symbol">→</a> <a id="13815" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="13817" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a>
<a id="13824" href="Ledger.Ratify.html#13770" class="Function">votedYesHashes</a> <a id="13839" class="Symbol">=</a> <a id="13841" href="Ledger.Ratify.html#13676" class="Function">votedHashes</a> <a id="13853" href="Ledger.GovernanceActions.html#8324" class="InductiveConstructor">Vote.yes</a>

<a id="votedAbstainHashes"></a><a id="13863" href="Ledger.Ratify.html#13863" class="Function">votedAbstainHashes</a> <a id="participatingHashes"></a><a id="13882" href="Ledger.Ratify.html#13882" class="Function">participatingHashes</a> <a id="13902" class="Symbol">:</a> <a id="13904" class="Symbol">(</a><a id="13905" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="13912" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="13914" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a><a id="13918" class="Symbol">)</a> <a id="13920" class="Symbol">→</a> <a id="13922" href="Ledger.GovernanceActions.html#1004" class="Datatype">GovRole</a> <a id="13930" class="Symbol">→</a> <a id="13932" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="13934" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a>
<a id="13941" href="Ledger.Ratify.html#13863" class="Function">votedAbstainHashes</a> <a id="13960" class="Symbol">=</a> <a id="13962" href="Ledger.Ratify.html#13676" class="Function">votedHashes</a> <a id="13974" href="Ledger.GovernanceActions.html#8331" class="InductiveConstructor">Vote.abstain</a>
<a id="13987" href="Ledger.Ratify.html#13882" class="Function">participatingHashes</a> <a id="14007" href="Ledger.Ratify.html#14007" class="Bound">votes</a> <a id="14013" href="Ledger.Ratify.html#14013" class="Bound">r</a> <a id="14015" class="Symbol">=</a> <a id="14017" href="Ledger.Ratify.html#13770" class="Function">votedYesHashes</a> <a id="14032" href="Ledger.Ratify.html#14007" class="Bound">votes</a> <a id="14038" href="Ledger.Ratify.html#14013" class="Bound">r</a> <a id="14040" href="Axiom.Set.html#8720" class="Function Operator">∪</a> <a id="14042" href="Ledger.Ratify.html#13676" class="Function">votedHashes</a> <a id="14054" href="Ledger.GovernanceActions.html#8328" class="InductiveConstructor">Vote.no</a> <a id="14062" href="Ledger.Ratify.html#14007" class="Bound">votes</a> <a id="14068" href="Ledger.Ratify.html#14013" class="Bound">r</a>
<a id="14070" class="Markup">\end{code}</a><a id="14080" class="Background">
} %% end small
\caption{Calculation of the votes as they will be counted}
\label{fig:defs:ratify-ii}
\end{figure*}

The code in Figure~\ref{fig:defs:ratify-ii} defines \votedHashes, which returns the set of delegates who voted a certain way on the given governance role.
\begin{figure*}[h!]
{\small
</a><a id="14380" class="Markup">\begin{code}</a>
<a id="getStakeDist"></a><a id="14393" href="Ledger.Ratify.html#14393" class="Function">getStakeDist</a> <a id="14406" class="Symbol">:</a> <a id="14408" href="Ledger.GovernanceActions.html#1004" class="Datatype">GovRole</a> <a id="14416" class="Symbol">→</a> <a id="14418" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="14420" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="14427" class="Symbol">→</a> <a id="14429" href="Ledger.Ratify.html#4586" class="Record">StakeDistrs</a> <a id="14441" class="Symbol">→</a> <a id="14443" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="14450" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="14452" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="14457" href="Ledger.Ratify.html#14393" class="Function">getStakeDist</a> <a id="14470" href="Ledger.GovernanceActions.html#1026" class="InductiveConstructor">CC</a>    <a id="14476" href="Ledger.Ratify.html#14476" class="Bound">cc</a>  <a id="14480" class="Symbol">_</a>                             <a id="14510" class="Symbol">=</a> <a id="14512" href="Axiom.Set.Map.html#7602" class="Function">constMap</a> <a id="14521" class="Symbol">(</a><a id="14522" href="Ledger.Prelude.html#1528" class="Function">filterˢ</a> <a id="14530" href="Ledger.Ratify.html#5468" class="Function">isCCProp</a> <a id="14539" href="Ledger.Ratify.html#14476" class="Bound">cc</a><a id="14541" class="Symbol">)</a> <a id="14543" class="Number">1</a>
<a id="14545" href="Ledger.Ratify.html#14393" class="Function">getStakeDist</a> <a id="14558" href="Ledger.GovernanceActions.html#1029" class="InductiveConstructor">DRep</a>  <a id="14564" class="Symbol">_</a>   <a id="14568" class="Keyword">record</a> <a id="14575" class="Symbol">{</a> <a id="14577" href="Ledger.Ratify.html#4618" class="Field">stakeDistr</a> <a id="14588" class="Symbol">=</a> <a id="14590" href="Ledger.Ratify.html#14590" class="Bound">dist</a> <a id="14595" class="Symbol">}</a>  <a id="14598" class="Symbol">=</a> <a id="14600" href="Axiom.Set.Map.html#4127" class="Function">filterᵐ</a> <a id="14608" class="Symbol">(</a><a id="14609" href="Axiom.Set.html#1220" class="Function">sp-∘</a> <a id="14614" href="Ledger.Ratify.html#5552" class="Function">isDRepProp</a>  <a id="14626" href="Data.Product.Base.html#608" class="Field">proj₁</a><a id="14631" class="Symbol">)</a> <a id="14633" href="Ledger.Ratify.html#14590" class="Bound">dist</a>
<a id="14638" href="Ledger.Ratify.html#14393" class="Function">getStakeDist</a> <a id="14651" href="Ledger.GovernanceActions.html#1034" class="InductiveConstructor">SPO</a>   <a id="14657" class="Symbol">_</a>   <a id="14661" class="Keyword">record</a> <a id="14668" class="Symbol">{</a> <a id="14670" href="Ledger.Ratify.html#4618" class="Field">stakeDistr</a> <a id="14681" class="Symbol">=</a> <a id="14683" href="Ledger.Ratify.html#14683" class="Bound">dist</a> <a id="14688" class="Symbol">}</a>  <a id="14691" class="Symbol">=</a> <a id="14693" href="Axiom.Set.Map.html#4127" class="Function">filterᵐ</a> <a id="14701" class="Symbol">(</a><a id="14702" href="Axiom.Set.html#1220" class="Function">sp-∘</a> <a id="14707" href="Ledger.Ratify.html#5644" class="Function">isSPOProp</a>   <a id="14719" href="Data.Product.Base.html#608" class="Field">proj₁</a><a id="14724" class="Symbol">)</a> <a id="14726" href="Ledger.Ratify.html#14683" class="Bound">dist</a>

<a id="acceptedStake"></a><a id="14732" href="Ledger.Ratify.html#14732" class="Function">acceptedStake</a> <a id="14746" class="Symbol">:</a> <a id="14748" href="Ledger.GovernanceActions.html#1004" class="Datatype">GovRole</a> <a id="14756" class="Symbol">→</a> <a id="14758" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="14760" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="14767" class="Symbol">→</a> <a id="14769" href="Ledger.Ratify.html#4586" class="Record">StakeDistrs</a> <a id="14781" class="Symbol">→</a> <a id="14783" class="Symbol">(</a><a id="14784" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="14791" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="14793" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a><a id="14797" class="Symbol">)</a> <a id="14799" class="Symbol">→</a> <a id="14801" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="14806" href="Ledger.Ratify.html#14732" class="Function">acceptedStake</a> <a id="14820" href="Ledger.Ratify.html#14820" class="Bound">r</a> <a id="14822" href="Ledger.Ratify.html#14822" class="Bound">cc</a> <a id="14825" href="Ledger.Ratify.html#14825" class="Bound">dists</a> <a id="14831" href="Ledger.Ratify.html#14831" class="Bound">votes</a> <a id="14837" class="Symbol">=</a>
  <a id="14841" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="14846" href="Ledger.Ratify.html#14846" class="Bound">x</a> <a id="14848" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="14850" class="Symbol">(</a><a id="14851" href="Ledger.Ratify.html#14393" class="Function">getStakeDist</a> <a id="14864" href="Ledger.Ratify.html#14820" class="Bound">r</a> <a id="14866" href="Ledger.Ratify.html#14822" class="Bound">cc</a> <a id="14869" href="Ledger.Ratify.html#14825" class="Bound">dists</a> <a id="14875" href="Axiom.Set.Map.html#8760" class="Function Operator">∣</a> <a id="14877" href="Ledger.Ratify.html#13770" class="Function">votedYesHashes</a> <a id="14892" href="Ledger.Ratify.html#14831" class="Bound">votes</a> <a id="14898" href="Ledger.Ratify.html#14820" class="Bound">r</a><a id="14899" class="Symbol">)</a> <a id="14901" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="14904" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="14906" href="Ledger.Ratify.html#14846" class="Bound">x</a>

<a id="totalStake"></a><a id="14909" href="Ledger.Ratify.html#14909" class="Function">totalStake</a> <a id="14920" class="Symbol">:</a> <a id="14922" href="Ledger.GovernanceActions.html#1004" class="Datatype">GovRole</a> <a id="14930" class="Symbol">→</a> <a id="14932" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="14934" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="14941" class="Symbol">→</a> <a id="14943" href="Ledger.Ratify.html#4586" class="Record">StakeDistrs</a> <a id="14955" class="Symbol">→</a> <a id="14957" class="Symbol">(</a><a id="14958" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="14965" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="14967" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a><a id="14971" class="Symbol">)</a> <a id="14973" class="Symbol">→</a> <a id="14975" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="14980" href="Ledger.Ratify.html#14909" class="Function">totalStake</a> <a id="14991" href="Ledger.Ratify.html#14991" class="Bound">r</a> <a id="14993" href="Ledger.Ratify.html#14993" class="Bound">cc</a> <a id="14996" href="Ledger.Ratify.html#14996" class="Bound">dists</a> <a id="15002" href="Ledger.Ratify.html#15002" class="Bound">votes</a> <a id="15008" class="Symbol">=</a>
  <a id="15012" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="15017" href="Ledger.Ratify.html#15017" class="Bound">x</a>  <a id="15020" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="15022" href="Ledger.Ratify.html#14393" class="Function">getStakeDist</a> <a id="15035" href="Ledger.Ratify.html#14991" class="Bound">r</a> <a id="15037" href="Ledger.Ratify.html#14993" class="Bound">cc</a> <a id="15040" href="Ledger.Ratify.html#14996" class="Bound">dists</a> <a id="15046" href="Axiom.Set.Map.html#8830" class="Function Operator">∣</a> <a id="15048" href="Ledger.Ratify.html#13863" class="Function">votedAbstainHashes</a> <a id="15067" href="Ledger.Ratify.html#15002" class="Bound">votes</a> <a id="15073" href="Ledger.Ratify.html#14991" class="Bound">r</a> <a id="15075" href="Axiom.Set.Map.html#8830" class="Function Operator">ᶜ</a> <a id="15077" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="15080" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="15082" href="Ledger.Ratify.html#15017" class="Bound">x</a>

<a id="activeVotingStake"></a><a id="15085" href="Ledger.Ratify.html#15085" class="Function">activeVotingStake</a> <a id="15103" class="Symbol">:</a> <a id="15105" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="15107" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="15114" class="Symbol">→</a> <a id="15116" href="Ledger.Ratify.html#4586" class="Record">StakeDistrs</a> <a id="15128" class="Symbol">→</a> <a id="15130" class="Symbol">(</a><a id="15131" href="Ledger.GovernanceActions.html#1054" class="Datatype">VDeleg</a> <a id="15138" href="Ledger.Prelude.html#2629" class="Function Operator">⇀</a> <a id="15140" href="Ledger.GovernanceActions.html#8305" class="Datatype">Vote</a><a id="15144" class="Symbol">)</a> <a id="15146" class="Symbol">→</a> <a id="15148" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="15153" href="Ledger.Ratify.html#15085" class="Function">activeVotingStake</a> <a id="15171" href="Ledger.Ratify.html#15171" class="Bound">cc</a> <a id="15174" href="Ledger.Ratify.html#15174" class="Bound">dists</a> <a id="15180" href="Ledger.Ratify.html#15180" class="Bound">votes</a> <a id="15186" class="Symbol">=</a>
  <a id="15190" href="Axiom.Set.Sum.html#4411" class="Function">Σᵐᵛ[</a> <a id="15195" href="Ledger.Ratify.html#15195" class="Bound">x</a>  <a id="15198" href="Axiom.Set.Sum.html#4411" class="Function">←</a> <a id="15200" href="Ledger.Ratify.html#14393" class="Function">getStakeDist</a> <a id="15213" href="Ledger.GovernanceActions.html#1029" class="InductiveConstructor">DRep</a> <a id="15218" href="Ledger.Ratify.html#15171" class="Bound">cc</a> <a id="15221" href="Ledger.Ratify.html#15174" class="Bound">dists</a> <a id="15227" href="Axiom.Set.Map.html#8830" class="Function Operator">∣</a> <a id="15229" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="15233" href="Ledger.Ratify.html#15180" class="Bound">votes</a> <a id="15239" href="Axiom.Set.Map.html#8830" class="Function Operator">ᶜ</a> <a id="15241" href="Ledger.Prelude.html#3690" class="Function Operator">ᶠᵐ</a> <a id="15244" href="Axiom.Set.Sum.html#4411" class="Function">]</a> <a id="15246" href="Ledger.Ratify.html#15195" class="Bound">x</a>

<a id="accepted&#39;"></a><a id="15249" href="Ledger.Ratify.html#15249" class="Function">accepted&#39;</a> <a id="15259" class="Symbol">:</a> <a id="15261" href="Ledger.Ratify.html#4654" class="Record">RatifyEnv</a> <a id="15271" class="Symbol">→</a> <a id="15273" href="Ledger.GovernanceActions.html#11944" class="Record">EnactState</a> <a id="15284" class="Symbol">→</a> <a id="15286" href="Ledger.Gov.html#690" class="Record">GovActionState</a> <a id="15301" class="Symbol">→</a> <a id="15303" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="15307" href="Ledger.Ratify.html#15249" class="Function">accepted&#39;</a> <a id="15317" href="Ledger.Ratify.html#15317" class="Bound">Γ</a> <a id="15319" class="Symbol">(</a><a id="15320" class="Keyword">record</a> <a id="15327" class="Symbol">{</a> <a id="15329" href="Ledger.GovernanceActions.html#11975" class="Field">cc</a> <a id="15332" class="Symbol">=</a> <a id="15334" href="Ledger.Ratify.html#15334" class="Bound">cc</a> <a id="15337" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="15339" class="Symbol">_</a> <a id="15341" class="Symbol">;</a> <a id="15343" href="Ledger.GovernanceActions.html#12159" class="Field">pparams</a> <a id="15351" class="Symbol">=</a> <a id="15353" href="Ledger.Ratify.html#15353" class="Bound">pparams</a> <a id="15361" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="15363" class="Symbol">_</a> <a id="15365" class="Symbol">})</a> <a id="15368" href="Ledger.Ratify.html#15368" class="Bound">gs</a> <a id="15371" class="Symbol">=</a>
  <a id="15375" href="Ledger.Ratify.html#15764" class="Function">acceptedBy</a> <a id="15386" href="Ledger.GovernanceActions.html#1026" class="InductiveConstructor">CC</a> <a id="15389" href="Ledger.Ratify.html#4462" class="Function Operator">∧</a> <a id="15391" href="Ledger.Ratify.html#15764" class="Function">acceptedBy</a> <a id="15402" href="Ledger.GovernanceActions.html#1029" class="InductiveConstructor">DRep</a> <a id="15407" href="Ledger.Ratify.html#4462" class="Function Operator">∧</a> <a id="15409" href="Ledger.Ratify.html#15764" class="Function">acceptedBy</a> <a id="15420" href="Ledger.GovernanceActions.html#1034" class="InductiveConstructor">SPO</a> <a id="15424" href="Ledger.Ratify.html#4462" class="Function Operator">∧</a> <a id="15426" href="Ledger.Ratify.html#15667" class="Function">meetsMinAVS</a>
  <a id="15440" class="Keyword">where</a>
    <a id="15450" class="Keyword">open</a> <a id="15455" href="Ledger.Ratify.html#4654" class="Module">RatifyEnv</a> <a id="15465" href="Ledger.Ratify.html#15317" class="Bound">Γ</a><a id="15466" class="Symbol">;</a> <a id="15468" class="Keyword">open</a> <a id="15473" href="Ledger.Gov.html#690" class="Module">GovActionState</a> <a id="15488" href="Ledger.Ratify.html#15368" class="Bound">gs</a><a id="15490" class="Symbol">;</a> <a id="15492" class="Keyword">open</a> <a id="15497" href="Ledger.PParams.html#1022" class="Module">PParams</a> <a id="15505" href="Ledger.Ratify.html#15353" class="Bound">pparams</a>

    <a id="15518" href="Ledger.Ratify.html#15518" class="Function">votes&#39;</a> <a id="15525" class="Symbol">=</a> <a id="15527" href="Ledger.Ratify.html#9806" class="Function">actualVotes</a> <a id="15539" href="Ledger.Ratify.html#15317" class="Bound">Γ</a> <a id="15541" href="Ledger.Ratify.html#15334" class="Bound">cc</a> <a id="15544" href="Ledger.Gov.html#725" class="Field">votes</a> <a id="15550" href="Ledger.Gov.html#835" class="Field">action</a> <a id="15557" href="Ledger.Ratify.html#15353" class="Bound">pparams</a>
    <a id="15569" href="Ledger.Ratify.html#15569" class="Function">cc&#39;</a> <a id="15573" class="Symbol">=</a> <a id="15575" href="Interface.IsSet.html#794" class="Function">dom</a> <a id="15579" href="Ledger.Ratify.html#15518" class="Function">votes&#39;</a>
    <a id="15590" href="Ledger.Ratify.html#15590" class="Function">redStakeDistr</a> <a id="15604" class="Symbol">=</a> <a id="15606" href="Ledger.Ratify.html#9389" class="Function">restrictedDists</a> <a id="15622" href="Ledger.Ratify.html#6868" class="Function">coinThreshold</a> <a id="15636" href="Ledger.Ratify.html#6882" class="Function">rankThreshold</a> <a id="15650" href="Ledger.Ratify.html#4684" class="Function">stakeDistrs</a>

    <a id="15667" href="Ledger.Ratify.html#15667" class="Function">meetsMinAVS</a> <a id="15679" class="Symbol">:</a> <a id="15681" href="Agda.Primitive.html#320" class="Primitive">Set</a>
    <a id="15689" href="Ledger.Ratify.html#15667" class="Function">meetsMinAVS</a> <a id="15701" class="Symbol">=</a> <a id="15703" href="Ledger.Ratify.html#15085" class="Function">activeVotingStake</a> <a id="15721" href="Ledger.Ratify.html#15569" class="Function">cc&#39;</a> <a id="15725" href="Ledger.Ratify.html#15590" class="Function">redStakeDistr</a> <a id="15739" href="Ledger.Ratify.html#15518" class="Function">votes&#39;</a> <a id="15746" href="Data.Nat.Base.html#1894" class="Function Operator">≥</a> <a id="15748" href="Ledger.PParams.html#2208" class="Function">minimumAVS</a>

    <a id="15764" href="Ledger.Ratify.html#15764" class="Function">acceptedBy</a> <a id="15775" class="Symbol">:</a> <a id="15777" href="Ledger.GovernanceActions.html#1004" class="Datatype">GovRole</a> <a id="15785" class="Symbol">→</a> <a id="15787" href="Agda.Primitive.html#320" class="Primitive">Set</a>
    <a id="15795" href="Ledger.Ratify.html#15764" class="Function">acceptedBy</a> <a id="15806" href="Ledger.Ratify.html#15806" class="Bound">role</a> <a id="15811" class="Symbol">=</a>
      <a id="15819" class="Keyword">let</a> <a id="15823" href="Ledger.Ratify.html#15823" class="Bound">t</a> <a id="15825" class="Symbol">=</a> <a id="15827" href="Data.Maybe.Base.html#1377" class="Function">maybe</a> <a id="15833" href="Function.Base.html#695" class="Function">id</a> <a id="15836" href="Data.Rational.Base.html#4213" class="Function">R.0ℚ</a> <a id="15841" href="Function.Base.html#1994" class="Function Operator">$</a> <a id="15843" href="Ledger.GovernanceActions.html#4656" class="Function">threshold</a> <a id="15853" href="Ledger.Ratify.html#15353" class="Bound">pparams</a> <a id="15861" class="Symbol">(</a><a id="15862" href="Data.Product.Base.html#622" class="Field">proj₂</a> <a id="15868" href="Interface.Functor.html#418" class="Field Operator">&lt;$&gt;</a> <a id="15872" href="Ledger.Ratify.html#15334" class="Bound">cc</a><a id="15874" class="Symbol">)</a> <a id="15876" href="Ledger.Gov.html#835" class="Field">action</a> <a id="15883" href="Ledger.Ratify.html#15806" class="Bound">role</a> <a id="15888" class="Keyword">in</a>
      <a id="15897" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="15902" href="Ledger.Ratify.html#14909" class="Function">totalStake</a> <a id="15913" href="Ledger.Ratify.html#15806" class="Bound">role</a> <a id="15918" href="Ledger.Ratify.html#15569" class="Function">cc&#39;</a> <a id="15922" href="Ledger.Ratify.html#15590" class="Function">redStakeDistr</a> <a id="15936" href="Ledger.Ratify.html#15518" class="Function">votes&#39;</a> <a id="15943" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="15946" class="Symbol">λ</a> <a id="15948" class="Keyword">where</a>
        <a id="15962" class="Number">0</a> <a id="15964" class="Symbol">→</a> <a id="15966" href="Ledger.Ratify.html#15823" class="Bound">t</a> <a id="15968" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="15970" href="Data.Rational.Base.html#4213" class="Function">R.0ℚ</a> <a id="15975" class="Comment">-- if there&#39;s no stake, accept only if threshold is zero</a>
        <a id="16040" href="Ledger.Ratify.html#16040" class="Bound">x</a><a id="16041" class="Symbol">@(</a><a id="16043" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="16047" class="Symbol">_)</a> <a id="16050" class="Symbol">→</a> <a id="16052" href="Agda.Builtin.Int.html#246" class="InductiveConstructor Operator">Z.+</a> <a id="16056" href="Ledger.Ratify.html#14732" class="Function">acceptedStake</a> <a id="16070" href="Ledger.Ratify.html#15806" class="Bound">role</a> <a id="16075" href="Ledger.Ratify.html#15569" class="Function">cc&#39;</a> <a id="16079" href="Ledger.Ratify.html#15590" class="Function">redStakeDistr</a> <a id="16093" href="Ledger.Ratify.html#15518" class="Function">votes&#39;</a> <a id="16100" href="Data.Rational.Base.html#3766" class="Function Operator">R./</a> <a id="16104" href="Ledger.Ratify.html#16040" class="Bound">x</a> <a id="16106" href="Data.Rational.Base.html#2512" class="Function Operator">R.≥</a> <a id="16110" href="Ledger.Ratify.html#15823" class="Bound">t</a>

<a id="expired"></a><a id="16113" href="Ledger.Ratify.html#16113" class="Function">expired</a> <a id="16121" class="Symbol">:</a> <a id="16123" href="Ledger.Epoch.html#502" class="Function">Epoch</a> <a id="16129" class="Symbol">→</a> <a id="16131" href="Ledger.Gov.html#690" class="Record">GovActionState</a> <a id="16146" class="Symbol">→</a> <a id="16148" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="16152" href="Ledger.Ratify.html#16113" class="Function">expired</a> <a id="16160" href="Ledger.Ratify.html#16160" class="Bound">current</a> <a id="16168" class="Keyword">record</a> <a id="16175" class="Symbol">{</a> <a id="16177" href="Ledger.Gov.html#807" class="Field">expiresIn</a> <a id="16187" class="Symbol">=</a> <a id="16189" href="Ledger.Ratify.html#16189" class="Bound">expiresIn</a> <a id="16199" class="Symbol">}</a> <a id="16201" class="Symbol">=</a> <a id="16203" href="Ledger.Ratify.html#16189" class="Bound">expiresIn</a> <a id="16213" href="Ledger.Ratify.html#16326" class="Function Operator">&lt;</a> <a id="16215" href="Ledger.Ratify.html#16160" class="Bound">current</a>
<a id="16223" class="Markup">\end{code}</a><a id="16233" class="Background">
</a><a id="16234" class="Markup">\begin{code}[hide]</a>
  <a id="16255" class="Keyword">where</a> <a id="16261" class="Comment">-- FIXME: this should be part of a typeclass</a>
    <a id="16310" class="Keyword">infix</a> <a id="16316" class="Number">4</a> <a id="16318" href="Ledger.Ratify.html#16326" class="Function Operator">_&lt;_</a>
    <a id="16326" href="Ledger.Ratify.html#16326" class="Function Operator">_&lt;_</a> <a id="16330" class="Symbol">:</a> <a id="16332" href="Ledger.Epoch.html#502" class="Function">Epoch</a> <a id="16338" class="Symbol">→</a> <a id="16340" href="Ledger.Epoch.html#502" class="Function">Epoch</a> <a id="16346" class="Symbol">→</a> <a id="16348" href="Agda.Primitive.html#320" class="Primitive">Set</a>
    <a id="16356" href="Ledger.Ratify.html#16356" class="Bound">a</a> <a id="16358" href="Ledger.Ratify.html#16326" class="Function Operator">&lt;</a> <a id="16360" href="Ledger.Ratify.html#16360" class="Bound">b</a> <a id="16362" class="Symbol">=</a> <a id="16364" href="Ledger.Ratify.html#16356" class="Bound">a</a> <a id="16366" href="Interface.HasOrder.html#416" class="Field Operator">≤</a> <a id="16368" href="Ledger.Ratify.html#16360" class="Bound">b</a> <a id="16370" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="16372" href="Ledger.Ratify.html#16356" class="Bound">a</a> <a id="16374" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="16376" href="Ledger.Ratify.html#16360" class="Bound">b</a>
<a id="16378" class="Markup">\end{code}</a><a id="16388" class="Background">
} %% end small
\caption{%%Ratify iii:
Calculation of stake distributions}
\label{fig:defs:ratify-iii}
\end{figure*}
The code in Figure~\ref{fig:defs:ratify-iii} defines yet more types required for ratification of a governance action.
\begin{itemize}
  \item \getStakeDist computes the stake distribution based on the given governance role and the corresponding delegations;
  \item \acceptedStake calculates the sum of stakes for all delegations that voted \yes for the specified role;
  \item \totalStake calculates the sum of stakes for all delegations that didn&#39;t vote \abstain for the given role;
  \item \activeVotingStake computes the total stake for the role of \DRep for active voting; it calculates the sum of
  stakes for all active delegates that have not voted (i.e., their delegation is present in \CC but not in the \agdaboundvotes mapping);
  \item \accepted checks if an action is accepted for the \CC, \DRep, and \SPO roles and whether it meets the minimum active voting stake (\meetsMinAVS);
  \item \expired checks whether a governance action is expired in a given epoch.
\end{itemize}
\begin{figure*}[h!]
{\small
</a><a id="17522" class="Markup">\begin{code}[hide]</a>
<a id="17541" class="Keyword">open</a> <a id="17546" href="Ledger.GovernanceActions.html#11944" class="Module">EnactState</a>
<a id="17557" class="Markup">\end{code}</a><a id="17567" class="Background">
</a><a id="17568" class="Markup">\begin{code}</a>
<a id="verifyPrev"></a><a id="17581" href="Ledger.Ratify.html#17581" class="Function">verifyPrev</a> <a id="17592" class="Symbol">:</a> <a id="17594" class="Symbol">(</a><a id="17595" href="Ledger.Ratify.html#17595" class="Bound">a</a> <a id="17597" class="Symbol">:</a> <a id="17599" href="Ledger.GovernanceActions.html#1262" class="Datatype">GovAction</a><a id="17608" class="Symbol">)</a> <a id="17610" class="Symbol">→</a> <a id="17612" href="Ledger.GovernanceActions.html#6975" class="Function">NeedsHash</a> <a id="17622" href="Ledger.Ratify.html#17595" class="Bound">a</a> <a id="17624" class="Symbol">→</a> <a id="17626" href="Ledger.GovernanceActions.html#11944" class="Record">EnactState</a> <a id="17637" class="Symbol">→</a> <a id="17639" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="17643" href="Ledger.Ratify.html#17581" class="Function">verifyPrev</a> <a id="17654" href="Ledger.GovernanceActions.html#1286" class="InductiveConstructor">NoConfidence</a>           <a id="17677" href="Ledger.Ratify.html#17677" class="Bound">h</a> <a id="17679" href="Ledger.Ratify.html#17679" class="Bound">es</a>  <a id="17683" class="Symbol">=</a> <a id="17685" href="Ledger.Ratify.html#17677" class="Bound">h</a> <a id="17687" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="17689" href="Ledger.Ratify.html#17679" class="Bound">es</a> <a id="17692" class="Symbol">.</a><a id="17693" href="Ledger.GovernanceActions.html#11975" class="Field">cc</a> <a id="17696" class="Symbol">.</a><a id="17697" href="Data.Product.Base.html#622" class="Field">proj₂</a>
<a id="17703" href="Ledger.Ratify.html#17581" class="Function">verifyPrev</a> <a id="17714" class="Symbol">(</a><a id="17715" href="Ledger.GovernanceActions.html#1358" class="InductiveConstructor">NewCommittee</a> <a id="17728" class="Symbol">_</a> <a id="17730" class="Symbol">_</a> <a id="17732" class="Symbol">_)</a>   <a id="17737" href="Ledger.Ratify.html#17737" class="Bound">h</a> <a id="17739" href="Ledger.Ratify.html#17739" class="Bound">es</a>  <a id="17743" class="Symbol">=</a> <a id="17745" href="Ledger.Ratify.html#17737" class="Bound">h</a> <a id="17747" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="17749" href="Ledger.Ratify.html#17739" class="Bound">es</a> <a id="17752" class="Symbol">.</a><a id="17753" href="Ledger.GovernanceActions.html#11975" class="Field">cc</a> <a id="17756" class="Symbol">.</a><a id="17757" href="Data.Product.Base.html#622" class="Field">proj₂</a>
<a id="17763" href="Ledger.Ratify.html#17581" class="Function">verifyPrev</a> <a id="17774" class="Symbol">(</a><a id="17775" href="Ledger.GovernanceActions.html#1430" class="InductiveConstructor">NewConstitution</a> <a id="17791" class="Symbol">_</a> <a id="17793" class="Symbol">_)</a>  <a id="17797" href="Ledger.Ratify.html#17797" class="Bound">h</a> <a id="17799" href="Ledger.Ratify.html#17799" class="Bound">es</a>  <a id="17803" class="Symbol">=</a> <a id="17805" href="Ledger.Ratify.html#17797" class="Bound">h</a> <a id="17807" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="17809" href="Ledger.Ratify.html#17799" class="Bound">es</a> <a id="17812" class="Symbol">.</a><a id="17813" href="Ledger.GovernanceActions.html#12046" class="Field">constitution</a> <a id="17826" class="Symbol">.</a><a id="17827" href="Data.Product.Base.html#622" class="Field">proj₂</a>
<a id="17833" href="Ledger.Ratify.html#17581" class="Function">verifyPrev</a> <a id="17844" class="Symbol">(</a><a id="17845" href="Ledger.GovernanceActions.html#1502" class="InductiveConstructor">TriggerHF</a> <a id="17855" class="Symbol">_)</a>          <a id="17867" href="Ledger.Ratify.html#17867" class="Bound">h</a> <a id="17869" href="Ledger.Ratify.html#17869" class="Bound">es</a>  <a id="17873" class="Symbol">=</a> <a id="17875" href="Ledger.Ratify.html#17867" class="Bound">h</a> <a id="17877" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="17879" href="Ledger.Ratify.html#17869" class="Bound">es</a> <a id="17882" class="Symbol">.</a><a id="17883" href="Ledger.GovernanceActions.html#12113" class="Field">pv</a> <a id="17886" class="Symbol">.</a><a id="17887" href="Data.Product.Base.html#622" class="Field">proj₂</a>
<a id="17893" href="Ledger.Ratify.html#17581" class="Function">verifyPrev</a> <a id="17904" class="Symbol">(</a><a id="17905" href="Ledger.GovernanceActions.html#1574" class="InductiveConstructor">ChangePParams</a> <a id="17919" class="Symbol">_)</a>      <a id="17927" href="Ledger.Ratify.html#17927" class="Bound">h</a> <a id="17929" href="Ledger.Ratify.html#17929" class="Bound">es</a>  <a id="17933" class="Symbol">=</a> <a id="17935" href="Ledger.Ratify.html#17927" class="Bound">h</a> <a id="17937" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="17939" href="Ledger.Ratify.html#17929" class="Bound">es</a> <a id="17942" class="Symbol">.</a><a id="17943" href="Ledger.GovernanceActions.html#12159" class="Field">pparams</a> <a id="17951" class="Symbol">.</a><a id="17952" href="Data.Product.Base.html#622" class="Field">proj₂</a>
<a id="17958" href="Ledger.Ratify.html#17581" class="Function">verifyPrev</a> <a id="17969" class="Symbol">(</a><a id="17970" href="Ledger.GovernanceActions.html#1646" class="InductiveConstructor">TreasuryWdrl</a> <a id="17983" class="Symbol">_)</a>       <a id="17992" class="Symbol">_</a> <a id="17994" class="Symbol">_</a>   <a id="17998" class="Symbol">=</a> <a id="18000" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
<a id="18002" href="Ledger.Ratify.html#17581" class="Function">verifyPrev</a> <a id="18013" href="Ledger.GovernanceActions.html#1718" class="InductiveConstructor">Info</a>                   <a id="18036" class="Symbol">_</a> <a id="18038" class="Symbol">_</a>   <a id="18042" class="Symbol">=</a> <a id="18044" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>

<a id="delayingAction"></a><a id="18047" href="Ledger.Ratify.html#18047" class="Function">delayingAction</a> <a id="18062" class="Symbol">:</a> <a id="18064" href="Ledger.GovernanceActions.html#1262" class="Datatype">GovAction</a> <a id="18074" class="Symbol">→</a> <a id="18076" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="18081" href="Ledger.Ratify.html#18047" class="Function">delayingAction</a> <a id="18096" href="Ledger.GovernanceActions.html#1286" class="InductiveConstructor">NoConfidence</a>           <a id="18119" class="Symbol">=</a> <a id="18121" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="18126" href="Ledger.Ratify.html#18047" class="Function">delayingAction</a> <a id="18141" class="Symbol">(</a><a id="18142" href="Ledger.GovernanceActions.html#1358" class="InductiveConstructor">NewCommittee</a> <a id="18155" class="Symbol">_</a> <a id="18157" class="Symbol">_</a> <a id="18159" class="Symbol">_)</a>   <a id="18164" class="Symbol">=</a> <a id="18166" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="18171" href="Ledger.Ratify.html#18047" class="Function">delayingAction</a> <a id="18186" class="Symbol">(</a><a id="18187" href="Ledger.GovernanceActions.html#1430" class="InductiveConstructor">NewConstitution</a> <a id="18203" class="Symbol">_</a> <a id="18205" class="Symbol">_)</a>  <a id="18209" class="Symbol">=</a> <a id="18211" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="18216" href="Ledger.Ratify.html#18047" class="Function">delayingAction</a> <a id="18231" class="Symbol">(</a><a id="18232" href="Ledger.GovernanceActions.html#1502" class="InductiveConstructor">TriggerHF</a> <a id="18242" class="Symbol">_)</a>          <a id="18254" class="Symbol">=</a> <a id="18256" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="18261" href="Ledger.Ratify.html#18047" class="Function">delayingAction</a> <a id="18276" class="Symbol">(</a><a id="18277" href="Ledger.GovernanceActions.html#1574" class="InductiveConstructor">ChangePParams</a> <a id="18291" class="Symbol">_)</a>      <a id="18299" class="Symbol">=</a> <a id="18301" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
<a id="18307" href="Ledger.Ratify.html#18047" class="Function">delayingAction</a> <a id="18322" class="Symbol">(</a><a id="18323" href="Ledger.GovernanceActions.html#1646" class="InductiveConstructor">TreasuryWdrl</a> <a id="18336" class="Symbol">_)</a>       <a id="18345" class="Symbol">=</a> <a id="18347" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
<a id="18353" href="Ledger.Ratify.html#18047" class="Function">delayingAction</a> <a id="18368" href="Ledger.GovernanceActions.html#1718" class="InductiveConstructor">Info</a>                   <a id="18391" class="Symbol">=</a> <a id="18393" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>

<a id="delayed"></a><a id="18400" href="Ledger.Ratify.html#18400" class="Function">delayed</a> <a id="18408" class="Symbol">:</a> <a id="18410" class="Symbol">(</a><a id="18411" href="Ledger.Ratify.html#18411" class="Bound">a</a> <a id="18413" class="Symbol">:</a> <a id="18415" href="Ledger.GovernanceActions.html#1262" class="Datatype">GovAction</a><a id="18424" class="Symbol">)</a> <a id="18426" class="Symbol">→</a> <a id="18428" href="Ledger.GovernanceActions.html#6975" class="Function">NeedsHash</a> <a id="18438" href="Ledger.Ratify.html#18411" class="Bound">a</a> <a id="18440" class="Symbol">→</a> <a id="18442" href="Ledger.GovernanceActions.html#11944" class="Record">EnactState</a> <a id="18453" class="Symbol">→</a> <a id="18455" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a> <a id="18460" class="Symbol">→</a> <a id="18462" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="18466" href="Ledger.Ratify.html#18400" class="Function">delayed</a> <a id="18474" href="Ledger.Ratify.html#18474" class="Bound">a</a> <a id="18476" href="Ledger.Ratify.html#18476" class="Bound">h</a> <a id="18478" href="Ledger.Ratify.html#18478" class="Bound">es</a> <a id="18481" href="Ledger.Ratify.html#18481" class="Bound">d</a> <a id="18483" class="Symbol">=</a> <a id="18485" href="Relation.Nullary.Negation.Core.html#815" class="Function Operator">¬</a> <a id="18487" href="Ledger.Ratify.html#17581" class="Function">verifyPrev</a> <a id="18498" href="Ledger.Ratify.html#18474" class="Bound">a</a> <a id="18500" href="Ledger.Ratify.html#18476" class="Bound">h</a> <a id="18502" href="Ledger.Ratify.html#18478" class="Bound">es</a> <a id="18505" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a> <a id="18507" href="Ledger.Ratify.html#18481" class="Bound">d</a> <a id="18509" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="18511" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="18516" class="Markup">\end{code}</a><a id="18526" class="Background">
} %% end small
\caption{%Ratify iv:
Determination of the status of ratification of the governance action}
\label{fig:defs:ratify-iv}
\end{figure*}
The code in Figure~\ref{fig:defs:ratify-iv} defines still more types required for ratification of a governance action.
\begin{itemize}
  \item \verifyPrev takes a governance action, its \NeedsHash, and \EnactState and checks whether the ratification restrictions are met;
  \item \delayingAction takes a governance action and returns \true if it is a ``delaying action&#39;&#39; (\NoConfidence, \NewCommittee, \NewConstitution, \TriggerHF)
  and returns \false otherwise;
  \item \delayed checks whether a given \GovAction is delayed.
\end{itemize}
</a><a id="19215" class="Markup">\begin{code}[hide]</a>
<a id="19234" class="Keyword">private</a> <a id="19242" class="Keyword">variable</a>
  <a id="19253" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a> <a id="19255" class="Symbol">:</a> <a id="19257" href="Ledger.Ratify.html#4654" class="Record">RatifyEnv</a>
  <a id="19269" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="19272" href="Ledger.Ratify.html#19272" class="Generalizable">es&#39;</a> <a id="19276" class="Symbol">:</a> <a id="19278" href="Ledger.GovernanceActions.html#11944" class="Record">EnactState</a>
  <a id="19291" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="19293" class="Symbol">:</a> <a id="19295" href="Ledger.GovernanceActions.html#957" class="Function">GovActionID</a> <a id="19307" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="19309" href="Ledger.Gov.html#690" class="Record">GovActionState</a>
  <a id="19326" href="Ledger.Ratify.html#19326" class="Generalizable">removed</a> <a id="19334" class="Symbol">:</a> <a id="19336" href="Ledger.Prelude.html#1514" class="Function Operator">ℙ</a> <a id="19338" class="Symbol">(</a><a id="19339" href="Ledger.GovernanceActions.html#957" class="Function">GovActionID</a> <a id="19351" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="19353" href="Ledger.Gov.html#690" class="Record">GovActionState</a><a id="19367" class="Symbol">)</a>
  <a id="19371" href="Ledger.Ratify.html#19371" class="Generalizable">d</a> <a id="19373" class="Symbol">:</a> <a id="19375" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>

<a id="19381" class="Comment">-- having `accepted` abstract speeds up type checking of RATIFY&#39; a lot</a>
<a id="19452" class="Keyword">abstract</a>
  <a id="accepted"></a><a id="19463" href="Ledger.Ratify.html#19463" class="Function">accepted</a> <a id="19472" class="Symbol">:</a> <a id="19474" href="Ledger.Ratify.html#4654" class="Record">RatifyEnv</a> <a id="19484" class="Symbol">→</a> <a id="19486" href="Ledger.GovernanceActions.html#11944" class="Record">EnactState</a> <a id="19497" class="Symbol">→</a> <a id="19499" href="Ledger.Gov.html#690" class="Record">GovActionState</a> <a id="19514" class="Symbol">→</a> <a id="19516" href="Agda.Primitive.html#320" class="Primitive">Set</a>
  <a id="19522" href="Ledger.Ratify.html#19463" class="Function">accepted</a> <a id="19531" class="Symbol">=</a> <a id="19533" href="Ledger.Ratify.html#15249" class="Function">accepted&#39;</a>

<a id="19544" class="Keyword">data</a> <a id="_⊢_⇀⦇_,RATIFY&#39;⦈_"></a><a id="19549" href="Ledger.Ratify.html#19549" class="Datatype Operator">_⊢_⇀⦇_,RATIFY&#39;⦈_</a> <a id="19566" class="Symbol">:</a> <a id="19568" href="Ledger.Ratify.html#4654" class="Record">RatifyEnv</a> <a id="19578" class="Symbol">→</a> <a id="19580" href="Ledger.Ratify.html#4876" class="Record">RatifyState</a> <a id="19592" class="Symbol">→</a> <a id="19594" href="Ledger.GovernanceActions.html#957" class="Function">GovActionID</a> <a id="19606" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="19608" href="Ledger.Gov.html#690" class="Record">GovActionState</a> <a id="19623" class="Symbol">→</a> <a id="19625" href="Ledger.Ratify.html#4876" class="Record">RatifyState</a> <a id="19637" class="Symbol">→</a> <a id="19639" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="19643" class="Keyword">where</a>

<a id="19650" class="Markup">\end{code}</a><a id="19660" class="Background">
\begin{figure*}[h!]
{\small
</a><a id="19689" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,RATIFY&#39;⦈_.RATIFY-Accept"></a><a id="19704" href="Ledger.Ratify.html#19704" class="InductiveConstructor">RATIFY-Accept</a> <a id="19718" class="Symbol">:</a> <a id="19720" class="Keyword">let</a> <a id="19724" class="Keyword">open</a> <a id="19729" href="Ledger.Ratify.html#4654" class="Module">RatifyEnv</a> <a id="19739" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a><a id="19740" class="Symbol">;</a> <a id="19742" href="Ledger.Ratify.html#19742" class="Bound">st</a> <a id="19745" class="Symbol">=</a> <a id="19747" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="19749" class="Symbol">.</a><a id="19750" href="Data.Product.Base.html#622" class="Field">proj₂</a><a id="19755" class="Symbol">;</a> <a id="19757" class="Keyword">open</a> <a id="19762" href="Ledger.Gov.html#690" class="Module">GovActionState</a> <a id="19777" href="Ledger.Ratify.html#19742" class="Bound">st</a> <a id="19780" class="Keyword">in</a>
       <a id="19790" href="Ledger.Ratify.html#19463" class="Function">accepted</a> <a id="19799" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a> <a id="19801" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="19804" href="Ledger.Ratify.html#19742" class="Bound">st</a>
    <a id="19811" class="Symbol">→</a>  <a id="19814" href="Relation.Nullary.Negation.Core.html#815" class="Function Operator">¬</a> <a id="19816" href="Ledger.Ratify.html#18400" class="Function">delayed</a> <a id="19824" href="Ledger.Gov.html#835" class="Function">action</a> <a id="19831" href="Ledger.Gov.html#867" class="Function">prevAction</a> <a id="19842" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="19845" href="Ledger.Ratify.html#19371" class="Generalizable">d</a>
    <a id="19851" class="Symbol">→</a>  <a id="19854" href="Ledger.GovernanceActions.html#11844" class="InductiveConstructor Operator">⟦</a> <a id="19856" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="19858" class="Symbol">.</a><a id="19859" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="19865" href="Ledger.GovernanceActions.html#11844" class="InductiveConstructor Operator">,</a> <a id="19867" href="Ledger.Ratify.html#4847" class="Function">treasury</a> <a id="19876" href="Ledger.GovernanceActions.html#11844" class="InductiveConstructor Operator">,</a> <a id="19878" href="Ledger.Ratify.html#4720" class="Function">currentEpoch</a> <a id="19891" href="Ledger.GovernanceActions.html#11844" class="InductiveConstructor Operator">⟧ᵉ</a> <a id="19894" href="Ledger.GovernanceActions.html#13339" class="Datatype Operator">⊢</a> <a id="19896" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="19899" href="Ledger.GovernanceActions.html#13339" class="Datatype Operator">⇀⦇</a> <a id="19902" href="Ledger.Gov.html#835" class="Function">action</a> <a id="19909" href="Ledger.GovernanceActions.html#13339" class="Datatype Operator">,ENACT⦈</a> <a id="19917" href="Ledger.Ratify.html#19272" class="Generalizable">es&#39;</a>
       <a id="19928" href="Interface.STS.html#244" class="Function Operator">────────────────────────────────</a>
       <a id="19968" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a> <a id="19970" href="Ledger.Ratify.html#19549" class="Datatype Operator">⊢</a>  <a id="19973" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟦</a> <a id="19975" href="Ledger.Ratify.html#19269" class="Generalizable">es</a>   <a id="19980" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="19982" href="Ledger.Ratify.html#19326" class="Generalizable">removed</a>          <a id="19999" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20001" href="Ledger.Ratify.html#19371" class="Generalizable">d</a>                      <a id="20024" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟧ʳ</a> <a id="20027" href="Ledger.Ratify.html#19549" class="Datatype Operator">⇀⦇</a> <a id="20030" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="20032" href="Ledger.Ratify.html#19549" class="Datatype Operator">,RATIFY&#39;⦈</a>
            <a id="20054" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟦</a> <a id="20056" href="Ledger.Ratify.html#19272" class="Generalizable">es&#39;</a>  <a id="20061" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20063" href="Axiom.Set.html#5995" class="Function Operator">❴</a> <a id="20065" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="20067" href="Axiom.Set.html#5995" class="Function Operator">❵</a> <a id="20069" href="Axiom.Set.html#8720" class="Function Operator">∪</a> <a id="20071" href="Ledger.Ratify.html#19326" class="Generalizable">removed</a>  <a id="20080" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20082" href="Ledger.Ratify.html#18047" class="Function">delayingAction</a> <a id="20097" href="Ledger.Gov.html#835" class="Function">action</a>  <a id="20105" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟧ʳ</a>

  <a id="_⊢_⇀⦇_,RATIFY&#39;⦈_.RATIFY-Reject"></a><a id="20111" href="Ledger.Ratify.html#20111" class="InductiveConstructor">RATIFY-Reject</a> <a id="20125" class="Symbol">:</a> <a id="20127" class="Keyword">let</a> <a id="20131" class="Keyword">open</a> <a id="20136" href="Ledger.Ratify.html#4654" class="Module">RatifyEnv</a> <a id="20146" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a><a id="20147" class="Symbol">;</a> <a id="20149" href="Ledger.Ratify.html#20149" class="Bound">st</a> <a id="20152" class="Symbol">=</a> <a id="20154" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="20156" class="Symbol">.</a><a id="20157" href="Data.Product.Base.html#622" class="Field">proj₂</a> <a id="20163" class="Keyword">in</a>
       <a id="20173" href="Relation.Nullary.Negation.Core.html#815" class="Function Operator">¬</a> <a id="20175" href="Ledger.Ratify.html#19463" class="Function">accepted</a> <a id="20184" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a> <a id="20186" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20189" href="Ledger.Ratify.html#20149" class="Bound">st</a>
    <a id="20196" class="Symbol">→</a>  <a id="20199" href="Ledger.Ratify.html#16113" class="Function">expired</a> <a id="20207" href="Ledger.Ratify.html#4720" class="Function">currentEpoch</a> <a id="20220" href="Ledger.Ratify.html#20149" class="Bound">st</a>
       <a id="20230" href="Interface.STS.html#244" class="Function Operator">────────────────────────────────</a>
       <a id="20270" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a> <a id="20272" href="Ledger.Ratify.html#19549" class="Datatype Operator">⊢</a> <a id="20274" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟦</a> <a id="20276" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20279" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20281" href="Ledger.Ratify.html#19326" class="Generalizable">removed</a> <a id="20289" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20291" href="Ledger.Ratify.html#19371" class="Generalizable">d</a> <a id="20293" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟧ʳ</a> <a id="20296" href="Ledger.Ratify.html#19549" class="Datatype Operator">⇀⦇</a> <a id="20299" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="20301" href="Ledger.Ratify.html#19549" class="Datatype Operator">,RATIFY&#39;⦈</a> <a id="20311" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟦</a> <a id="20313" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20316" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20318" href="Axiom.Set.html#5995" class="Function Operator">❴</a> <a id="20320" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="20322" href="Axiom.Set.html#5995" class="Function Operator">❵</a> <a id="20324" href="Axiom.Set.html#8720" class="Function Operator">∪</a> <a id="20326" href="Ledger.Ratify.html#19326" class="Generalizable">removed</a> <a id="20334" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20336" href="Ledger.Ratify.html#19371" class="Generalizable">d</a> <a id="20338" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟧ʳ</a>

  <a id="_⊢_⇀⦇_,RATIFY&#39;⦈_.RATIFY-Continue"></a><a id="20344" href="Ledger.Ratify.html#20344" class="InductiveConstructor">RATIFY-Continue</a> <a id="20360" class="Symbol">:</a> <a id="20362" class="Keyword">let</a> <a id="20366" class="Keyword">open</a> <a id="20371" href="Ledger.Ratify.html#4654" class="Module">RatifyEnv</a> <a id="20381" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a><a id="20382" class="Symbol">;</a> <a id="20384" href="Ledger.Ratify.html#20384" class="Bound">st</a> <a id="20387" class="Symbol">=</a> <a id="20389" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="20391" class="Symbol">.</a><a id="20392" href="Data.Product.Base.html#622" class="Field">proj₂</a><a id="20397" class="Symbol">;</a> <a id="20399" class="Keyword">open</a> <a id="20404" href="Ledger.Gov.html#690" class="Module">GovActionState</a> <a id="20419" href="Ledger.Ratify.html#20384" class="Bound">st</a> <a id="20422" class="Keyword">in</a>
       <a id="20432" href="Relation.Nullary.Negation.Core.html#815" class="Function Operator">¬</a> <a id="20434" href="Ledger.Ratify.html#19463" class="Function">accepted</a> <a id="20443" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a> <a id="20445" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20448" href="Ledger.Ratify.html#20384" class="Bound">st</a> <a id="20451" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="20453" href="Relation.Nullary.Negation.Core.html#815" class="Function Operator">¬</a> <a id="20455" href="Ledger.Ratify.html#16113" class="Function">expired</a> <a id="20463" href="Ledger.Ratify.html#4720" class="Function">currentEpoch</a> <a id="20476" href="Ledger.Ratify.html#20384" class="Bound">st</a>
    <a id="20483" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a>  <a id="20486" href="Ledger.Ratify.html#18400" class="Function">delayed</a> <a id="20494" href="Ledger.Gov.html#835" class="Function">action</a> <a id="20501" href="Ledger.Gov.html#867" class="Function">prevAction</a> <a id="20512" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20515" href="Ledger.Ratify.html#19371" class="Generalizable">d</a>
    <a id="20521" href="Data.Sum.Base.html#616" class="Datatype Operator">⊎</a>  <a id="20524" href="Ledger.Ratify.html#19463" class="Function">accepted</a> <a id="20533" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a> <a id="20535" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20538" href="Ledger.Ratify.html#20384" class="Bound">st</a>
       <a id="20548" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="20550" href="Relation.Nullary.Negation.Core.html#815" class="Function Operator">¬</a> <a id="20552" href="Ledger.Ratify.html#18400" class="Function">delayed</a> <a id="20560" href="Ledger.Gov.html#835" class="Function">action</a> <a id="20567" href="Ledger.Gov.html#867" class="Function">prevAction</a> <a id="20578" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20581" href="Ledger.Ratify.html#19371" class="Generalizable">d</a>
       <a id="20590" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="20592" class="Symbol">(∀</a> <a id="20595" href="Ledger.Ratify.html#20595" class="Bound">es&#39;</a> <a id="20599" class="Symbol">→</a> <a id="20601" href="Relation.Nullary.Negation.Core.html#815" class="Function Operator">¬</a> <a id="20603" href="Ledger.GovernanceActions.html#11844" class="InductiveConstructor Operator">⟦</a> <a id="20605" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="20607" class="Symbol">.</a><a id="20608" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="20614" href="Ledger.GovernanceActions.html#11844" class="InductiveConstructor Operator">,</a> <a id="20616" href="Ledger.Ratify.html#4847" class="Function">treasury</a> <a id="20625" href="Ledger.GovernanceActions.html#11844" class="InductiveConstructor Operator">,</a> <a id="20627" href="Ledger.Ratify.html#4720" class="Function">currentEpoch</a> <a id="20640" href="Ledger.GovernanceActions.html#11844" class="InductiveConstructor Operator">⟧ᵉ</a> <a id="20643" href="Ledger.GovernanceActions.html#13339" class="Datatype Operator">⊢</a> <a id="20645" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20648" href="Ledger.GovernanceActions.html#13339" class="Datatype Operator">⇀⦇</a> <a id="20651" href="Ledger.Gov.html#835" class="Function">action</a> <a id="20658" href="Ledger.GovernanceActions.html#13339" class="Datatype Operator">,ENACT⦈</a> <a id="20666" href="Ledger.Ratify.html#20595" class="Bound">es&#39;</a><a id="20669" class="Symbol">)</a>
    <a id="20675" href="Interface.STS.html#244" class="Function Operator">────────────────────────────────</a>
    <a id="20712" href="Ledger.Ratify.html#19253" class="Generalizable">Γ</a> <a id="20714" href="Ledger.Ratify.html#19549" class="Datatype Operator">⊢</a> <a id="20716" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟦</a> <a id="20718" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20721" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20723" href="Ledger.Ratify.html#19326" class="Generalizable">removed</a> <a id="20731" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20733" href="Ledger.Ratify.html#19371" class="Generalizable">d</a> <a id="20735" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟧ʳ</a> <a id="20738" href="Ledger.Ratify.html#19549" class="Datatype Operator">⇀⦇</a> <a id="20741" href="Ledger.Ratify.html#19291" class="Generalizable">a</a> <a id="20743" href="Ledger.Ratify.html#19549" class="Datatype Operator">,RATIFY&#39;⦈</a> <a id="20753" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟦</a> <a id="20755" href="Ledger.Ratify.html#19269" class="Generalizable">es</a> <a id="20758" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20760" href="Ledger.Ratify.html#19326" class="Generalizable">removed</a> <a id="20768" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">,</a> <a id="20770" href="Ledger.Ratify.html#19371" class="Generalizable">d</a> <a id="20772" href="Ledger.Ratify.html#4914" class="InductiveConstructor Operator">⟧ʳ</a>

<a id="_⊢_⇀⦇_,RATIFY⦈_"></a><a id="20776" href="Ledger.Ratify.html#20776" class="Function Operator">_⊢_⇀⦇_,RATIFY⦈_</a>  <a id="20793" class="Symbol">:</a> <a id="20795" href="Ledger.Ratify.html#4654" class="Record">RatifyEnv</a> <a id="20805" class="Symbol">→</a> <a id="20807" href="Ledger.Ratify.html#4876" class="Record">RatifyState</a> <a id="20819" class="Symbol">→</a> <a id="20821" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="20826" class="Symbol">(</a><a id="20827" href="Ledger.GovernanceActions.html#957" class="Function">GovActionID</a> <a id="20839" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="20841" href="Ledger.Gov.html#690" class="Record">GovActionState</a><a id="20855" class="Symbol">)</a>
                 <a id="20874" class="Symbol">→</a> <a id="20876" href="Ledger.Ratify.html#4876" class="Record">RatifyState</a> <a id="20888" class="Symbol">→</a> <a id="20890" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="20894" href="Ledger.Ratify.html#20776" class="Function Operator">_⊢_⇀⦇_,RATIFY⦈_</a> <a id="20910" class="Symbol">=</a> <a id="20912" href="Interface.STS.html#1607" class="Function">SS⇒BS</a> <a id="20918" href="Ledger.Ratify.html#19549" class="Datatype Operator">_⊢_⇀⦇_,RATIFY&#39;⦈_</a>
<a id="20935" class="Markup">\end{code}</a><a id="20945" class="Background">
} %% end small
\caption{The RATIFY transition system}
\label{fig:ratify-transition-system}
\end{figure*}
Figure~\ref{fig:ratify-transition-system} defines three rules,
\RATIFYAccept, \RATIFYReject, and \RATIFYContinue, along with the relation \RATIFYsyntax.
The latter is the transition relation for ratification of a \GovAction.
\begin{itemize}
  \item \RATIFYAccept checks if the votes for a given \GovAction meet the threshold required for
        acceptance, that the action is accepted and not delayed,
        and \RATIFYAccept ratifies the action.

  \item \RATIFYReject asserts that the given \GovAction is not \accepted and \expired;
        it removes the governance action.
  \item \RATIFYContinue covers the remaining cases and keeps the \GovAction around for further voting.
\end{itemize}

Note that all governance actions eventually either get accepted and enacted via \RATIFYAccept or
rejected via \RATIFYReject. If an action satisfies all criteria to be accepted but cannot be
enacted anyway, it is kept around and tried again at the next epoch boundary.

We never remove actions that do not attract sufficient \yes votes before they expire, even if it
is clear to an outside observer that this action will never be enacted. Such an action will simply
keep getting checked every epoch until it expires.
</a></pre></body></html>